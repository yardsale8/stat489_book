<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7.6. Common Patterns for Processing Sequences with Dictionaries &mdash; Runestone Interactive Overview</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/activecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/clickable.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pytutor.css" type="text/css" />
    <link rel="stylesheet" href="../_static/modal-basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/datafile.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dragndrop.css" type="text/css" />
    <link rel="stylesheet" href="../_static/fitb.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/livecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/parsons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/lib/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/poll.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tabbedstuff.css" type="text/css" />
    <link rel="stylesheet" href="../_static/video.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.1/""/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/jquery-ui-1.10.3.custom.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/user-highlights.css" type="text/css" />
    <link rel="stylesheet" href="../_static/runestone-custom-sphinx-bootstrap.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/runestonebase.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.highlight.js"></script>
    <script type="text/javascript" src="../_static/bookfuncs.js"></script>
    <script type="text/javascript" src="../_static/codemirror.js"></script>
    <script type="text/javascript" src="../_static/xml.js"></script>
    <script type="text/javascript" src="../_static/css.js"></script>
    <script type="text/javascript" src="../_static/htmlmixed.js"></script>
    <script type="text/javascript" src="../_static/python.js"></script>
    <script type="text/javascript" src="../_static/javascript.js"></script>
    <script type="text/javascript" src="../_static/activecode.js"></script>
    <script type="text/javascript" src="../_static/skulpt.min.js"></script>
    <script type="text/javascript" src="../_static/skulpt-stdlib.js"></script>
    <script type="text/javascript" src="../_static/clike.js"></script>
    <script type="text/javascript" src="../_static/timed_activecode.js"></script>
    <script type="text/javascript" src="../_static/animationbase.js"></script>
    <script type="text/javascript" src="../_static/mchoice.js"></script>
    <script type="text/javascript" src="../_static/timedmc.js"></script>
    <script type="text/javascript" src="../_static/timed.js"></script>
    <script type="text/javascript" src="../_static/clickable.js"></script>
    <script type="text/javascript" src="../_static/timedclickable.js"></script>
    <script type="text/javascript" src="../_static/d3.v2.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.ba-bbq.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.jsPlumb-1.3.10-all-min.js"></script>
    <script type="text/javascript" src="../_static/pytutor.js"></script>
    <script type="text/javascript" src="../_static/codelens.js"></script>
    <script type="text/javascript" src="../_static/skulpt.min.js"></script>
    <script type="text/javascript" src="../_static/skulpt-stdlib.js"></script>
    <script type="text/javascript" src="../_static/datafile.js"></script>
    <script type="text/javascript" src="../_static/dragndrop.js"></script>
    <script type="text/javascript" src="../_static/timeddnd.js"></script>
    <script type="text/javascript" src="../_static/fitb.js"></script>
    <script type="text/javascript" src="../_static/timedfitb.js"></script>
    <script type="text/javascript" src="../_static/livecode.js"></script>
    <script type="text/javascript" src="../_static/clike.js"></script>
    <script type="text/javascript" src="../_static/lib/prettify.js"></script>
    <script type="text/javascript" src="../_static/lib/hammer.min.js"></script>
    <script type="text/javascript" src="../_static/parsons.js"></script>
    <script type="text/javascript" src="../_static/timedparsons.js"></script>
    <script type="text/javascript" src="../_static/poll.js"></script>
    <script type="text/javascript" src="../_static/reveal.js"></script>
    <script type="text/javascript" src="../_static/shortanswer.js"></script>
    <script type="text/javascript" src="../_static/timed_shortanswer.js"></script>
    <script type="text/javascript" src="../_static/tabbedstuff.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <link rel="top" title="Runestone Interactive Overview" href="../index.html" />
    <link rel="up" title="7. Functional List Processing" href="toctree.html" />
    <link rel="next" title="7.7. Lazy Iteration" href="LazyIteration.html" />
    <link rel="prev" title="7.5. Other Examples of Higher Order Functions" href="OtherExamplesOfHigherOrderFunctions.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<link rel="shortcut icon" href="/runestone/static/favicon.ico" type="image/ico" />

<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = 'http://127.0.0.1:8000' ? 'http://127.0.0.1:8000' : 'http://127.0.0.1:8000';
  eBookConfig.app = eBookConfig.host+'/runestone';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = 'STAT489';
  eBookConfig.logLevel = 0;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.isLoggedIn = false;
  eBookConfig.useRunestoneServices = false;
  eBookConfig.python3 = true;
  eBookConfig.basecourse = 'STAT489';
</script>

<div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&status=0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>



  </head>
  <body role="document">


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        <a class="brand-logo" style='background: transparent url("../_static/img/logo_small.png") no-repeat 0px 0px;' href="/runestone/default/user/login">&nbsp; </a>
        <a class="navbar-brand" href="../index.html">STAT489</a>
      </div>
    </div>

    <div class="navbar-collapse collapse navbar-ex1-collapse">

      <ul class="nav navbar-nav navbar-right">

        <li class="divider-vertical"></li>

        <!-- social media dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-share-alt" style="opacity: 0.9"></i>
          </a>
          <ul class="dropdown-menu social-menu">
              <li>
                <div>
                  <b>Runestone in social media:</b>
                </div>
                <a href="https://twitter.com/iRunestone" class="twitter-follow-button" data-show-count="true">Follow @iRunestone</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="fb-like" data-href="https://www.facebook.com/RunestoneInteractive" data-send="false" data-layout="button_count" data-width="300" data-show-faces="false" data-font="arial"></div>
              </li>

              <li class="divider"></li>
              <li>
                <div>
                  <b>Help support us:</b>
                </div>
                <div>
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                  <input type="hidden" name="cmd" value="_s-xclick">
                  <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHNwYJKoZIhvcNAQcEoIIHKDCCByQCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYAcrkqh1hn3lYqIpfXxNqe1T82EhXzCJGy1yMAmklpyZshyMkfDGe1Bhx+iwyGeoYRTTyphFmP+9M3NyO0+Q5XdHxgZPx/zYjjBxlZHgEV6jhE8bN2fHkkPf0VHfz0a0QQylQOPlKiOTZV7B37Jpk6yM47oVZ1tG/KNm0NkfmB76DELMAkGBSsOAwIaBQAwgbQGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIi0GmFfOlcjuAgZBbYOo9UO+CpMQa+PYqwsUmUnJvXIImeMeNI3KVTUx5Cfk9gNMo3WzPeiB5IqZo9nRAQ0mf1qL2ecLeB5tidM+lgBUhOxfj3/FecpnVFa0263gp4g+PLw8jzhvVRdUon1K3SeO1Rzh23fIRKwnrD6btt73uwtj0sl3tGd8qz+6GIcwPDdRk9VcUffiBJT/ZagKgggOHMIIDgzCCAuygAwIBAgIBADANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wHhcNMDQwMjEzMTAxMzE1WhcNMzUwMjEzMTAxMzE1WjCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMFHTt38RMxLXJyO2SmS+Ndl72T7oKJ4u4uw+6awntALWh03PewmIJuzbALScsTS4sZoS1fKciBGoh11gIfHzylvkdNe/hJl66/RGqrj5rFb08sAABNTzDTiqqNpJeBsYs/c2aiGozptX2RlnBktH+SUNpAajW724Nv2Wvhif6sFAgMBAAGjge4wgeswHQYDVR0OBBYEFJaffLvGbxe9WT9S1wob7BDWZJRrMIG7BgNVHSMEgbMwgbCAFJaffLvGbxe9WT9S1wob7BDWZJRroYGUpIGRMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbYIBADAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIFfOlaagFrl71+jq6OKidbWFSE+Q4FqROvdgIONth+8kSK//Y/4ihuE4Ymvzn5ceE3S/iBSQQMjyvb+s2TWbQYDwcp129OPIbD9epdr4tJOUNiSojw7BHwYRiPh58S1xGlFgHFXwrEBb3dgNbMUa+u4qectsMAXpVHnD9wIyfmHMYIBmjCCAZYCAQEwgZQwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tAgEAMAkGBSsOAwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xMzExMDMxMzQxMzFaMCMGCSqGSIb3DQEJBDEWBBRDJF8w+zsMr7FSk+pwinB5f5D4rzANBgkqhkiG9w0BAQEFAASBgHw1LMHpkpaqHIvDGdFE0eG+2mZlmMnUeDCBhQlbc7QMzFQYKTV94NfaebBO4PmNdADe1rq4WidSRZZbE7CzkX9IGENYnBTWY0hb2l0lGdGrJdGeWyV3ekg9WVaFMMumrekds96h3Cx7dGz2kWDzIai2iEXE/qoE+xpkyXAYZNV3-----END PKCS7-----
                  ">
                  <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                  <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                  </form>

                </div>
              </li>
          </ul>
        </li>
        <!-- end social media dropdown -->

        <li class="divider-vertical"></li>

        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html'>Table of Contents</a></li>
            
            <li><a href='/runestone/static/STAT489/genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li id="scratch_ac_link"><a href="javascript:ACFactory.toggleScratchActivecode()">Scratch ActiveCode</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        
        <li class="divider-vertical"></li>

        <!-- help menu dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-question-sign" style="opacity:0.9;"></i>
          </a>
          <ul class="dropdown-menu user-menu">
            <li><a href='/runestone/static/STAT489/navhelp.html'>Navigation Help</a></li>
            <li><a href='/runestone/static/overview/instructor.html'>Help for Instructors</a></li>
            <li class="divider"></li>
            <li><a href='http://runestoneinteractive.org'>About Runestone</a></li>
            <li><a href='/runestone/default/reportabug?course=STAT489&page=CommonPatternsForProcessingSequencesWithDictionaries'>Report A Problem</a></li>
          </ul>
        </li>
        <!-- end help menu dropdown -->

        <li class="divider-vertical"></li>

      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        <!--
          <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">7.6. Common Patterns for Processing Sequences with Dictionaries</a><ul>
<li><a class="reference internal" href="#counting-frequencies-with-dictionaries">7.6.1. Counting Frequencies with Dictionaries</a></li>
<li><a class="reference internal" href="#the-imperative-approach-to-counting-frequences">7.6.2. The Imperative Approach to Counting Frequences</a></li>
<li><a class="reference internal" href="#the-recursive-approach-to-counting-frequencies">7.6.3. The Recursive Approach to Counting Frequencies</a></li>
<li><a class="reference internal" href="#counting-frequencies-using-a-key-function">7.6.4. Counting Frequencies Using a Key Function</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          <li class="divider-vertical"></li>
        
        
          
  <li id="relations-prev" title="Previous Chapter - 7.5. Other Examples of Higher Order Functions" data-toggle="tooltip">
    <a href="OtherExamplesOfHigherOrderFunctions.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - 7.7. Lazy Iteration' data-toggle="tooltip" >
    <a href="LazyIteration.html" >
      <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script type="text/javascript">
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  $('#relations-prev').tooltip(opts);
  $('#relations-next').tooltip(opts);
</script>
        -->
        
          <li></li>
        
      </ul>

    </div>
  </div>
</div>


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content">
  
  <div class="section" id="common-patterns-for-processing-sequences-with-dictionaries">
<h1>7.6. Common Patterns for Processing Sequences with Dictionaries<a class="headerlink" href="#common-patterns-for-processing-sequences-with-dictionaries" title="Permalink to this headline">¶</a></h1>
<p>In this section, we will illustrate a number of common patterns for processing
lists using dictionaries.  These patterns include counting frequencies and counting
frequencies by some key function.  In each case, we will start by looking at the
imperative solution, then move on to the recursive solution and finally use a
pre-existing function from <code class="docutils literal"><span class="pre">toolz</span></code>.</p>
<div class="section" id="counting-frequencies-with-dictionaries">
<h2>7.6.1. Counting Frequencies with Dictionaries<a class="headerlink" href="#counting-frequencies-with-dictionaries" title="Permalink to this headline">¶</a></h2>
<p>In this section, we continue the theme of processing sequential data.  Many
problems require that we group data by some common characteristic.  We will
refer to this operation as <strong>counts</strong> or <strong>frequencies</strong>.  In Python,
dictionaries are the right data structure for a keeping track of the counts for
various objects.  In this section, we will look at two low-level approaches to
writing a <strong>frequencies</strong> operation, with an imperative approach and with
recursion.</p>
</div>
<div class="section" id="the-imperative-approach-to-counting-frequences">
<h2>7.6.2. The Imperative Approach to Counting Frequences<a class="headerlink" href="#the-imperative-approach-to-counting-frequences" title="Permalink to this headline">¶</a></h2>
<p>As a working example, suppose that we want to count the occurrences of each word
in a block of text.  For this example, we will use the Zen of Python with
punctuation already removed.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">zen_no_punc</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="gp">   ...: </span><span class="s1">The Zen of Python by Tim Peters</span>
<span class="gp">   ...: </span><span class="s1">Beautiful is better than ugly</span>
<span class="gp">   ...: </span><span class="s1">Explicit is better than implicit</span>
<span class="gp">   ...: </span><span class="s1">Simple is better than complex</span>
<span class="gp">   ...: </span><span class="s1">Complex is better than complicated</span>
<span class="gp">   ...: </span><span class="s1">Flat is better than nested</span>
<span class="gp">   ...: </span><span class="s1">Sparse is better than dense</span>
<span class="gp">   ...: </span><span class="s1">Readability counts</span>
<span class="gp">   ...: </span><span class="s1">Special cases arent special enough to break the rules</span>
<span class="gp">   ...: </span><span class="s1">Although practicality beats purity</span>
<span class="gp">   ...: </span><span class="s1">Errors should never pass silently</span>
<span class="gp">   ...: </span><span class="s1">Unless explicitly silenced</span>
<span class="gp">   ...: </span><span class="s1">In the face of ambiguity refuse the temptation to guess</span>
<span class="gp">   ...: </span><span class="s1">There should be one and preferably only one obvious way to do it</span>
<span class="gp">   ...: </span><span class="s1">Although that way may not be obvious at first unless youre Dutch</span>
<span class="gp">   ...: </span><span class="s1">Now is better than never</span>
<span class="gp">   ...: </span><span class="s1">Although never is often better than right now</span>
<span class="gp">   ...: </span><span class="s1">If the implementation is hard to explain its a bad idea</span>
<span class="gp">   ...: </span><span class="s1">If the implementation is easy to explain it may be a good idea</span>
<span class="gp">   ...: </span><span class="s1">Namespaces are one honking great idea  lets do more of those&#39;&#39;&#39;</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
<p>The imperative approach to counting is to use the accumulator pattern with a
dictionary as the accumulator.  We start with an empty dictionary and iterate
through the words,  updating the entries of the dictionary as we go.  While we
could accomplish this by mutating the same dictionary, in this example we will
use <code class="docutils literal"><span class="pre">assoc</span></code> to return a new, updated, copy of the dictionary.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">assoc</span>

<span class="gp">In [3]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">zen_no_punc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="gp">In [4]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [5]: </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="gp">   ...: </span>    <span class="n">update_count</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">   ...: </span>    <span class="n">counts</span> <span class="o">=</span> <span class="n">assoc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">update_count</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [6]: </span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;implementation&#39;</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gh">Out[6]: </span><span class="go">2</span>
</pre></div>
</div>
<p>There are a couple of things to note in this example.  First, we are using
<code class="docutils literal"><span class="pre">get</span></code> with a default value of 0 to get the current count.  As we are starting
with an empty dictionary, the default value will be used the first time we see
each word.  When we subsequent occurrences of the word, <code class="docutils literal"><span class="pre">get</span></code> will return the
value stored in the dictionary.</p>
<p>Also of note is using <code class="docutils literal"><span class="pre">assoc</span></code> to update and save a fresh copy of the
dictionary.   As we work through the words, counts will accumulate more and more
information about the word frequencies.</p>
<p>To make thi pattern clear, we first write the helper functions <code class="docutils literal"><span class="pre">update_count</span></code>
and <code class="docutils literal"><span class="pre">update_dict</span></code> based on the code from the imperative solution.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">update_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="gp">In [8]: </span><span class="n">update_dict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">wd</span><span class="p">,</span> <span class="n">update_count</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">))</span>
</pre></div>
</div>
<p>Using these functions, the imperative solution becomes</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">update_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="gp">In [10]: </span><span class="n">update_dict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">wd</span><span class="p">,</span> <span class="n">update_count</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">))</span>

<span class="gp">In [11]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [12]: </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>To get a general feel for this pattern, we rewrite the code using more general
names.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">acc</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">L</span><span class="p">:</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We will generalize this pattern using the function <code class="docutils literal"><span class="pre">reduce</span></code> in the next
chapter.</p>
</div>
</div>
<div class="section" id="the-recursive-approach-to-counting-frequencies">
<h2>7.6.3. The Recursive Approach to Counting Frequencies<a class="headerlink" href="#the-recursive-approach-to-counting-frequencies" title="Permalink to this headline">¶</a></h2>
<p>Recursion is one of the building blocks of functional programming.  A
<strong>recursive</strong> function is a function that calls itself and <strong>recursion</strong> refers
to using recursive functions to solve a problem.</p>
<p>There are some well-established abstractions that are used when using recursion
to process a list.  We start with a recursive definition of a list.  In a
recursive context, a list is either <code class="docutils literal"><span class="pre">empty</span></code> or the <code class="docutils literal"><span class="pre">first(list),</span>
<span class="pre">rest(list)</span></code>, where <code class="docutils literal"><span class="pre">first(list)</span></code> is the next entry in the list and
<code class="docutils literal"><span class="pre">rest(list)</span></code> is the remainder of the list.  We could define <code class="docutils literal"><span class="pre">first</span></code> and
<code class="docutils literal"><span class="pre">rest</span></code> on Python lists as follows.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

<span class="gp">In [14]: </span><span class="n">first</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="gp">In [15]: </span><span class="n">rest</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="gp">In [16]: </span><span class="n">first</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="gh">Out[16]: </span><span class="go">1</span>

<span class="gp">In [17]: </span><span class="n">rest</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="go">           Out[17]: [2, 3, 4]</span>
</pre></div>
</div>
<p>As noted in a previous chapter, slicing all but the first element of a list is
an operation with a time complexity of <span class="math">\(O(n)\)</span>, which is an expensive
operation to apply once for each item in a list (The overall complexity would be
<span class="math">\(O(n^2)\)</span>).  We can use the <code class="docutils literal"><span class="pre">Plist</span></code> data structure from <code class="docutils literal"><span class="pre">pyrsistent</span></code>
for a more efficient approach to processing list in this way.  A <code class="docutils literal"><span class="pre">plist</span></code> comes
with methods for <code class="docutils literal"><span class="pre">first</span></code> and <code class="docutils literal"><span class="pre">rest</span></code>.  The time complexity for both the <code class="docutils literal"><span class="pre">first</span></code>
and <code class="docutils literal"><span class="pre">rest</span></code> methods of a <code class="docutils literal"><span class="pre">Plist</span></code> is constant time, i.e. <span class="math">\(O(1)\)</span>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="kn">from</span> <span class="nn">pyrsistent</span> <span class="kn">import</span> <span class="n">plist</span>

<span class="gp">In [19]: </span><span class="n">L</span> <span class="o">=</span> <span class="n">plist</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>

<span class="gp">In [20]: </span><span class="nb">type</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="gh">Out[20]: </span><span class="go">pyrsistent._plist.PList</span>

<span class="gp">In [21]: </span><span class="n">L</span><span class="o">.</span><span class="n">first</span>
<span class="go">                                 Out[21]: 1</span>

<span class="gp">In [22]: </span><span class="n">L2</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">rest</span>

<span class="gp">In [23]: </span><span class="n">L2</span>
<span class="gh">Out[23]: </span><span class="go">plist([2, 3, 4])</span>

<span class="gp">In [24]: </span><span class="n">L</span> <span class="ow">is</span> <span class="n">L2</span>
<span class="go">                          Out[24]: False</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">L.rest</span></code> does not mutate <code class="docutils literal"><span class="pre">L</span></code>, but returns a reference to a new
<code class="docutils literal"><span class="pre">Plist</span></code>.</p>
<p>There are two more function that are useful when processing list in a recursive
fashion.  First, we need a function to check if a list is empty, which will will
call <code class="docutils literal"><span class="pre">is_empty</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [25]: </span><span class="n">is_empty</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

<span class="gp">In [26]: </span><span class="n">is_empty</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="gh">Out[26]: </span><span class="go">False</span>

<span class="gp">In [27]: </span><span class="n">is_empty</span><span class="p">(</span><span class="n">plist</span><span class="p">([]))</span>
<span class="go">               Out[27]: True</span>
</pre></div>
</div>
<p>Second, we introduce a function called <code class="docutils literal"><span class="pre">cons</span></code> to add a new
value to the beginning of a <code class="docutils literal"><span class="pre">Plist</span></code>.  Luckily, the <code class="docutils literal"><span class="pre">Plist</span></code> data structure
comes with a <code class="docutils literal"><span class="pre">cons</span></code> method.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [28]: </span><span class="kn">from</span> <span class="nn">pyrsistent</span> <span class="kn">import</span> <span class="n">plist</span>

<span class="gp">In [29]: </span><span class="n">L</span> <span class="o">=</span> <span class="n">plist</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>

<span class="gp">In [30]: </span><span class="n">L2</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">cons</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [31]: </span><span class="n">L2</span>
<span class="gh">Out[31]: </span><span class="go">plist([0, 1, 2, 3, 4])</span>

<span class="gp">In [32]: </span><span class="n">L</span> <span class="ow">is</span> <span class="n">L2</span>
<span class="go">                                Out[32]: False</span>
</pre></div>
</div>
<p>Let&#8217;s work on a recursive solution.  Before we write the recursive solution,
consider the following <strong>laws of recursion</strong>.</p>
<div class="admonition-the-first-and-second-laws-of-recursion admonition">
<p class="first admonition-title">The First and Second Laws of Recursion</p>
<p class="last">To paraphrase <em>The Little Schemer</em>, the first law of recursion is: <strong>The first
question is ``is_empty``.</strong>  When processing a list recursive, we always
check to see if the list is empty.  The second law of recursion is to call
your function on the rest of the list.  This has the effect of always moving
toward the base case of an empty list.  Proper application of the second law
will assure that out recursive function will terminate.</p>
</div>
<p>Let&#8217;s step though processing our text to get a feel for how recursion will work.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">assoc</span>

<span class="gp">In [34]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">plist</span><span class="p">(</span><span class="n">zen_no_punc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

<span class="gp">In [35]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [36]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="gp">In [37]: </span><span class="n">counts</span>
<span class="gh">Out[37]: </span><span class="go">{&#39;the&#39;: 1}</span>

<span class="gp">In [38]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span>

<span class="gp">In [39]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="gp">In [40]: </span><span class="n">counts</span>
<span class="gh">Out[40]: </span><span class="go">{&#39;the&#39;: 1, &#39;zen&#39;: 1}</span>

<span class="gp">In [41]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span>

<span class="gp">In [42]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="gp">In [43]: </span><span class="n">counts</span>
<span class="gh">Out[43]: </span><span class="go">{&#39;of&#39;: 1, &#39;the&#39;: 1, &#39;zen&#39;: 1}</span>

<span class="gp">In [44]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span>
</pre></div>
</div>
<p>Let&#8217;s compose these expression using substitution, Specifically, we will embed
the <code class="docutils literal"><span class="pre">word</span> <span class="pre">=</span> <span class="pre">word.rest</span></code> in the line involving <code class="docutils literal"><span class="pre">assoc</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [45]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [46]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="gp">In [47]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="gp">In [48]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="gp">In [49]: </span><span class="n">counts</span>
<span class="gh">Out[49]: </span><span class="go">{&#39;by&#39;: 1, &#39;python&#39;: 1, &#39;tim&#39;: 1}</span>
</pre></div>
</div>
<p>A pattern emerges.  Each <code class="docutils literal"><span class="pre">assoc</span></code> operation is called the <code class="docutils literal"><span class="pre">rest</span></code> of the last
list.  This will continue until the list is empty.  If we tried to call
<code class="docutils literal"><span class="pre">first</span></code> when the list is empty, we would get an exception.  This is the reason
for the first law of recursion: We should check <code class="docutils literal"><span class="pre">is_empty</span></code> to make sure the
recursion terminates correctly.   Let&#8217;s add a conditional statement to the last
example to be sure that we return counts once we have emptied the list.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [50]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [51]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="gp">In [52]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="gp">In [53]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="gp">In [54]: </span><span class="n">counts</span>
<span class="gh">Out[54]: </span><span class="go">{&#39;by&#39;: 1, &#39;python&#39;: 1, &#39;tim&#39;: 1}</span>
</pre></div>
</div>
<p>These expressions are getting a little complicated and very repetitive.  Let&#8217;s
package the core logic in a lambda expression to clean things up.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [55]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [56]: </span><span class="n">next_cnts</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wds</span><span class="p">:</span> <span class="n">cnts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">wds</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">wds</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">cnts</span><span class="p">)</span>

<span class="gp">In [57]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>

<span class="gp">In [58]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="gp">In [59]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
</pre></div>
</div>
<p>We are almost there!  Again we will compose the expressions, this time using
substitution on <code class="docutils literal"><span class="pre">count</span></code>.  To make this clear, we will work through each
substitution one by one.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [60]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">({},</span> <span class="n">words</span><span class="p">)</span>

<span class="gp">In [61]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="gp">In [62]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [63]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">next_cnts</span><span class="p">({},</span> <span class="n">words</span><span class="p">),</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="gp">In [64]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [65]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">next_cnts</span><span class="p">(</span><span class="n">next_cnts</span><span class="p">({},</span> <span class="n">words</span><span class="p">),</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">),</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="gp">In [66]: </span><span class="n">counts</span>
<span class="gh">Out[66]: </span><span class="go">{&#39;by&#39;: 1, &#39;python&#39;: 1, &#39;tim&#39;: 1}</span>
</pre></div>
</div>
<p>So what we want to do is repeatedly call <code class="docutils literal"><span class="pre">next_cnts</span></code> on the output of the
last call to <code class="docutils literal"><span class="pre">next_cnts</span></code> and the rest of <code class="docutils literal"><span class="pre">words</span></code>.  We continue until the
<code class="docutils literal"><span class="pre">words</span></code> list is empty, at which point we would return the <code class="docutils literal"><span class="pre">counts</span></code>
dictionary .  Also note that the very first call to <code class="docutils literal"><span class="pre">assoc_count</span></code> is seeded
with an empty dictionary.</p>
<p>Two small changes and we have a solution.  First, we define a recursive function
<code class="docutils literal"><span class="pre">count_words</span></code>.  Second, we embed a recursive call to abstract the pattern of
calling this function over and over until completion.  Note that each call to
<code class="docutils literal"><span class="pre">count_words</span></code> needs the updated dictionary (using word.first which can now be
discarded) and the rest of the words.  Also recall that we start the process
with an empty dictionary.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [67]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [68]: </span><span class="n">count_words</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wds</span><span class="p">:</span> <span class="n">cnts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">wds</span><span class="p">)</span> <span class="k">else</span> <span class="n">count_words</span><span class="p">(</span><span class="n">update_dict</span><span class="p">(</span><span class="n">wds</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">cnts</span><span class="p">),</span> <span class="n">wds</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="gp">In [69]: </span><span class="n">count_words</span><span class="p">({},</span> <span class="n">words</span><span class="p">)</span>
<span class="gh">Out[69]: </span><span class="go"></span>
<span class="go">{&#39;a&#39;: 2,</span>
<span class="go"> &#39;although&#39;: 3,</span>
<span class="go"> &#39;ambiguity&#39;: 1,</span>
<span class="go"> &#39;and&#39;: 1,</span>
<span class="go"> &#39;are&#39;: 1,</span>
<span class="go"> &#39;arent&#39;: 1,</span>
<span class="go"> &#39;at&#39;: 1,</span>
<span class="go"> &#39;bad&#39;: 1,</span>
<span class="go"> &#39;be&#39;: 3,</span>
<span class="go"> &#39;beats&#39;: 1,</span>
<span class="go"> &#39;beautiful&#39;: 1,</span>
<span class="go"> &#39;better&#39;: 8,</span>
<span class="go"> &#39;break&#39;: 1,</span>
<span class="go"> &#39;by&#39;: 1,</span>
<span class="go"> &#39;cases&#39;: 1,</span>
<span class="go"> &#39;complex&#39;: 2,</span>
<span class="go"> &#39;complicated&#39;: 1,</span>
<span class="go"> &#39;counts&#39;: 1,</span>
<span class="go"> &#39;dense&#39;: 1,</span>
<span class="go"> &#39;do&#39;: 2,</span>
<span class="go"> &#39;dutch&#39;: 1,</span>
<span class="go"> &#39;easy&#39;: 1,</span>
<span class="go"> &#39;enough&#39;: 1,</span>
<span class="go"> &#39;errors&#39;: 1,</span>
<span class="go"> &#39;explain&#39;: 2,</span>
<span class="go"> &#39;explicit&#39;: 1,</span>
<span class="go"> &#39;explicitly&#39;: 1,</span>
<span class="go"> &#39;face&#39;: 1,</span>
<span class="go"> &#39;first&#39;: 1,</span>
<span class="go"> &#39;flat&#39;: 1,</span>
<span class="go"> &#39;good&#39;: 1,</span>
<span class="go"> &#39;great&#39;: 1,</span>
<span class="go"> &#39;guess&#39;: 1,</span>
<span class="go"> &#39;hard&#39;: 1,</span>
<span class="go"> &#39;honking&#39;: 1,</span>
<span class="go"> &#39;idea&#39;: 3,</span>
<span class="go"> &#39;if&#39;: 2,</span>
<span class="go"> &#39;implementation&#39;: 2,</span>
<span class="go"> &#39;implicit&#39;: 1,</span>
<span class="go"> &#39;in&#39;: 1,</span>
<span class="go"> &#39;is&#39;: 10,</span>
<span class="go"> &#39;it&#39;: 2,</span>
<span class="go"> &#39;its&#39;: 1,</span>
<span class="go"> &#39;lets&#39;: 1,</span>
<span class="go"> &#39;may&#39;: 2,</span>
<span class="go"> &#39;more&#39;: 1,</span>
<span class="go"> &#39;namespaces&#39;: 1,</span>
<span class="go"> &#39;nested&#39;: 1,</span>
<span class="go"> &#39;never&#39;: 3,</span>
<span class="go"> &#39;not&#39;: 1,</span>
<span class="go"> &#39;now&#39;: 2,</span>
<span class="go"> &#39;obvious&#39;: 2,</span>
<span class="go"> &#39;of&#39;: 2,</span>
<span class="go"> &#39;often&#39;: 1,</span>
<span class="go"> &#39;one&#39;: 3,</span>
<span class="go"> &#39;only&#39;: 1,</span>
<span class="go"> &#39;pass&#39;: 1,</span>
<span class="go"> &#39;peters&#39;: 1,</span>
<span class="go"> &#39;practicality&#39;: 1,</span>
<span class="go"> &#39;preferably&#39;: 1,</span>
<span class="go"> &#39;purity&#39;: 1,</span>
<span class="go"> &#39;python&#39;: 1,</span>
<span class="go"> &#39;readability&#39;: 1,</span>
<span class="go"> &#39;refuse&#39;: 1,</span>
<span class="go"> &#39;right&#39;: 1,</span>
<span class="go"> &#39;rules&#39;: 1,</span>
<span class="go"> &#39;should&#39;: 2,</span>
<span class="go"> &#39;silenced&#39;: 1,</span>
<span class="go"> &#39;silently&#39;: 1,</span>
<span class="go"> &#39;simple&#39;: 1,</span>
<span class="go"> &#39;sparse&#39;: 1,</span>
<span class="go"> &#39;special&#39;: 2,</span>
<span class="go"> &#39;temptation&#39;: 1,</span>
<span class="go"> &#39;than&#39;: 8,</span>
<span class="go"> &#39;that&#39;: 1,</span>
<span class="go"> &#39;the&#39;: 5,</span>
<span class="go"> &#39;there&#39;: 1,</span>
<span class="go"> &#39;those&#39;: 1,</span>
<span class="go"> &#39;tim&#39;: 1,</span>
<span class="go"> &#39;to&#39;: 5,</span>
<span class="go"> &#39;ugly&#39;: 1,</span>
<span class="go"> &#39;unless&#39;: 2,</span>
<span class="go"> &#39;way&#39;: 2,</span>
<span class="go"> &#39;youre&#39;: 1}</span>
</pre></div>
</div>
<p>This function illustrates the pattern for recursion with an accumulator, which
is generalized in the following code.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">rec_acc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">lst</span><span class="p">:</span> <span class="n">acc</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="k">else</span> <span class="n">rec_acc</span><span class="p">(</span><span class="n">update</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">acc</span><span class="p">),</span> <span class="n">lst</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
</pre></div>
</div>
<p>The basic process is to return the accumulator <code class="docutils literal"><span class="pre">acc</span></code> if the list is empty.  If
not, we update <code class="docutils literal"><span class="pre">acc</span></code> (here with a helper function called <code class="docutils literal"><span class="pre">update</span></code>) and recur
on the updated <code class="docutils literal"><span class="pre">acc</span></code> and the rest of the list.</p>
<p>Now look for similarities between the <em>imperative</em> accumulator pattern (shown
below) and the <em>recursive</em> accumulator pattern.  Both patterns involve applying
the <em>same</em> function to <code class="docutils literal"><span class="pre">update</span></code> the accumulator for each value.  They differ
in there method of iteration, with the imperative solution using a loop and the
recursive solution recurring on the rest of the list until it has been exhausted.
Readers that are more familiar with the imperative pattern can use this
relationship to help write the <code class="docutils literal"><span class="pre">update</span></code> function, and then apply the general
pattern.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Recursive accumulator</span>
<span class="n">rec_acc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">lst</span><span class="p">:</span> <span class="n">acc</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="k">else</span> <span class="n">rec_acc</span><span class="p">(</span><span class="n">update</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">acc</span><span class="p">),</span> <span class="n">lst</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="c1"># Imperative accumulator</span>
<span class="n">acc</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">L</span><span class="p">:</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</pre></div>
</div>
<p>Like most common functional patterns, there are probably already solutions
available in some Python module.  In this case, the <code class="docutils literal"><span class="pre">toolz</span></code> package has a
function called <code class="docutils literal"><span class="pre">frequency</span></code> that performs the task of counting occurrences of
items in a sequence.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [70]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">frequencies</span>

<span class="gp">In [71]: </span><span class="n">frequencies</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="gh">Out[71]: </span><span class="go"></span>
<span class="go">{&#39;a&#39;: 2,</span>
<span class="go"> &#39;although&#39;: 3,</span>
<span class="go"> &#39;ambiguity&#39;: 1,</span>
<span class="go"> &#39;and&#39;: 1,</span>
<span class="go"> &#39;are&#39;: 1,</span>
<span class="go"> &#39;arent&#39;: 1,</span>
<span class="go"> &#39;at&#39;: 1,</span>
<span class="go"> &#39;bad&#39;: 1,</span>
<span class="go"> &#39;be&#39;: 3,</span>
<span class="go"> &#39;beats&#39;: 1,</span>
<span class="go"> &#39;beautiful&#39;: 1,</span>
<span class="go"> &#39;better&#39;: 8,</span>
<span class="go"> &#39;break&#39;: 1,</span>
<span class="go"> &#39;by&#39;: 1,</span>
<span class="go"> &#39;cases&#39;: 1,</span>
<span class="go"> &#39;complex&#39;: 2,</span>
<span class="go"> &#39;complicated&#39;: 1,</span>
<span class="go"> &#39;counts&#39;: 1,</span>
<span class="go"> &#39;dense&#39;: 1,</span>
<span class="go"> &#39;do&#39;: 2,</span>
<span class="go"> &#39;dutch&#39;: 1,</span>
<span class="go"> &#39;easy&#39;: 1,</span>
<span class="go"> &#39;enough&#39;: 1,</span>
<span class="go"> &#39;errors&#39;: 1,</span>
<span class="go"> &#39;explain&#39;: 2,</span>
<span class="go"> &#39;explicit&#39;: 1,</span>
<span class="go"> &#39;explicitly&#39;: 1,</span>
<span class="go"> &#39;face&#39;: 1,</span>
<span class="go"> &#39;first&#39;: 1,</span>
<span class="go"> &#39;flat&#39;: 1,</span>
<span class="go"> &#39;good&#39;: 1,</span>
<span class="go"> &#39;great&#39;: 1,</span>
<span class="go"> &#39;guess&#39;: 1,</span>
<span class="go"> &#39;hard&#39;: 1,</span>
<span class="go"> &#39;honking&#39;: 1,</span>
<span class="go"> &#39;idea&#39;: 3,</span>
<span class="go"> &#39;if&#39;: 2,</span>
<span class="go"> &#39;implementation&#39;: 2,</span>
<span class="go"> &#39;implicit&#39;: 1,</span>
<span class="go"> &#39;in&#39;: 1,</span>
<span class="go"> &#39;is&#39;: 10,</span>
<span class="go"> &#39;it&#39;: 2,</span>
<span class="go"> &#39;its&#39;: 1,</span>
<span class="go"> &#39;lets&#39;: 1,</span>
<span class="go"> &#39;may&#39;: 2,</span>
<span class="go"> &#39;more&#39;: 1,</span>
<span class="go"> &#39;namespaces&#39;: 1,</span>
<span class="go"> &#39;nested&#39;: 1,</span>
<span class="go"> &#39;never&#39;: 3,</span>
<span class="go"> &#39;not&#39;: 1,</span>
<span class="go"> &#39;now&#39;: 2,</span>
<span class="go"> &#39;obvious&#39;: 2,</span>
<span class="go"> &#39;of&#39;: 2,</span>
<span class="go"> &#39;often&#39;: 1,</span>
<span class="go"> &#39;one&#39;: 3,</span>
<span class="go"> &#39;only&#39;: 1,</span>
<span class="go"> &#39;pass&#39;: 1,</span>
<span class="go"> &#39;peters&#39;: 1,</span>
<span class="go"> &#39;practicality&#39;: 1,</span>
<span class="go"> &#39;preferably&#39;: 1,</span>
<span class="go"> &#39;purity&#39;: 1,</span>
<span class="go"> &#39;python&#39;: 1,</span>
<span class="go"> &#39;readability&#39;: 1,</span>
<span class="go"> &#39;refuse&#39;: 1,</span>
<span class="go"> &#39;right&#39;: 1,</span>
<span class="go"> &#39;rules&#39;: 1,</span>
<span class="go"> &#39;should&#39;: 2,</span>
<span class="go"> &#39;silenced&#39;: 1,</span>
<span class="go"> &#39;silently&#39;: 1,</span>
<span class="go"> &#39;simple&#39;: 1,</span>
<span class="go"> &#39;sparse&#39;: 1,</span>
<span class="go"> &#39;special&#39;: 2,</span>
<span class="go"> &#39;temptation&#39;: 1,</span>
<span class="go"> &#39;than&#39;: 8,</span>
<span class="go"> &#39;that&#39;: 1,</span>
<span class="go"> &#39;the&#39;: 5,</span>
<span class="go"> &#39;there&#39;: 1,</span>
<span class="go"> &#39;those&#39;: 1,</span>
<span class="go"> &#39;tim&#39;: 1,</span>
<span class="go"> &#39;to&#39;: 5,</span>
<span class="go"> &#39;ugly&#39;: 1,</span>
<span class="go"> &#39;unless&#39;: 2,</span>
<span class="go"> &#39;way&#39;: 2,</span>
<span class="go"> &#39;youre&#39;: 1}</span>
</pre></div>
</div>
</div>
<div class="section" id="counting-frequencies-using-a-key-function">
<h2>7.6.4. Counting Frequencies Using a Key Function<a class="headerlink" href="#counting-frequencies-using-a-key-function" title="Permalink to this headline">¶</a></h2>
<p>There is a pattern similar to <code class="docutils literal"><span class="pre">frequencies</span></code>, but a bit more general, is
<strong>countby</strong>.  Instead of counting frequencies of the raw data, we will first
transform the data with a key function, then count the occurrences of these
values.  There is a restriction on the key-function, it must return an immutable
object that can be used as a key in a dictionary.</p>
<p>Returning to the Zen of Python, this time we will count the number of words by
length, that is count how many words are in the text for each word length
present.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [72]: </span><span class="n">zen_no_punc</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="gp">   ....: </span><span class="s1">The Zen of Python by Tim Peters</span>
<span class="gp">   ....: </span><span class="s1">Beautiful is better than ugly</span>
<span class="gp">   ....: </span><span class="s1">Explicit is better than implicit</span>
<span class="gp">   ....: </span><span class="s1">Simple is better than complex</span>
<span class="gp">   ....: </span><span class="s1">Complex is better than complicated</span>
<span class="gp">   ....: </span><span class="s1">Flat is better than nested</span>
<span class="gp">   ....: </span><span class="s1">Sparse is better than dense</span>
<span class="gp">   ....: </span><span class="s1">Readability counts</span>
<span class="gp">   ....: </span><span class="s1">Special cases arent special enough to break the rules</span>
<span class="gp">   ....: </span><span class="s1">Although practicality beats purity</span>
<span class="gp">   ....: </span><span class="s1">Errors should never pass silently</span>
<span class="gp">   ....: </span><span class="s1">Unless explicitly silenced</span>
<span class="gp">   ....: </span><span class="s1">In the face of ambiguity refuse the temptation to guess</span>
<span class="gp">   ....: </span><span class="s1">There should be one and preferably only one obvious way to do it</span>
<span class="gp">   ....: </span><span class="s1">Although that way may not be obvious at first unless youre Dutch</span>
<span class="gp">   ....: </span><span class="s1">Now is better than never</span>
<span class="gp">   ....: </span><span class="s1">Although never is often better than right now</span>
<span class="gp">   ....: </span><span class="s1">If the implementation is hard to explain its a bad idea</span>
<span class="gp">   ....: </span><span class="s1">If the implementation is easy to explain it may be a good idea</span>
<span class="gp">   ....: </span><span class="s1">Namespaces are one honking great idea  lets do more of those&#39;&#39;&#39;</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>We start with the imperative approach, which will again use the accumulator
pattern to update a dictionary as we iterate through the sequence.  The added
wrinkle is using a key-function, in this case <code class="docutils literal"><span class="pre">len</span></code> on each element before we
update the dictionary.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [73]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">assoc</span>

<span class="gp">In [74]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">zen_no_punc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="gp">In [75]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [76]: </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">update_count</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">),</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">   ....: </span>    <span class="n">counts</span> <span class="o">=</span> <span class="n">assoc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">),</span> <span class="n">update_count</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [77]: </span><span class="n">counts</span>
<span class="gh">Out[77]: </span><span class="go"></span>
<span class="go">{1: 2,</span>
<span class="go"> 2: 30,</span>
<span class="go"> 3: 22,</span>
<span class="go"> 4: 22,</span>
<span class="go"> 5: 18,</span>
<span class="go"> 6: 22,</span>
<span class="go"> 7: 9,</span>
<span class="go"> 8: 7,</span>
<span class="go"> 9: 2,</span>
<span class="go"> 10: 4,</span>
<span class="go"> 11: 2,</span>
<span class="go"> 12: 1,</span>
<span class="go"> 14: 2}</span>
</pre></div>
</div>
<p>To clean this example up and illustrate the main pattern, we again make some
helper functions for updating the counts and updating the count dictionary.  The
only difference between these functions and those from the earlier sections is</p>
<ol class="arabic simple">
<li>We have changed the parameter name to indicate that we are counting lengths
here.</li>
<li>We need to apply the length function before updating the dictionary. In
anticipation of a more general pattern, we will pass the length function to
<code class="docutils literal"><span class="pre">update_dict</span></code> through a parameter named <code class="docutils literal"><span class="pre">key</span></code>.</li>
</ol>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [78]: </span><span class="n">update_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">length</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="gp">In [79]: </span><span class="n">update_dict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">,</span> <span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">key</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span> <span class="n">update_count</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span> <span class="n">cnts</span><span class="p">))</span>

<span class="gp">In [80]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [81]: </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [82]: </span><span class="n">counts</span>
<span class="gh">Out[82]: </span><span class="go"></span>
<span class="go">{1: 2,</span>
<span class="go"> 2: 30,</span>
<span class="go"> 3: 22,</span>
<span class="go"> 4: 22,</span>
<span class="go"> 5: 18,</span>
<span class="go"> 6: 22,</span>
<span class="go"> 7: 9,</span>
<span class="go"> 8: 7,</span>
<span class="go"> 9: 2,</span>
<span class="go"> 10: 4,</span>
<span class="go"> 11: 2,</span>
<span class="go"> 12: 1,</span>
<span class="go"> 14: 2}</span>
</pre></div>
</div>
<p>As noted above, the same update function can be used to both the imperative and
recursive solution.  The presence of the <code class="docutils literal"><span class="pre">key</span></code> parameter in the update
function means that we will also make this a parameter in the recursive function
so that it can be passed along from call to call.  Finally, we write a wrapper
function called <code class="docutils literal"><span class="pre">countby</span></code> that calls <code class="docutils literal"><span class="pre">countby_rec</span></code>, thus hiding the need for
the accumulator from the user.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [83]: </span><span class="kn">from</span> <span class="nn">pyrsistent</span> <span class="kn">import</span> <span class="n">plist</span>

<span class="gp">In [84]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">plist</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

<span class="gp">In [85]: </span><span class="n">countby_rec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">lst</span><span class="p">:</span> <span class="n">acc</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="k">else</span> <span class="n">countby_rec</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">lst</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">acc</span><span class="p">),</span> <span class="n">lst</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="gp">In [86]: </span><span class="n">countby</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">,</span> <span class="n">lst</span><span class="p">:</span> <span class="n">countby_rec</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{},</span> <span class="n">lst</span><span class="p">)</span>

<span class="gp">In [87]: </span><span class="n">countby</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
<span class="gh">Out[87]: </span><span class="go"></span>
<span class="go">{1: 2,</span>
<span class="go"> 2: 30,</span>
<span class="go"> 3: 22,</span>
<span class="go"> 4: 22,</span>
<span class="go"> 5: 18,</span>
<span class="go"> 6: 22,</span>
<span class="go"> 7: 9,</span>
<span class="go"> 8: 7,</span>
<span class="go"> 9: 2,</span>
<span class="go"> 10: 4,</span>
<span class="go"> 11: 2,</span>
<span class="go"> 12: 1,</span>
<span class="go"> 14: 2}</span>
</pre></div>
</div>
<p>Now that we understand the <code class="docutils literal"><span class="pre">countby</span></code> pattern, there is not reason to have to
implement it again, and in fact, this function is also available in the
<code class="docutils literal"><span class="pre">toolz</span></code> module.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [88]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">countby</span>

<span class="gp">In [89]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">zen_no_punc</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="gp">In [90]: </span><span class="n">countby</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
<span class="gh">Out[90]: </span><span class="go"></span>
<span class="go">{1: 2,</span>
<span class="go"> 2: 30,</span>
<span class="go"> 3: 22,</span>
<span class="go"> 4: 22,</span>
<span class="go"> 5: 18,</span>
<span class="go"> 6: 22,</span>
<span class="go"> 7: 9,</span>
<span class="go"> 8: 7,</span>
<span class="go"> 9: 2,</span>
<span class="go"> 10: 4,</span>
<span class="go"> 11: 2,</span>
<span class="go"> 12: 1,</span>
<span class="go"> 14: 2}</span>
</pre></div>
</div>
<p>On final note about <code class="docutils literal"><span class="pre">countby</span></code>.  To see that <code class="docutils literal"><span class="pre">countby</span></code> is generalization of
<code class="docutils literal"><span class="pre">frequencies</span></code>, we note that using the <code class="docutils literal"><span class="pre">identity</span></code> function with <code class="docutils literal"><span class="pre">countby</span></code>
is equivalent to <code class="docutils literal"><span class="pre">frequencies</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [91]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">countby</span><span class="p">,</span> <span class="n">identity</span>

<span class="gp">In [92]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">zen_no_punc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="gp">In [93]: </span><span class="n">countby</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
<span class="gh">Out[93]: </span><span class="go"></span>
<span class="go">{&#39;a&#39;: 2,</span>
<span class="go"> &#39;although&#39;: 3,</span>
<span class="go"> &#39;ambiguity&#39;: 1,</span>
<span class="go"> &#39;and&#39;: 1,</span>
<span class="go"> &#39;are&#39;: 1,</span>
<span class="go"> &#39;arent&#39;: 1,</span>
<span class="go"> &#39;at&#39;: 1,</span>
<span class="go"> &#39;bad&#39;: 1,</span>
<span class="go"> &#39;be&#39;: 3,</span>
<span class="go"> &#39;beats&#39;: 1,</span>
<span class="go"> &#39;beautiful&#39;: 1,</span>
<span class="go"> &#39;better&#39;: 8,</span>
<span class="go"> &#39;break&#39;: 1,</span>
<span class="go"> &#39;by&#39;: 1,</span>
<span class="go"> &#39;cases&#39;: 1,</span>
<span class="go"> &#39;complex&#39;: 2,</span>
<span class="go"> &#39;complicated&#39;: 1,</span>
<span class="go"> &#39;counts&#39;: 1,</span>
<span class="go"> &#39;dense&#39;: 1,</span>
<span class="go"> &#39;do&#39;: 2,</span>
<span class="go"> &#39;dutch&#39;: 1,</span>
<span class="go"> &#39;easy&#39;: 1,</span>
<span class="go"> &#39;enough&#39;: 1,</span>
<span class="go"> &#39;errors&#39;: 1,</span>
<span class="go"> &#39;explain&#39;: 2,</span>
<span class="go"> &#39;explicit&#39;: 1,</span>
<span class="go"> &#39;explicitly&#39;: 1,</span>
<span class="go"> &#39;face&#39;: 1,</span>
<span class="go"> &#39;first&#39;: 1,</span>
<span class="go"> &#39;flat&#39;: 1,</span>
<span class="go"> &#39;good&#39;: 1,</span>
<span class="go"> &#39;great&#39;: 1,</span>
<span class="go"> &#39;guess&#39;: 1,</span>
<span class="go"> &#39;hard&#39;: 1,</span>
<span class="go"> &#39;honking&#39;: 1,</span>
<span class="go"> &#39;idea&#39;: 3,</span>
<span class="go"> &#39;if&#39;: 2,</span>
<span class="go"> &#39;implementation&#39;: 2,</span>
<span class="go"> &#39;implicit&#39;: 1,</span>
<span class="go"> &#39;in&#39;: 1,</span>
<span class="go"> &#39;is&#39;: 10,</span>
<span class="go"> &#39;it&#39;: 2,</span>
<span class="go"> &#39;its&#39;: 1,</span>
<span class="go"> &#39;lets&#39;: 1,</span>
<span class="go"> &#39;may&#39;: 2,</span>
<span class="go"> &#39;more&#39;: 1,</span>
<span class="go"> &#39;namespaces&#39;: 1,</span>
<span class="go"> &#39;nested&#39;: 1,</span>
<span class="go"> &#39;never&#39;: 3,</span>
<span class="go"> &#39;not&#39;: 1,</span>
<span class="go"> &#39;now&#39;: 2,</span>
<span class="go"> &#39;obvious&#39;: 2,</span>
<span class="go"> &#39;of&#39;: 3,</span>
<span class="go"> &#39;often&#39;: 1,</span>
<span class="go"> &#39;one&#39;: 3,</span>
<span class="go"> &#39;only&#39;: 1,</span>
<span class="go"> &#39;pass&#39;: 1,</span>
<span class="go"> &#39;peters&#39;: 1,</span>
<span class="go"> &#39;practicality&#39;: 1,</span>
<span class="go"> &#39;preferably&#39;: 1,</span>
<span class="go"> &#39;purity&#39;: 1,</span>
<span class="go"> &#39;python&#39;: 1,</span>
<span class="go"> &#39;readability&#39;: 1,</span>
<span class="go"> &#39;refuse&#39;: 1,</span>
<span class="go"> &#39;right&#39;: 1,</span>
<span class="go"> &#39;rules&#39;: 1,</span>
<span class="go"> &#39;should&#39;: 2,</span>
<span class="go"> &#39;silenced&#39;: 1,</span>
<span class="go"> &#39;silently&#39;: 1,</span>
<span class="go"> &#39;simple&#39;: 1,</span>
<span class="go"> &#39;sparse&#39;: 1,</span>
<span class="go"> &#39;special&#39;: 2,</span>
<span class="go"> &#39;temptation&#39;: 1,</span>
<span class="go"> &#39;than&#39;: 8,</span>
<span class="go"> &#39;that&#39;: 1,</span>
<span class="go"> &#39;the&#39;: 6,</span>
<span class="go"> &#39;there&#39;: 1,</span>
<span class="go"> &#39;those&#39;: 1,</span>
<span class="go"> &#39;tim&#39;: 1,</span>
<span class="go"> &#39;to&#39;: 5,</span>
<span class="go"> &#39;ugly&#39;: 1,</span>
<span class="go"> &#39;unless&#39;: 2,</span>
<span class="go"> &#39;way&#39;: 2,</span>
<span class="go"> &#39;youre&#39;: 1,</span>
<span class="go"> &#39;zen&#39;: 1}</span>
</pre></div>
</div>
</div>
</div>


  
      
  <li id="relations-prev" class="navLink" title='Previous Section - 7.5. Other Examples of Higher Order Functions' data-toggle="tooltip">
    <a href="OtherExamplesOfHigherOrderFunctions.html" >
      <i class='prevNav glyphicon glyphicon-chevron-left'></i>
    </a>
  </li>
  <a class="navLinkBg" id="navLinkBgLeft"  href="OtherExamplesOfHigherOrderFunctions.html" ></a>
  
  <li id="relations-next" class="navLink" title='Next Section - 7.7. Lazy Iteration' data-toggle="tooltip" >
    <a href="LazyIteration.html" >
      <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right'></i>
    </a>
  </li>
  <a class="navLinkBg navLink" id="navLinkBgRight" href="LazyIteration.html" >Next Section - 7.7. Lazy Iteration</a>

<script type="text/javascript">

  $('#relations-prev').tooltip({'placement':'right', 'selector': '', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement':'left', 'selector': '', 'delay': { show: 100, hide: 50}});
  
</script>
  
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      
      | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017 Todd Iverson.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
    </p>
  </div>
</footer>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32029811-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>