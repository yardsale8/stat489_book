<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2.3. Expressions, Values and Evaluation &mdash; Runestone Interactive Overview</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/activecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/clickable.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pytutor.css" type="text/css" />
    <link rel="stylesheet" href="../_static/modal-basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/datafile.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dragndrop.css" type="text/css" />
    <link rel="stylesheet" href="../_static/fitb.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/livecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/parsons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/lib/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/poll.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tabbedstuff.css" type="text/css" />
    <link rel="stylesheet" href="../_static/video.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.1/""/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/jquery-ui-1.10.3.custom.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/user-highlights.css" type="text/css" />
    <link rel="stylesheet" href="../_static/runestone-custom-sphinx-bootstrap.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/runestonebase.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.highlight.js"></script>
    <script type="text/javascript" src="../_static/bookfuncs.js"></script>
    <script type="text/javascript" src="../_static/codemirror.js"></script>
    <script type="text/javascript" src="../_static/xml.js"></script>
    <script type="text/javascript" src="../_static/css.js"></script>
    <script type="text/javascript" src="../_static/htmlmixed.js"></script>
    <script type="text/javascript" src="../_static/python.js"></script>
    <script type="text/javascript" src="../_static/javascript.js"></script>
    <script type="text/javascript" src="../_static/activecode.js"></script>
    <script type="text/javascript" src="../_static/skulpt.min.js"></script>
    <script type="text/javascript" src="../_static/skulpt-stdlib.js"></script>
    <script type="text/javascript" src="../_static/clike.js"></script>
    <script type="text/javascript" src="../_static/timed_activecode.js"></script>
    <script type="text/javascript" src="../_static/animationbase.js"></script>
    <script type="text/javascript" src="../_static/mchoice.js"></script>
    <script type="text/javascript" src="../_static/timedmc.js"></script>
    <script type="text/javascript" src="../_static/timed.js"></script>
    <script type="text/javascript" src="../_static/clickable.js"></script>
    <script type="text/javascript" src="../_static/timedclickable.js"></script>
    <script type="text/javascript" src="../_static/d3.v2.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.ba-bbq.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.jsPlumb-1.3.10-all-min.js"></script>
    <script type="text/javascript" src="../_static/pytutor.js"></script>
    <script type="text/javascript" src="../_static/codelens.js"></script>
    <script type="text/javascript" src="../_static/skulpt.min.js"></script>
    <script type="text/javascript" src="../_static/skulpt-stdlib.js"></script>
    <script type="text/javascript" src="../_static/datafile.js"></script>
    <script type="text/javascript" src="../_static/dragndrop.js"></script>
    <script type="text/javascript" src="../_static/timeddnd.js"></script>
    <script type="text/javascript" src="../_static/fitb.js"></script>
    <script type="text/javascript" src="../_static/timedfitb.js"></script>
    <script type="text/javascript" src="../_static/livecode.js"></script>
    <script type="text/javascript" src="../_static/clike.js"></script>
    <script type="text/javascript" src="../_static/lib/prettify.js"></script>
    <script type="text/javascript" src="../_static/lib/hammer.min.js"></script>
    <script type="text/javascript" src="../_static/parsons.js"></script>
    <script type="text/javascript" src="../_static/timedparsons.js"></script>
    <script type="text/javascript" src="../_static/poll.js"></script>
    <script type="text/javascript" src="../_static/reveal.js"></script>
    <script type="text/javascript" src="../_static/shortanswer.js"></script>
    <script type="text/javascript" src="../_static/timed_shortanswer.js"></script>
    <script type="text/javascript" src="../_static/tabbedstuff.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <link rel="top" title="Runestone Interactive Overview" href="../index.html" />
    <link rel="up" title="2. Expressions and Evaluation" href="toctree2.html" />
    <link rel="next" title="2.4. Statements: When Expressions Are Not Enough" href="StatementsWhenExpressionsAreNotEnough.html" />
    <link rel="prev" title="2.2. Saving Expressions for Later Execution - The lambda Expression" href="SavingExpressionsForLaterExecution.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<link rel="shortcut icon" href="/runestone/static/favicon.ico" type="image/ico" />

<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = 'http://127.0.0.1:8000' ? 'http://127.0.0.1:8000' : 'http://127.0.0.1:8000';
  eBookConfig.app = eBookConfig.host+'/runestone';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = 'STAT489';
  eBookConfig.logLevel = 0;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.isLoggedIn = false;
  eBookConfig.useRunestoneServices = false;
  eBookConfig.python3 = true;
  eBookConfig.basecourse = 'STAT489';
</script>

<div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&status=0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>



  </head>
  <body role="document">


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        <a class="brand-logo" style='background: transparent url("../_static/img/logo_small.png") no-repeat 0px 0px;' href="/runestone/default/user/login">&nbsp; </a>
        <a class="navbar-brand" href="../index.html">STAT489</a>
      </div>
    </div>

    <div class="navbar-collapse collapse navbar-ex1-collapse">

      <ul class="nav navbar-nav navbar-right">

        <li class="divider-vertical"></li>

        <!-- social media dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-share-alt" style="opacity: 0.9"></i>
          </a>
          <ul class="dropdown-menu social-menu">
              <li>
                <div>
                  <b>Runestone in social media:</b>
                </div>
                <a href="https://twitter.com/iRunestone" class="twitter-follow-button" data-show-count="true">Follow @iRunestone</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="fb-like" data-href="https://www.facebook.com/RunestoneInteractive" data-send="false" data-layout="button_count" data-width="300" data-show-faces="false" data-font="arial"></div>
              </li>

              <li class="divider"></li>
              <li>
                <div>
                  <b>Help support us:</b>
                </div>
                <div>
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                  <input type="hidden" name="cmd" value="_s-xclick">
                  <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHNwYJKoZIhvcNAQcEoIIHKDCCByQCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYAcrkqh1hn3lYqIpfXxNqe1T82EhXzCJGy1yMAmklpyZshyMkfDGe1Bhx+iwyGeoYRTTyphFmP+9M3NyO0+Q5XdHxgZPx/zYjjBxlZHgEV6jhE8bN2fHkkPf0VHfz0a0QQylQOPlKiOTZV7B37Jpk6yM47oVZ1tG/KNm0NkfmB76DELMAkGBSsOAwIaBQAwgbQGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIi0GmFfOlcjuAgZBbYOo9UO+CpMQa+PYqwsUmUnJvXIImeMeNI3KVTUx5Cfk9gNMo3WzPeiB5IqZo9nRAQ0mf1qL2ecLeB5tidM+lgBUhOxfj3/FecpnVFa0263gp4g+PLw8jzhvVRdUon1K3SeO1Rzh23fIRKwnrD6btt73uwtj0sl3tGd8qz+6GIcwPDdRk9VcUffiBJT/ZagKgggOHMIIDgzCCAuygAwIBAgIBADANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wHhcNMDQwMjEzMTAxMzE1WhcNMzUwMjEzMTAxMzE1WjCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMFHTt38RMxLXJyO2SmS+Ndl72T7oKJ4u4uw+6awntALWh03PewmIJuzbALScsTS4sZoS1fKciBGoh11gIfHzylvkdNe/hJl66/RGqrj5rFb08sAABNTzDTiqqNpJeBsYs/c2aiGozptX2RlnBktH+SUNpAajW724Nv2Wvhif6sFAgMBAAGjge4wgeswHQYDVR0OBBYEFJaffLvGbxe9WT9S1wob7BDWZJRrMIG7BgNVHSMEgbMwgbCAFJaffLvGbxe9WT9S1wob7BDWZJRroYGUpIGRMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbYIBADAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIFfOlaagFrl71+jq6OKidbWFSE+Q4FqROvdgIONth+8kSK//Y/4ihuE4Ymvzn5ceE3S/iBSQQMjyvb+s2TWbQYDwcp129OPIbD9epdr4tJOUNiSojw7BHwYRiPh58S1xGlFgHFXwrEBb3dgNbMUa+u4qectsMAXpVHnD9wIyfmHMYIBmjCCAZYCAQEwgZQwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tAgEAMAkGBSsOAwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xMzExMDMxMzQxMzFaMCMGCSqGSIb3DQEJBDEWBBRDJF8w+zsMr7FSk+pwinB5f5D4rzANBgkqhkiG9w0BAQEFAASBgHw1LMHpkpaqHIvDGdFE0eG+2mZlmMnUeDCBhQlbc7QMzFQYKTV94NfaebBO4PmNdADe1rq4WidSRZZbE7CzkX9IGENYnBTWY0hb2l0lGdGrJdGeWyV3ekg9WVaFMMumrekds96h3Cx7dGz2kWDzIai2iEXE/qoE+xpkyXAYZNV3-----END PKCS7-----
                  ">
                  <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                  <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                  </form>

                </div>
              </li>
          </ul>
        </li>
        <!-- end social media dropdown -->

        <li class="divider-vertical"></li>

        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html'>Table of Contents</a></li>
            
            <li><a href='/runestone/static/STAT489/genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li id="scratch_ac_link"><a href="javascript:ACFactory.toggleScratchActivecode()">Scratch ActiveCode</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        
        <li class="divider-vertical"></li>

        <!-- help menu dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-question-sign" style="opacity:0.9;"></i>
          </a>
          <ul class="dropdown-menu user-menu">
            <li><a href='/runestone/static/STAT489/navhelp.html'>Navigation Help</a></li>
            <li><a href='/runestone/static/overview/instructor.html'>Help for Instructors</a></li>
            <li class="divider"></li>
            <li><a href='http://runestoneinteractive.org'>About Runestone</a></li>
            <li><a href='/runestone/default/reportabug?course=STAT489&page=ExpressionsValuesAndEvaluation'>Report A Problem</a></li>
          </ul>
        </li>
        <!-- end help menu dropdown -->

        <li class="divider-vertical"></li>

      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        <!--
          <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">2.3. Expressions, Values and Evaluation</a><ul>
<li><a class="reference internal" href="#what-is-evaluation">2.3.1. What is Evaluation?</a></li>
<li><a class="reference internal" href="#lambda-expressions-and-closures">2.3.2. Lambda Expressions and Closures</a></li>
<li><a class="reference internal" href="#closure-creation-and-the-resolution-of-global-and-local-variables">2.3.3. Closure creation and the resolution of global and local variables</a></li>
<li><a class="reference internal" href="#variable-scope-and-substitution">2.3.4. Variable Scope and Substitution</a></li>
<li><a class="reference internal" href="#evaluation-strategy">2.3.5. Evaluation Strategy</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          <li class="divider-vertical"></li>
        
        
          
  <li id="relations-prev" title="Previous Chapter - 2.2. Saving Expressions for Later Execution - The <cite>lambda</cite> Expression" data-toggle="tooltip">
    <a href="SavingExpressionsForLaterExecution.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - 2.4. Statements: When Expressions Are Not Enough' data-toggle="tooltip" >
    <a href="StatementsWhenExpressionsAreNotEnough.html" >
      <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script type="text/javascript">
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  $('#relations-prev').tooltip(opts);
  $('#relations-next').tooltip(opts);
</script>
        -->
        
          <li></li>
        
      </ul>

    </div>
  </div>
</div>


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content">
  
  <div class="section" id="expressions-values-and-evaluation">
<h1>2.3. Expressions, Values and Evaluation<a class="headerlink" href="#expressions-values-and-evaluation" title="Permalink to this headline">¶</a></h1>
<p>The focus of this chapter has been using expressions in python to perform
computations.  We have seen that we can use <code class="docutils literal"><span class="pre">lambda</span></code> expressions  to save
expressions for later computation and the conditional expression to decide
branch between two expressions depending on some condition.</p>
<p>Here is an outline of a formal definition the expressions seen so far.</p>
<div class="admonition-definition-of-expressions-so-far admonition">
<p class="first admonition-title">Definition of Expressions (so far)</p>
<p>An <strong>expression</strong> (EXPR for short) consists of</p>
<ol class="last arabic simple">
<li><strong>values:</strong> 5, &#8220;1&#8221;, True, ...</li>
<li><strong>operations:</strong> EXPR1 OP EXPR2, where OP is any operator (+, -, and, ==, etc.)</li>
<li><strong>conditional expressions:</strong> EXPR1 if EXPR2 else EXPR3</li>
<li><strong>lambda expressions:</strong> lambda VAR: EXPR (special type of value)</li>
<li><strong>function application:</strong> EXPR(EXPR)</li>
</ol>
</div>
<p>This is an example of a <strong>recursive definition</strong> as we are using the term being
defined (expression or EXPR) as part of the definition.  Recursive definitions
lead to structures that can be thought of as a <strong>tree</strong>, and in the case of our
expressions, the end of every branch in the tree will be a value.</p>
<p>At this point, you may be wondering why there is so much focus on expressions.
Expressions are the building blocks for functional programs and using the right
expressions can lead to programs that are easier to understand.  In particular,
part of a program is <strong>referentially transparent</strong> if it can be replaced with
it&#8217;s value without changing the meaning of the progra, making it easier to
understand.  Expressions constructed out of lambda expressions, conditional
expressions and operations will be <em>referentially transparent</em>.</p>
<p>For example, the expression <code class="docutils literal"><span class="pre">1+1</span></code> is referentially transparent, because it can
be replaced with its value <code class="docutils literal"><span class="pre">2</span></code> without changing the program in any way.  On
the other hand, a call to the <code class="docutils literal"><span class="pre">print</span></code> function is <strong>not</strong> referentially
transparent.  <code class="docutils literal"><span class="pre">print</span></code> is an example of a <strong>void</strong> function, a function that
returns no (meaningful) value.  In Python, all functions actually return
something and void functions return <code class="docutils literal"><span class="pre">None</span></code>, a special value that stands in for
<em>nothing</em>.  We can verify that <code class="docutils literal"><span class="pre">print</span></code> returns <code class="docutils literal"><span class="pre">None</span></code> using the <code class="docutils literal"><span class="pre">is</span></code>
comparison.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;Hi&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">Hi</span>
<span class="gh">Out[1]: </span><span class="go">True</span>
</pre></div>
</div>
<p>The problem with <code class="docutils literal"><span class="pre">print</span></code>, in terms of referential transparency, is that it is
<em>side-effecting</em>.  For our purposes, a <strong>side-effect</strong> is any effect of a
function that can&#8217;t be determined looking at the input and output.  In the case
of <code class="docutils literal"><span class="pre">print</span></code>, the side effect is printing some text to the screen.  Replacing a
<code class="docutils literal"><span class="pre">print</span></code> function with its value of <code class="docutils literal"><span class="pre">None</span></code> clearly changes the <code class="docutils literal"><span class="pre">Hello</span>
<span class="pre">World</span></code> program, illustrating the fact that <code class="docutils literal"><span class="pre">print</span></code> is not referentially
transparent.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
<span class="go">Hello World</span>

<span class="go"># Replace print with its value None</span>
<span class="gp">In [3]: </span><span class="bp">None</span>

<span class="go"># Not the same program!</span>
</pre></div>
</div>
<div class="section" id="what-is-evaluation">
<h2>2.3.1. What is Evaluation?<a class="headerlink" href="#what-is-evaluation" title="Permalink to this headline">¶</a></h2>
<p>When we type an expression into the Python (or IPython) interpreter, it is
converted to a value.  The process of converting expressions to values is called
<strong>evaluation</strong>.</p>
<p>Evaluation of values and operations is fairly obvious.  The result of evaluating
a value is that value. The evaluation of an operation such as <code class="docutils literal"><span class="pre">EXPR</span> <span class="pre">=</span> <span class="pre">EXPR1</span> <span class="pre">OP</span>
<span class="pre">EXPR2</span></code> is also easy to understand.  We simply follow our order of operation by
evaluating <code class="docutils literal"><span class="pre">EXPR1</span></code> and <code class="docutils literal"><span class="pre">EXPR2</span></code>, then apply the operation to the resulting
values.</p>
<p>To understand the evaluation of lambda expressions, we will need to understand
two related topics: <em>closures</em> and <em>the scope of a variable.</em></p>
</div>
<div class="section" id="lambda-expressions-and-closures">
<h2>2.3.2. Lambda Expressions and Closures<a class="headerlink" href="#lambda-expressions-and-closures" title="Permalink to this headline">¶</a></h2>
<p>The lambda expressions that we created so far have been pretty simple.  Note
that the body of a lambda expression is also an expression. Consequently lambda
expressions can be embedded in the body of another lambda expression.  For
example, another way to generalize the <code class="docutils literal"><span class="pre">apply_tax</span></code> function is to create
another function <code class="docutils literal"><span class="pre">make_apply_tax</span></code> that takes the tax rate as input and returns
a lambda expression that uses this rate.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">make_apply_tax</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">rate</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">cost</span><span class="p">:</span> <span class="n">rate</span><span class="o">*</span><span class="n">cost</span>
</pre></div>
</div>
<p>We have created a function that returns another function.  Such a function is
called a <em>higher-order function</em> and we will look at these types of function in
more depth in a later chapter.  The <code class="docutils literal"><span class="pre">make_apply_tax</span></code> function is a
<em>function factory</em>, used to create specialize functions.  When working on a
specific example, we will call <code class="docutils literal"><span class="pre">make_apply_tax</span></code> to create a specialized
version of <code class="docutils literal"><span class="pre">apply_tax</span></code> for that problem.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">rate</span> <span class="o">=</span> <span class="mf">1.065</span>

<span class="gp">In [6]: </span><span class="n">apply_tax</span> <span class="o">=</span> <span class="n">make_apply_tax</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>

<span class="gp">In [7]: </span><span class="nb">type</span><span class="p">(</span><span class="n">apply_tax</span><span class="p">)</span>
<span class="gh">Out[7]: </span><span class="go">function</span>

<span class="gp">In [8]: </span><span class="n">apply_tax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">                 Out[8]: 1.065</span>

<span class="gp">In [9]: </span><span class="n">apply_tax</span><span class="p">(</span><span class="mf">4.55</span><span class="p">)</span>
<span class="go">                               Out[9]: 4.84575</span>
</pre></div>
</div>
<p>Let&#8217;s examine this program in codelens.</p>

<div class="alert alert-warning cd_section">
<div id="closures1"></div>
<p class="cl_caption"><span class="cl_caption_text"> (closures1)</span> </p>
</div>
<script type="text/javascript">
var closures1_trace = {"code": "make_apply_tax = lambda rate: lambda cost: rate*cost\nrate = 1.065\napply_tax = make_apply_tax(rate)\na = apply_tax(1)\nb = apply_tax(4.55)", "trace": [{"globals": {}, "stdout": "", "line": 1, "ordered_globals": [], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"make_apply_tax": ["REF", 1]}, "stdout": "", "line": 2, "ordered_globals": ["make_apply_tax"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null]}, "event": "step_line"}, {"globals": {"make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 3, "ordered_globals": ["make_apply_tax", "rate"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null]}, "event": "step_line"}, {"globals": {"make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "rate"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"rate": 1.065}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1", "ordered_varnames": ["rate"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null]}, "event": "call"}, {"globals": {"make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "rate"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"rate": 1.065}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1", "ordered_varnames": ["rate"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null]}, "event": "step_line"}, {"globals": {"make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "rate"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "return"}, {"globals": {"apply_tax": ["REF", 2], "make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 4, "ordered_globals": ["make_apply_tax", "rate", "apply_tax"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "step_line"}, {"globals": {"apply_tax": ["REF", 2], "make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "rate", "apply_tax"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"cost": 1}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2", "ordered_varnames": ["cost"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "call"}, {"globals": {"apply_tax": ["REF", 2], "make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "rate", "apply_tax"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"cost": 1}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2", "ordered_varnames": ["cost"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "step_line"}, {"globals": {"apply_tax": ["REF", 2], "make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "rate", "apply_tax"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"__return__": 1.065, "cost": 1}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2", "ordered_varnames": ["cost", "__return__"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "return"}, {"globals": {"a": 1.065, "apply_tax": ["REF", 2], "make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 5, "ordered_globals": ["make_apply_tax", "rate", "apply_tax", "a"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "step_line"}, {"globals": {"a": 1.065, "apply_tax": ["REF", 2], "make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "rate", "apply_tax", "a"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"cost": 4.55}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f3", "ordered_varnames": ["cost"], "frame_id": 3, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "call"}, {"globals": {"a": 1.065, "apply_tax": ["REF", 2], "make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "rate", "apply_tax", "a"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"cost": 4.55}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f3", "ordered_varnames": ["cost"], "frame_id": 3, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "step_line"}, {"globals": {"a": 1.065, "apply_tax": ["REF", 2], "make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "rate", "apply_tax", "a"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"__return__": 4.8457, "cost": 4.55}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f3", "ordered_varnames": ["cost", "__return__"], "frame_id": 3, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "return"}, {"globals": {"a": 1.065, "apply_tax": ["REF", 2], "b": 4.8457, "make_apply_tax": ["REF", 1], "rate": 1.065}, "stdout": "", "line": 5, "ordered_globals": ["make_apply_tax", "rate", "apply_tax", "a", "b"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.065}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "return"}]};
var closures1_vis;

$(document).ready(function() {
    try {
        closures1_vis = new ExecutionVisualizer('closures1',closures1_trace,
                                    {embeddedMode: false,
                                    verticalStack: false,
                                    heightChangeCallback: redrawAllVisualizerArrows,
                                    codeDivWidth: 500,
                                    lang : 'py3'
                                    });
        attachLoggers(closures1_vis,'closures1');
        styleButtons('closures1');
        allVisualizers.push(closures1_vis);
    } catch (e) {
        console.log("Failed to Initialize CodeLens component closures1_vis" );
        console.log(e.toString());
    }

});

$(document).ready(function() {
    $("#closures1_tracecheck").click(function() {
        logBookEvent({'event':'codelens', 'act': 'check', 'div_id':'closures1'});
    });
});

if (allVisualizers === undefined) {
   var allVisualizers = [];
}


$(window).resize(function() {
    if (closures1_vis) {
        closures1_vis.redrawConnectors();
    }
});
</script>
<p>Step through the program until line 3 is evaluated (steps 4 through 7).  Notice
that the <code class="docutils literal"><span class="pre">apply_tax</span></code> function is saved as <code class="docutils literal"><span class="pre">f1</span></code>.  Moreover, the function
<code class="docutils literal"><span class="pre">apply_tax</span></code> is bundled with the <em>specific</em> value of rate (1.065) used at the
time of creation.  This is an example of a <strong>closure</strong>, where a function bundled
the outside values that it references.</p>
<p>Designing functions as closures allows us to create multiple versions of
<code class="docutils literal"><span class="pre">apply_tax</span></code> simultaneously.</p>

<div class="alert alert-warning cd_section">
<div id="closures2"></div>
<p class="cl_caption"><span class="cl_caption_text"> (closures2)</span> </p>
</div>
<script type="text/javascript">
var closures2_trace = {"code": "make_apply_tax = lambda rate: lambda cost: rate*cost\napply_tax1 = make_apply_tax(1.05)\napply_tax2 = make_apply_tax(1.10)\na = apply_tax1(1)\nb = apply_tax2(1)", "trace": [{"globals": {}, "stdout": "", "line": 1, "ordered_globals": [], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"make_apply_tax": ["REF", 1]}, "stdout": "", "line": 2, "ordered_globals": ["make_apply_tax"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null]}, "event": "step_line"}, {"globals": {"make_apply_tax": ["REF", 1]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"rate": 1.05}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1", "ordered_varnames": ["rate"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null]}, "event": "call"}, {"globals": {"make_apply_tax": ["REF", 1]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"rate": 1.05}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1", "ordered_varnames": ["rate"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null]}, "event": "step_line"}, {"globals": {"make_apply_tax": ["REF", 1]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "return"}, {"globals": {"apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1]}, "stdout": "", "line": 3, "ordered_globals": ["make_apply_tax", "apply_tax1"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "step_line"}, {"globals": {"apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "apply_tax1"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"rate": 1.1}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2", "ordered_varnames": ["rate"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "call"}, {"globals": {"apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "apply_tax1"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"rate": 1.1}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2", "ordered_varnames": ["rate"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1]}, "event": "step_line"}, {"globals": {"apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "apply_tax1"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "return"}, {"globals": {"apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1], "apply_tax2": ["REF", 3]}, "stdout": "", "line": 4, "ordered_globals": ["make_apply_tax", "apply_tax1", "apply_tax2"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "step_line"}, {"globals": {"apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1], "apply_tax2": ["REF", 3]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "apply_tax1", "apply_tax2"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"cost": 1}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f3", "ordered_varnames": ["cost"], "frame_id": 3, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "call"}, {"globals": {"apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1], "apply_tax2": ["REF", 3]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "apply_tax1", "apply_tax2"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"cost": 1}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f3", "ordered_varnames": ["cost"], "frame_id": 3, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "step_line"}, {"globals": {"apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1], "apply_tax2": ["REF", 3]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "apply_tax1", "apply_tax2"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"__return__": 1.05, "cost": 1}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f3", "ordered_varnames": ["cost", "__return__"], "frame_id": 3, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "return"}, {"globals": {"a": 1.05, "apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1], "apply_tax2": ["REF", 3]}, "stdout": "", "line": 5, "ordered_globals": ["make_apply_tax", "apply_tax1", "apply_tax2", "a"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "step_line"}, {"globals": {"a": 1.05, "apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1], "apply_tax2": ["REF", 3]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "apply_tax1", "apply_tax2", "a"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"cost": 1}, "is_zombie": false, "parent_frame_id_list": [2], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f4", "ordered_varnames": ["cost"], "frame_id": 4, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "call"}, {"globals": {"a": 1.05, "apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1], "apply_tax2": ["REF", 3]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "apply_tax1", "apply_tax2", "a"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"cost": 1}, "is_zombie": false, "parent_frame_id_list": [2], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f4", "ordered_varnames": ["cost"], "frame_id": 4, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "step_line"}, {"globals": {"a": 1.05, "apply_tax1": ["REF", 2], "make_apply_tax": ["REF", 1], "apply_tax2": ["REF", 3]}, "stdout": "", "line": 1, "ordered_globals": ["make_apply_tax", "apply_tax1", "apply_tax2", "a"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"__return__": 1.1, "cost": 1}, "is_zombie": false, "parent_frame_id_list": [2], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f4", "ordered_varnames": ["cost", "__return__"], "frame_id": 4, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "return"}, {"globals": {"a": 1.05, "apply_tax1": ["REF", 2], "b": 1.1, "apply_tax2": ["REF", 3], "make_apply_tax": ["REF", 1]}, "stdout": "", "line": 5, "ordered_globals": ["make_apply_tax", "apply_tax1", "apply_tax2", "a", "b"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "rate": 1.05}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "rate": 1.1}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f2_p_z", "ordered_varnames": ["rate", "__return__"], "frame_id": 2, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(rate) <line 1>", null], "2": ["FUNCTION", "<lambda>(cost) <line 1>", 1], "3": ["FUNCTION", "<lambda>(cost) <line 1>", 2]}, "event": "return"}]};
var closures2_vis;

$(document).ready(function() {
    try {
        closures2_vis = new ExecutionVisualizer('closures2',closures2_trace,
                                    {embeddedMode: false,
                                    verticalStack: false,
                                    heightChangeCallback: redrawAllVisualizerArrows,
                                    codeDivWidth: 500,
                                    lang : 'py3'
                                    });
        attachLoggers(closures2_vis,'closures2');
        styleButtons('closures2');
        allVisualizers.push(closures2_vis);
    } catch (e) {
        console.log("Failed to Initialize CodeLens component closures2_vis" );
        console.log(e.toString());
    }

});

$(document).ready(function() {
    $("#closures2_tracecheck").click(function() {
        logBookEvent({'event':'codelens', 'act': 'check', 'div_id':'closures2'});
    });
});

if (allVisualizers === undefined) {
   var allVisualizers = [];
}


$(window).resize(function() {
    if (closures2_vis) {
        closures2_vis.redrawConnectors();
    }
});
</script>
<p>In this example, we see that each of the <code class="docutils literal"><span class="pre">apply_tax</span></code> functions is bundled with
the appropriate value and the second call to <code class="docutils literal"><span class="pre">make_apply_tax</span></code> did not affect
the first call in any way.  This explains, in detail, how Python evaluates
nested lambda expressions: a value is placed in memory that includes the
function plus the value of any outer variable referenced in the body.  This type
of value is known as a closure.  Next, we consider the evaluation of a function
call.  It turns out that the choice of order of this evaluation illustrate the
distinction between <em>lazy evaluation</em> and <em>strict evaluation</em>.</p>
<p>There are two more subtle implementation details that we need to understand
before we can understand the evaluation of functions and function calls in
Python.  In the next section, we look at when Python creates a closure and how
Python resolves local and global variables.</p>
</div>
<div class="section" id="closure-creation-and-the-resolution-of-global-and-local-variables">
<h2>2.3.3. Closure creation and the resolution of global and local variables<a class="headerlink" href="#closure-creation-and-the-resolution-of-global-and-local-variables" title="Permalink to this headline">¶</a></h2>
<p>Python functions are not always closures and whether or not Python creates a
closure depends on whether or not the function references a <em>local variable
bound outside its scope</em>.  Consider the following example.</p>

<div class="alert alert-warning cd_section">
<div id="closures3"></div>
<p class="cl_caption"><span class="cl_caption_text"> (closures3)</span> </p>
</div>
<script type="text/javascript">
var closures3_trace = {"code": "# global variable\nx = 2\nf = lambda y: x*y\ng = lambda y: lambda z: z*(x+y)\nh = g(3)", "trace": [{"globals": {}, "stdout": "", "line": 2, "ordered_globals": [], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"x": 2}, "stdout": "", "line": 3, "ordered_globals": ["x"], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x": 2}, "stdout": "", "line": 4, "ordered_globals": ["x", "f"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 2}, "stdout": "", "line": 5, "ordered_globals": ["x", "f", "g"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(y) <line 4>", null]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 2}, "stdout": "", "line": 4, "ordered_globals": ["x", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"y": 3}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 4>", "unique_hash": "<lambda> <line 4>_f1", "ordered_varnames": ["y"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(y) <line 4>", null]}, "event": "call"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 2}, "stdout": "", "line": 4, "ordered_globals": ["x", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"y": 3}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 4>", "unique_hash": "<lambda> <line 4>_f1", "ordered_varnames": ["y"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(y) <line 4>", null]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 2}, "stdout": "", "line": 4, "ordered_globals": ["x", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "y": 3}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 4>", "unique_hash": "<lambda> <line 4>_f1_p", "ordered_varnames": ["y", "__return__"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(y) <line 4>", null], "3": ["FUNCTION", "<lambda>(z) <line 4>", 1]}, "event": "return"}, {"globals": {"f": ["REF", 1], "h": ["REF", 3], "g": ["REF", 2], "x": 2}, "stdout": "", "line": 5, "ordered_globals": ["x", "f", "g", "h"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 3], "y": 3}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 4>", "unique_hash": "<lambda> <line 4>_f1_p_z", "ordered_varnames": ["y", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(y) <line 4>", null], "3": ["FUNCTION", "<lambda>(z) <line 4>", 1]}, "event": "return"}]};
var closures3_vis;

$(document).ready(function() {
    try {
        closures3_vis = new ExecutionVisualizer('closures3',closures3_trace,
                                    {embeddedMode: true,
                                    verticalStack: false,
                                    heightChangeCallback: redrawAllVisualizerArrows,
                                    codeDivWidth: 500,
                                    lang : 'py3'
                                    });
        attachLoggers(closures3_vis,'closures3');
        styleButtons('closures3');
        allVisualizers.push(closures3_vis);
    } catch (e) {
        console.log("Failed to Initialize CodeLens component closures3_vis" );
        console.log(e.toString());
    }

});

$(document).ready(function() {
    $("#closures3_tracecheck").click(function() {
        logBookEvent({'event':'codelens', 'act': 'check', 'div_id':'closures3'});
    });
});

if (allVisualizers === undefined) {
   var allVisualizers = [];
}


$(window).resize(function() {
    if (closures3_vis) {
        closures3_vis.redrawConnectors();
    }
});
</script>
<p>In the above example, the first two function are not closures but the third
function is.  Function that are not closures do not get their own frame of
reference, where as a closure does.  This is illustrated in the following
figure.</p>
<div class="figure">
<img alt="Examples of Python functions that are and are not closures." src="../_images/closure_and_not.png" />
<div class="legend">
<blockquote>
<div>In this figure, we see that the first two functions lack their own
frame-of-reference and are not closures.  On the other hand, the third
function contains a local frame that contains the value of <code class="docutils literal"><span class="pre">y</span></code> and is a
closure.</div></blockquote>
</div>
</div>
<p>Python&#8217;s evaluation rules are different for references to global variables
(variables defined in the main namespace) and local variables defined outside a
function&#8217;s body.  If a function does not reference any local variable outside of
its scope, it won&#8217;t be a closure.  Furthermore, references to global variables
have <strong>dynamic resolution</strong>, meaning the value of the variable is resolved at
run-time, not at the creation of the function.</p>
<p>In the above example shown in codelens, we see that the third function <code class="docutils literal"><span class="pre">h</span></code> has
a reference to a bound local variable outside its scope, namely <code class="docutils literal"><span class="pre">y</span></code>.
Furthermore, the value that is referenced in this local frame is the value of
<code class="docutils literal"><span class="pre">y</span></code> when <code class="docutils literal"><span class="pre">h</span></code> was created.  This method of resolving a variable is known as
<strong>lexical resolution</strong>.  References to global variables have a different method
of resolution in Python.</p>

<div class="alert alert-warning cd_section">
<div id="closures4"></div>
<p class="cl_caption"><span class="cl_caption_text"> (closures4)</span> </p>
</div>
<script type="text/javascript">
var closures4_trace = {"code": "# global variable\nx = 2\nf = lambda y: lambda z: z*(x+y)\n\ng = f(3)\nx = 4\nresult = g(5)", "trace": [{"globals": {}, "stdout": "", "line": 2, "ordered_globals": [], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"x": 2}, "stdout": "", "line": 3, "ordered_globals": ["x"], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x": 2}, "stdout": "", "line": 5, "ordered_globals": ["x", "f"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x": 2}, "stdout": "", "line": 3, "ordered_globals": ["x", "f"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"y": 3}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f1", "ordered_varnames": ["y"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null]}, "event": "call"}, {"globals": {"f": ["REF", 1], "x": 2}, "stdout": "", "line": 3, "ordered_globals": ["x", "f"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"y": 3}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f1", "ordered_varnames": ["y"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x": 2}, "stdout": "", "line": 3, "ordered_globals": ["x", "f"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "y": 3}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f1_p", "ordered_varnames": ["y", "__return__"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(z) <line 3>", 1]}, "event": "return"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 2}, "stdout": "", "line": 6, "ordered_globals": ["x", "f", "g"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "y": 3}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f1_p_z", "ordered_varnames": ["y", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(z) <line 3>", 1]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 4}, "stdout": "", "line": 7, "ordered_globals": ["x", "f", "g"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "y": 3}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f1_p_z", "ordered_varnames": ["y", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(z) <line 3>", 1]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 4}, "stdout": "", "line": 3, "ordered_globals": ["x", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "y": 3}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f1_p_z", "ordered_varnames": ["y", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"z": 5}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f2", "ordered_varnames": ["z"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(z) <line 3>", 1]}, "event": "call"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 4}, "stdout": "", "line": 3, "ordered_globals": ["x", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "y": 3}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f1_p_z", "ordered_varnames": ["y", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"z": 5}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f2", "ordered_varnames": ["z"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(z) <line 3>", 1]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 4}, "stdout": "", "line": 3, "ordered_globals": ["x", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "y": 3}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f1_p_z", "ordered_varnames": ["y", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"__return__": 35, "z": 5}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f2", "ordered_varnames": ["z", "__return__"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(z) <line 3>", 1]}, "event": "return"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "result": 35, "x": 4}, "stdout": "", "line": 7, "ordered_globals": ["x", "f", "g", "result"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "y": 3}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 3>", "unique_hash": "<lambda> <line 3>_f1_p_z", "ordered_varnames": ["y", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(y) <line 3>", null], "2": ["FUNCTION", "<lambda>(z) <line 3>", 1]}, "event": "return"}]};
var closures4_vis;

$(document).ready(function() {
    try {
        closures4_vis = new ExecutionVisualizer('closures4',closures4_trace,
                                    {embeddedMode: true,
                                    verticalStack: false,
                                    heightChangeCallback: redrawAllVisualizerArrows,
                                    codeDivWidth: 500,
                                    lang : 'py3'
                                    });
        attachLoggers(closures4_vis,'closures4');
        styleButtons('closures4');
        allVisualizers.push(closures4_vis);
    } catch (e) {
        console.log("Failed to Initialize CodeLens component closures4_vis" );
        console.log(e.toString());
    }

});

$(document).ready(function() {
    $("#closures4_tracecheck").click(function() {
        logBookEvent({'event':'codelens', 'act': 'check', 'div_id':'closures4'});
    });
});

if (allVisualizers === undefined) {
   var allVisualizers = [];
}


$(window).resize(function() {
    if (closures4_vis) {
        closures4_vis.redrawConnectors();
    }
});
</script>
<p>In this last example, we see that the value of <code class="docutils literal"><span class="pre">x</span></code> used in the calculation of
<code class="docutils literal"><span class="pre">result</span></code> was 4 and not 2.  This indicates  that references to global variables
are resolved at run-time using the current state of the function at the time of
the function call.  This type of resolution is known as <strong>dynamic resolution</strong>.</p>
</div>
<div class="section" id="variable-scope-and-substitution">
<h2>2.3.4. Variable Scope and Substitution<a class="headerlink" href="#variable-scope-and-substitution" title="Permalink to this headline">¶</a></h2>
<p>The ability to nest lambda expressions brings about another problem.  Consider
the following expression.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>The body of the outer function is a lambda function and the body of the inner
function is <code class="docutils literal"><span class="pre">x**2</span></code>, but which <code class="docutils literal"><span class="pre">x</span></code> is this body referring to, the outer
parameter or the inner parameter?  Let&#8217;s runs some code to find out, where we
have added another wrinkle by introducing a global variable <code class="docutils literal"><span class="pre">x</span></code> as well.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>

<span class="gp">In [11]: </span><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="go"># Calling the outer function returns a function</span>
<span class="gp">In [12]: </span><span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="gp">In [13]: </span><span class="nb">type</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="gh">Out[13]: </span><span class="go">function</span>

<span class="gp">In [14]: </span><span class="n">g</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">                  Out[14]: 9</span>
</pre></div>
</div>
<p>If <code class="docutils literal"><span class="pre">x**2</span></code> referred to the outer parameter, we would have seen <code class="docutils literal"><span class="pre">2**2</span> <span class="pre">=</span> <span class="pre">4</span></code> as
the value of <code class="docutils literal"><span class="pre">g(3)</span></code>.  Similarly, if <code class="docutils literal"><span class="pre">x</span></code> was referring to the global
variable, <code class="docutils literal"><span class="pre">g(3)</span></code> would return <code class="docutils literal"><span class="pre">1**2</span> <span class="pre">=</span> <span class="pre">1</span></code>.  So clearly the
<code class="docutils literal"><span class="pre">x</span></code> in the expression <code class="docutils literal"><span class="pre">x**2</span></code> is referring to the inner <code class="docutils literal"><span class="pre">x</span></code> parameter.</p>
<p>What is going on here?  The answer has to do with a variables <em>scope</em>.  Recall
that variables, whether constructed through an assignment statement or function
call, are bound to values.  The (lexical) <strong>scope</strong> of a variable is the portion
of the code for which that variable represents it&#8217;s value.  In other words, if a
variable <code class="docutils literal"><span class="pre">x</span></code> is bound to <code class="docutils literal"><span class="pre">5</span></code>, the scope is all parts of the code where
evaluating <code class="docutils literal"><span class="pre">x</span></code> will return <code class="docutils literal"><span class="pre">5</span></code>.</p>
<p>Run the same program in codelens and see if things clear up.</p>

<div class="alert alert-warning cd_section">
<div id="scope1"></div>
<p class="cl_caption"><span class="cl_caption_text"> (scope1)</span> </p>
</div>
<script type="text/javascript">
var scope1_trace = {"code": "x = 1\nf = lambda x: lambda x: x**2\n# Calling the outer function returns a function\ng = f(2)\ntype(g)\ng(3)", "trace": [{"globals": {}, "stdout": "", "line": 1, "ordered_globals": [], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"x": 1}, "stdout": "", "line": 2, "ordered_globals": ["x"], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x": 1}, "stdout": "", "line": 4, "ordered_globals": ["x", "f"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x": 1}, "stdout": "", "line": 2, "ordered_globals": ["x", "f"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"x": 2}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1", "ordered_varnames": ["x"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null]}, "event": "call"}, {"globals": {"f": ["REF", 1], "x": 1}, "stdout": "", "line": 2, "ordered_globals": ["x", "f"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"x": 2}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1", "ordered_varnames": ["x"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x": 1}, "stdout": "", "line": 2, "ordered_globals": ["x", "f"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x": 2}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p", "ordered_varnames": ["x", "__return__"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null], "2": ["FUNCTION", "<lambda>(x) <line 2>", 1]}, "event": "return"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 1}, "stdout": "", "line": 5, "ordered_globals": ["x", "f", "g"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null], "2": ["FUNCTION", "<lambda>(x) <line 2>", 1]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 1}, "stdout": "", "line": 6, "ordered_globals": ["x", "f", "g"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null], "2": ["FUNCTION", "<lambda>(x) <line 2>", 1]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 1}, "stdout": "", "line": 2, "ordered_globals": ["x", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"x": 3}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f2", "ordered_varnames": ["x"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null], "2": ["FUNCTION", "<lambda>(x) <line 2>", 1]}, "event": "call"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 1}, "stdout": "", "line": 2, "ordered_globals": ["x", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"x": 3}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f2", "ordered_varnames": ["x"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null], "2": ["FUNCTION", "<lambda>(x) <line 2>", 1]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 1}, "stdout": "", "line": 2, "ordered_globals": ["x", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"__return__": 9, "x": 3}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f2", "ordered_varnames": ["x", "__return__"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null], "2": ["FUNCTION", "<lambda>(x) <line 2>", 1]}, "event": "return"}, {"globals": {"f": ["REF", 1], "g": ["REF", 2], "x": 1}, "stdout": "", "line": 6, "ordered_globals": ["x", "f", "g"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(x) <line 2>", null], "2": ["FUNCTION", "<lambda>(x) <line 2>", 1]}, "event": "return"}]};
var scope1_vis;

$(document).ready(function() {
    try {
        scope1_vis = new ExecutionVisualizer('scope1',scope1_trace,
                                    {embeddedMode: false,
                                    verticalStack: false,
                                    heightChangeCallback: redrawAllVisualizerArrows,
                                    codeDivWidth: 500,
                                    lang : 'py3'
                                    });
        attachLoggers(scope1_vis,'scope1');
        styleButtons('scope1');
        allVisualizers.push(scope1_vis);
    } catch (e) {
        console.log("Failed to Initialize CodeLens component scope1_vis" );
        console.log(e.toString());
    }

});

$(document).ready(function() {
    $("#scope1_tracecheck").click(function() {
        logBookEvent({'event':'codelens', 'act': 'check', 'div_id':'scope1'});
    });
});

if (allVisualizers === undefined) {
   var allVisualizers = [];
}


$(window).resize(function() {
    if (scope1_vis) {
        scope1_vis.redrawConnectors();
    }
});
</script>
<p>Functions and lambda expression complicate the issue, as their parameters are
<strong>local variables</strong>, meaning that their scope is restricted to the body of the
function or expression.</p>
<p>So what happens if we use the same name for a parameter in nested lambda
expressions?  The value bound to <code class="docutils literal"><span class="pre">x</span></code> changes based on the scope of the
variable, using the value from the most local <code class="docutils literal"><span class="pre">x</span></code> variable.  The following
figure illustrates the scope of all three <code class="docutils literal"><span class="pre">x</span></code> variables.</p>
<div class="figure">
<img alt="The scope of each variable." src="../_images/scope.png" />
<div class="legend">
This image shows the scope of each variable in the above example.  Start
with the inner most <code class="docutils literal"><span class="pre">x</span></code>, which is bound to the the argument of <code class="docutils literal"><span class="pre">g(3)</span></code>,
namely 3.  The scope of the inner most <code class="docutils literal"><span class="pre">x</span></code> is the body of the inner
lambda.  The outer parameter gets bound to 2, and the scope of this variable
is inside the body of the outer function, but not in the body of the inner
lambda.  The global variable has a scope that consists of the global name
space but is over-ridden in the body of both functions.</div>
</div>
<p>Ideally, we would like to think about evaluation of referentially transparent
expressions using substitution: replace each expression with the right value.
But substitution becomes tricky when using variables with the same name but
different scopes.  The solution to rename the variable so that all variables
are unique.</p>
<div class="admonition-capture-free-variable-renaming-strategy admonition">
<p class="first admonition-title">Capture-free variable renaming strategy</p>
<p class="last">Starting with the inner-most expressions, rename all variables by adding a
unique number to all instances of a variable in its scope.</p>
</div>
<p>After applying this transformation, it is now safe to use substitution to
understand the code.  This renaming strategy is known as <strong>capture-free
capture</strong> in lambda calculus.  A more precise definition is given on <a class="reference external" href="https://en.wikipedia.org/wiki/Lambda_calculus#Capture-avoiding_substitutions">Wikipedia</a>.
You can explore the renamed code in codelens and the following figure shows the
scope of the rename variables.</p>

<div class="alert alert-warning cd_section">
<div id="scope_renamed"></div>
<p class="cl_caption"><span class="cl_caption_text"> (scope_renamed)</span> </p>
</div>
<script type="text/javascript">
var scope_renamed_trace = {"code": "x3 = 1\nf = lambda x2: lambda x1: x1**2\n# Calling the outer function returns a function\ng = f(2)\ntype(g)\ng(3)", "trace": [{"globals": {}, "stdout": "", "line": 1, "ordered_globals": [], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"x3": 1}, "stdout": "", "line": 2, "ordered_globals": ["x3"], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x3": 1}, "stdout": "", "line": 4, "ordered_globals": ["x3", "f"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x3": 1}, "stdout": "", "line": 2, "ordered_globals": ["x3", "f"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"x2": 2}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1", "ordered_varnames": ["x2"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null]}, "event": "call"}, {"globals": {"f": ["REF", 1], "x3": 1}, "stdout": "", "line": 2, "ordered_globals": ["x3", "f"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"x2": 2}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1", "ordered_varnames": ["x2"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x3": 1}, "stdout": "", "line": 2, "ordered_globals": ["x3", "f"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x2": 2}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p", "ordered_varnames": ["x2", "__return__"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null], "2": ["FUNCTION", "<lambda>(x1) <line 2>", 1]}, "event": "return"}, {"globals": {"f": ["REF", 1], "x3": 1, "g": ["REF", 2]}, "stdout": "", "line": 5, "ordered_globals": ["x3", "f", "g"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x2": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x2", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null], "2": ["FUNCTION", "<lambda>(x1) <line 2>", 1]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x3": 1, "g": ["REF", 2]}, "stdout": "", "line": 6, "ordered_globals": ["x3", "f", "g"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x2": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x2", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null], "2": ["FUNCTION", "<lambda>(x1) <line 2>", 1]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x3": 1, "g": ["REF", 2]}, "stdout": "", "line": 2, "ordered_globals": ["x3", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x2": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x2", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"x1": 3}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f2", "ordered_varnames": ["x1"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null], "2": ["FUNCTION", "<lambda>(x1) <line 2>", 1]}, "event": "call"}, {"globals": {"f": ["REF", 1], "x3": 1, "g": ["REF", 2]}, "stdout": "", "line": 2, "ordered_globals": ["x3", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x2": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x2", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"x1": 3}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f2", "ordered_varnames": ["x1"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null], "2": ["FUNCTION", "<lambda>(x1) <line 2>", 1]}, "event": "step_line"}, {"globals": {"f": ["REF", 1], "x3": 1, "g": ["REF", 2]}, "stdout": "", "line": 2, "ordered_globals": ["x3", "f", "g"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x2": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x2", "__return__"], "frame_id": 1, "is_highlighted": false}, {"is_parent": false, "encoded_locals": {"__return__": 9, "x1": 3}, "is_zombie": false, "parent_frame_id_list": [1], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f2", "ordered_varnames": ["x1", "__return__"], "frame_id": 2, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null], "2": ["FUNCTION", "<lambda>(x1) <line 2>", 1]}, "event": "return"}, {"globals": {"f": ["REF", 1], "x3": 1, "g": ["REF", 2]}, "stdout": "", "line": 6, "ordered_globals": ["x3", "f", "g"], "func_name": "<module>", "stack_to_render": [{"is_parent": true, "encoded_locals": {"__return__": ["REF", 2], "x2": 2}, "is_zombie": true, "parent_frame_id_list": [], "func_name": "<lambda> <line 2>", "unique_hash": "<lambda> <line 2>_f1_p_z", "ordered_varnames": ["x2", "__return__"], "frame_id": 1, "is_highlighted": false}], "heap": {"1": ["FUNCTION", "<lambda>(x2) <line 2>", null], "2": ["FUNCTION", "<lambda>(x1) <line 2>", 1]}, "event": "return"}]};
var scope_renamed_vis;

$(document).ready(function() {
    try {
        scope_renamed_vis = new ExecutionVisualizer('scope_renamed',scope_renamed_trace,
                                    {embeddedMode: false,
                                    verticalStack: false,
                                    heightChangeCallback: redrawAllVisualizerArrows,
                                    codeDivWidth: 500,
                                    lang : 'py3'
                                    });
        attachLoggers(scope_renamed_vis,'scope_renamed');
        styleButtons('scope_renamed');
        allVisualizers.push(scope_renamed_vis);
    } catch (e) {
        console.log("Failed to Initialize CodeLens component scope_renamed_vis" );
        console.log(e.toString());
    }

});

$(document).ready(function() {
    $("#scope_renamed_tracecheck").click(function() {
        logBookEvent({'event':'codelens', 'act': 'check', 'div_id':'scope_renamed'});
    });
});

if (allVisualizers === undefined) {
   var allVisualizers = [];
}


$(window).resize(function() {
    if (scope_renamed_vis) {
        scope_renamed_vis.redrawConnectors();
    }
});
</script>
<div class="figure">
<img alt="The scope of each renamed variable." src="../_images/scope_renamed.png" />
<div class="legend">
The scope of the renamed variables.  Once the variables have been renamed
using a capture-free method, it is safe to replace all instances of the
variable with the associated value.</div>
</div>
<p>One final note.  While you are encouraged to <strong>think</strong> about evaluating
expressions using substitution, implementing a language through substitution is
inefficient and most languages are implemented with <a class="reference external" href="https://mitpress.mit.edu/sicp/full-text/book/book-Z-H-21.html#%25_sec_3.2">the enviroment model of
evalution</a>.
Regardless, substitution is still the easiest way to understand evaluation and
explains the desire for referentially transparent code.</p>
</div>
<div class="section" id="evaluation-strategy">
<h2>2.3.5. Evaluation Strategy<a class="headerlink" href="#evaluation-strategy" title="Permalink to this headline">¶</a></h2>
<p>When evaluating an expression, we have two choices for the order of evaluation,
<em>normal order</em> and <em>applicative</em> order.  When evaluating a function call using
<strong>applicative order</strong>, arguments are evaluated first and then the resulting
values are substituted into the body of the function.  Applicative order
evaluation is a form of <strong>strict evaluation</strong>, where every expression is
evaluated as soon as it is encountered.  The following sequence of expression
represents the step-by-step process of applicative order evaluation.</p>
<p><strong>Applicative Order Evaluation</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nb">pow</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="n">y</span>
<span class="nb">pow</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Evaluate the arguments</span>
<span class="nb">pow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># substitute these values in the body</span>
<span class="mi">3</span><span class="o">**</span><span class="mi">4</span>
<span class="c1"># Evaluate the body</span>
<span class="mi">81</span>
</pre></div>
</div>
<p>Using codelens, it becomes clear that Python is using strict evaluation, as
<code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code> are bound to <code class="docutils literal"><span class="pre">3</span></code> and <code class="docutils literal"><span class="pre">4</span></code>, respectively.</p>

<div class="alert alert-warning cd_section">
<div id="applicative_order"></div>
<p class="cl_caption"><span class="cl_caption_text"> (applicative_order)</span> </p>
</div>
<script type="text/javascript">
var applicative_order_trace = {"code": "pow = lambda x, y: x**y\npow(1 + 2, 2*2)", "trace": [{"globals": {}, "stdout": "", "line": 1, "ordered_globals": [], "func_name": "<module>", "stack_to_render": [], "heap": {}, "event": "step_line"}, {"globals": {"pow": ["REF", 1]}, "stdout": "", "line": 2, "ordered_globals": ["pow"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(x, y) <line 1>", null]}, "event": "step_line"}, {"globals": {"pow": ["REF", 1]}, "stdout": "", "line": 1, "ordered_globals": ["pow"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"x": 3, "y": 4}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1", "ordered_varnames": ["x", "y"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x, y) <line 1>", null]}, "event": "call"}, {"globals": {"pow": ["REF", 1]}, "stdout": "", "line": 1, "ordered_globals": ["pow"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"x": 3, "y": 4}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1", "ordered_varnames": ["x", "y"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x, y) <line 1>", null]}, "event": "step_line"}, {"globals": {"pow": ["REF", 1]}, "stdout": "", "line": 1, "ordered_globals": ["pow"], "func_name": "<lambda>", "stack_to_render": [{"is_parent": false, "encoded_locals": {"__return__": 81, "x": 3, "y": 4}, "is_zombie": false, "parent_frame_id_list": [], "func_name": "<lambda> <line 1>", "unique_hash": "<lambda> <line 1>_f1", "ordered_varnames": ["x", "y", "__return__"], "frame_id": 1, "is_highlighted": true}], "heap": {"1": ["FUNCTION", "<lambda>(x, y) <line 1>", null]}, "event": "return"}, {"globals": {"pow": ["REF", 1]}, "stdout": "", "line": 2, "ordered_globals": ["pow"], "func_name": "<module>", "stack_to_render": [], "heap": {"1": ["FUNCTION", "<lambda>(x, y) <line 1>", null]}, "event": "return"}]};
var applicative_order_vis;

$(document).ready(function() {
    try {
        applicative_order_vis = new ExecutionVisualizer('applicative_order',applicative_order_trace,
                                    {embeddedMode: false,
                                    verticalStack: false,
                                    heightChangeCallback: redrawAllVisualizerArrows,
                                    codeDivWidth: 500,
                                    lang : 'py3'
                                    });
        attachLoggers(applicative_order_vis,'applicative_order');
        styleButtons('applicative_order');
        allVisualizers.push(applicative_order_vis);
    } catch (e) {
        console.log("Failed to Initialize CodeLens component applicative_order_vis" );
        console.log(e.toString());
    }

});

$(document).ready(function() {
    $("#applicative_order_tracecheck").click(function() {
        logBookEvent({'event':'codelens', 'act': 'check', 'div_id':'applicative_order'});
    });
});

if (allVisualizers === undefined) {
   var allVisualizers = [];
}


$(window).resize(function() {
    if (applicative_order_vis) {
        applicative_order_vis.redrawConnectors();
    }
});
</script>
<p>Clearly, the function <code class="docutils literal"><span class="pre">pow</span></code> is passed 3 and 4, the results of evaluating the
arguments first.</p>
<p>Conversely, function calls that are evaluated using <strong>normal order</strong> leave the
arguments as <em>unevaluated expressions</em> and these expressions are substituted
into the body of the function.  Using normal order to evaluate functions is a
form of <strong>lazy evaluation</strong>, where we put off the evaluation of arguments as
long as possible.</p>
<p><strong>Normal Order Evaluation</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nb">pow</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="n">y</span>
<span class="nb">pow</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Don&#39;t evaluate arguments</span>
<span class="c1"># Instead substitute in the unevaluated expressions</span>
<span class="c1"># into the body of pow</span>
<span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Now this expression is evaluated using normal order of operation</span>
<span class="mi">3</span><span class="o">**</span><span class="mi">4</span>
</pre></div>
</div>
<p>If it turns out that the arguments were not used in the function (possible
because of a conditional expression), then we don&#8217;t waste time on evaluation.
Consider the following scenario, where <code class="docutils literal"><span class="pre">cheap</span></code> is a function that executes
quickly but <code class="docutils literal"><span class="pre">expensive</span></code> has a long execution time.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="k">if</span> <span class="n">cond</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">b</span>
<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cheap</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">expensive</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>When using applicative order, both <code class="docutils literal"><span class="pre">cheap(x)</span></code> and <code class="docutils literal"><span class="pre">expensive(x)</span></code> will be
evaluated before the body.  If it turns out that we didn&#8217;t need
<code class="docutils literal"><span class="pre">expensive(x)</span></code>, we have wasted time.  Normal order evaluation will save us the
execution time for <code class="docutils literal"><span class="pre">expensive(x)</span></code> when it is not needed.  There is always a
trade-off and the trade-off for saving time using lazy evaluation is the
possibility of <a class="reference external" href="http://queue.acm.org/detail.cfm?id=2538488">sapce leaks</a>,
where the build up of unevaluated code can eat more and more memory.</p>
<p>Haskell is an example of a language focused on lazy evaluation, but any
language needs <em>some</em> strict evaluation or nothing would ever get done.
Similarly, all languages also need some lazy evaluation, in particular
conditional expressions and if-else constructions will be evaluated in a
lazy fashion in any language.  Python uses strict evaluation in function
calls, but we will look at other features of Python that allow lazy
evaluation in subsequent chapter.</p>
<p>Unfortunately, we won&#8217;t be using expressions for all of our programming.  In the
next section, we will look at some of the statements that are much more
convenience when our programs become more complicated.</p>
</div>
</div>


  
      
  <li id="relations-prev" class="navLink" title='Previous Section - 2.2. Saving Expressions for Later Execution - The <cite>lambda</cite> Expression' data-toggle="tooltip">
    <a href="SavingExpressionsForLaterExecution.html" >
      <i class='prevNav glyphicon glyphicon-chevron-left'></i>
    </a>
  </li>
  <a class="navLinkBg" id="navLinkBgLeft"  href="SavingExpressionsForLaterExecution.html" ></a>
  
  <li id="relations-next" class="navLink" title='Next Section - 2.4. Statements: When Expressions Are Not Enough' data-toggle="tooltip" >
    <a href="StatementsWhenExpressionsAreNotEnough.html" >
      <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right'></i>
    </a>
  </li>
  <a class="navLinkBg navLink" id="navLinkBgRight" href="StatementsWhenExpressionsAreNotEnough.html" >Next Section - 2.4. Statements: When Expressions Are Not Enough</a>

<script type="text/javascript">

  $('#relations-prev').tooltip({'placement':'right', 'selector': '', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement':'left', 'selector': '', 'delay': { show: 100, hide: 50}});
  
</script>
  
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      
      | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017 Todd Iverson.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
    </p>
  </div>
</footer>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32029811-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>