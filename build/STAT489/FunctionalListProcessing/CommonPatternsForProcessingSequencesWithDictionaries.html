<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7.6. Common Patterns for Processing Sequences with Dictionaries &mdash; Runestone Interactive Overview</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/activecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/clickable.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pytutor.css" type="text/css" />
    <link rel="stylesheet" href="../_static/modal-basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/datafile.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dragndrop.css" type="text/css" />
    <link rel="stylesheet" href="../_static/fitb.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/livecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/parsons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/lib/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/poll.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tabbedstuff.css" type="text/css" />
    <link rel="stylesheet" href="../_static/video.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.1/""/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/jquery-ui-1.10.3.custom.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/user-highlights.css" type="text/css" />
    <link rel="stylesheet" href="../_static/runestone-custom-sphinx-bootstrap.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/runestonebase.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.highlight.js"></script>
    <script type="text/javascript" src="../_static/bookfuncs.js"></script>
    <script type="text/javascript" src="../_static/codemirror.js"></script>
    <script type="text/javascript" src="../_static/xml.js"></script>
    <script type="text/javascript" src="../_static/css.js"></script>
    <script type="text/javascript" src="../_static/htmlmixed.js"></script>
    <script type="text/javascript" src="../_static/python.js"></script>
    <script type="text/javascript" src="../_static/javascript.js"></script>
    <script type="text/javascript" src="../_static/activecode.js"></script>
    <script type="text/javascript" src="../_static/skulpt.min.js"></script>
    <script type="text/javascript" src="../_static/skulpt-stdlib.js"></script>
    <script type="text/javascript" src="../_static/clike.js"></script>
    <script type="text/javascript" src="../_static/timed_activecode.js"></script>
    <script type="text/javascript" src="../_static/animationbase.js"></script>
    <script type="text/javascript" src="../_static/mchoice.js"></script>
    <script type="text/javascript" src="../_static/timedmc.js"></script>
    <script type="text/javascript" src="../_static/timed.js"></script>
    <script type="text/javascript" src="../_static/clickable.js"></script>
    <script type="text/javascript" src="../_static/timedclickable.js"></script>
    <script type="text/javascript" src="../_static/d3.v2.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.ba-bbq.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.jsPlumb-1.3.10-all-min.js"></script>
    <script type="text/javascript" src="../_static/pytutor.js"></script>
    <script type="text/javascript" src="../_static/codelens.js"></script>
    <script type="text/javascript" src="../_static/skulpt.min.js"></script>
    <script type="text/javascript" src="../_static/skulpt-stdlib.js"></script>
    <script type="text/javascript" src="../_static/datafile.js"></script>
    <script type="text/javascript" src="../_static/dragndrop.js"></script>
    <script type="text/javascript" src="../_static/timeddnd.js"></script>
    <script type="text/javascript" src="../_static/fitb.js"></script>
    <script type="text/javascript" src="../_static/timedfitb.js"></script>
    <script type="text/javascript" src="../_static/livecode.js"></script>
    <script type="text/javascript" src="../_static/clike.js"></script>
    <script type="text/javascript" src="../_static/lib/prettify.js"></script>
    <script type="text/javascript" src="../_static/lib/hammer.min.js"></script>
    <script type="text/javascript" src="../_static/parsons.js"></script>
    <script type="text/javascript" src="../_static/timedparsons.js"></script>
    <script type="text/javascript" src="../_static/poll.js"></script>
    <script type="text/javascript" src="../_static/reveal.js"></script>
    <script type="text/javascript" src="../_static/shortanswer.js"></script>
    <script type="text/javascript" src="../_static/timed_shortanswer.js"></script>
    <script type="text/javascript" src="../_static/tabbedstuff.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <link rel="top" title="Runestone Interactive Overview" href="../index.html" />
    <link rel="up" title="7. Functional List Processing" href="toctree.html" />
    <link rel="next" title="7.7. Lazy Iteration" href="LazyIteration.html" />
    <link rel="prev" title="7.5. Other Examples of Higher Order Functions" href="OtherExamplesOfHigherOrderFunctions.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<link rel="shortcut icon" href="/runestone/static/favicon.ico" type="image/ico" />

<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = 'http://127.0.0.1:8000' ? 'http://127.0.0.1:8000' : 'http://127.0.0.1:8000';
  eBookConfig.app = eBookConfig.host+'/runestone';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = 'STAT489';
  eBookConfig.logLevel = 0;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.isLoggedIn = false;
  eBookConfig.useRunestoneServices = false;
  eBookConfig.python3 = true;
  eBookConfig.basecourse = 'STAT489';
</script>

<div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&status=0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>



  </head>
  <body role="document">


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        <a class="brand-logo" style='background: transparent url("../_static/img/logo_small.png") no-repeat 0px 0px;' href="/runestone/default/user/login">&nbsp; </a>
        <a class="navbar-brand" href="../index.html">STAT489</a>
      </div>
    </div>

    <div class="navbar-collapse collapse navbar-ex1-collapse">

      <ul class="nav navbar-nav navbar-right">

        <li class="divider-vertical"></li>

        <!-- social media dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-share-alt" style="opacity: 0.9"></i>
          </a>
          <ul class="dropdown-menu social-menu">
              <li>
                <div>
                  <b>Runestone in social media:</b>
                </div>
                <a href="https://twitter.com/iRunestone" class="twitter-follow-button" data-show-count="true">Follow @iRunestone</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="fb-like" data-href="https://www.facebook.com/RunestoneInteractive" data-send="false" data-layout="button_count" data-width="300" data-show-faces="false" data-font="arial"></div>
              </li>

              <li class="divider"></li>
              <li>
                <div>
                  <b>Help support us:</b>
                </div>
                <div>
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                  <input type="hidden" name="cmd" value="_s-xclick">
                  <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHNwYJKoZIhvcNAQcEoIIHKDCCByQCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYAcrkqh1hn3lYqIpfXxNqe1T82EhXzCJGy1yMAmklpyZshyMkfDGe1Bhx+iwyGeoYRTTyphFmP+9M3NyO0+Q5XdHxgZPx/zYjjBxlZHgEV6jhE8bN2fHkkPf0VHfz0a0QQylQOPlKiOTZV7B37Jpk6yM47oVZ1tG/KNm0NkfmB76DELMAkGBSsOAwIaBQAwgbQGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIi0GmFfOlcjuAgZBbYOo9UO+CpMQa+PYqwsUmUnJvXIImeMeNI3KVTUx5Cfk9gNMo3WzPeiB5IqZo9nRAQ0mf1qL2ecLeB5tidM+lgBUhOxfj3/FecpnVFa0263gp4g+PLw8jzhvVRdUon1K3SeO1Rzh23fIRKwnrD6btt73uwtj0sl3tGd8qz+6GIcwPDdRk9VcUffiBJT/ZagKgggOHMIIDgzCCAuygAwIBAgIBADANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wHhcNMDQwMjEzMTAxMzE1WhcNMzUwMjEzMTAxMzE1WjCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMFHTt38RMxLXJyO2SmS+Ndl72T7oKJ4u4uw+6awntALWh03PewmIJuzbALScsTS4sZoS1fKciBGoh11gIfHzylvkdNe/hJl66/RGqrj5rFb08sAABNTzDTiqqNpJeBsYs/c2aiGozptX2RlnBktH+SUNpAajW724Nv2Wvhif6sFAgMBAAGjge4wgeswHQYDVR0OBBYEFJaffLvGbxe9WT9S1wob7BDWZJRrMIG7BgNVHSMEgbMwgbCAFJaffLvGbxe9WT9S1wob7BDWZJRroYGUpIGRMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbYIBADAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIFfOlaagFrl71+jq6OKidbWFSE+Q4FqROvdgIONth+8kSK//Y/4ihuE4Ymvzn5ceE3S/iBSQQMjyvb+s2TWbQYDwcp129OPIbD9epdr4tJOUNiSojw7BHwYRiPh58S1xGlFgHFXwrEBb3dgNbMUa+u4qectsMAXpVHnD9wIyfmHMYIBmjCCAZYCAQEwgZQwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tAgEAMAkGBSsOAwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xMzExMDMxMzQxMzFaMCMGCSqGSIb3DQEJBDEWBBRDJF8w+zsMr7FSk+pwinB5f5D4rzANBgkqhkiG9w0BAQEFAASBgHw1LMHpkpaqHIvDGdFE0eG+2mZlmMnUeDCBhQlbc7QMzFQYKTV94NfaebBO4PmNdADe1rq4WidSRZZbE7CzkX9IGENYnBTWY0hb2l0lGdGrJdGeWyV3ekg9WVaFMMumrekds96h3Cx7dGz2kWDzIai2iEXE/qoE+xpkyXAYZNV3-----END PKCS7-----
                  ">
                  <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                  <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                  </form>

                </div>
              </li>
          </ul>
        </li>
        <!-- end social media dropdown -->

        <li class="divider-vertical"></li>

        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html'>Table of Contents</a></li>
            
            <li><a href='/runestone/static/STAT489/genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li id="scratch_ac_link"><a href="javascript:ACFactory.toggleScratchActivecode()">Scratch ActiveCode</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        
        <li class="divider-vertical"></li>

        <!-- help menu dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-question-sign" style="opacity:0.9;"></i>
          </a>
          <ul class="dropdown-menu user-menu">
            <li><a href='/runestone/static/STAT489/navhelp.html'>Navigation Help</a></li>
            <li><a href='/runestone/static/overview/instructor.html'>Help for Instructors</a></li>
            <li class="divider"></li>
            <li><a href='http://runestoneinteractive.org'>About Runestone</a></li>
            <li><a href='/runestone/default/reportabug?course=STAT489&page=CommonPatternsForProcessingSequencesWithDictionaries'>Report A Problem</a></li>
          </ul>
        </li>
        <!-- end help menu dropdown -->

        <li class="divider-vertical"></li>

      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        <!--
          <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">7.6. Common Patterns for Processing Sequences with Dictionaries</a><ul>
<li><a class="reference internal" href="#maps-and-filters-for-dictionaries">7.6.1. Maps and filters for dictionaries</a><ul>
<li><a class="reference internal" href="#example-1-average-quiz-scores">7.6.1.1. Example 1 - average quiz scores</a></li>
<li><a class="reference internal" href="#example-2-filter-out-students-with-at-least-siz-quiz-scores">7.6.1.2. Example 2 - filter out students with at least siz quiz scores.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#counting-frequencies-with-dictionaries">7.6.2. Counting Frequencies with Dictionaries</a></li>
<li><a class="reference internal" href="#the-imperative-approach-to-counting-frequences">7.6.3. The Imperative Approach to Counting Frequences</a></li>
<li><a class="reference internal" href="#counting-frequencies-using-a-key-function">7.6.4. Counting Frequencies Using a Key Function</a></li>
<li><a class="reference internal" href="#grouping-values-with-groupby">7.6.5. Grouping values with <code class="docutils literal"><span class="pre">groupby</span></code></a></li>
<li><a class="reference internal" href="#the-recursive-approach-to-counting-frequencies-optional">7.6.6. The Recursive Approach to Counting Frequencies (Optional)</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          <li class="divider-vertical"></li>
        
        
          
  <li id="relations-prev" title="Previous Chapter - 7.5. Other Examples of Higher Order Functions" data-toggle="tooltip">
    <a href="OtherExamplesOfHigherOrderFunctions.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - 7.7. Lazy Iteration' data-toggle="tooltip" >
    <a href="LazyIteration.html" >
      <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script type="text/javascript">
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  $('#relations-prev').tooltip(opts);
  $('#relations-next').tooltip(opts);
</script>
        -->
        
          <li></li>
        
      </ul>

    </div>
  </div>
</div>


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content">
  
  <div class="section" id="common-patterns-for-processing-sequences-with-dictionaries">
<h1>7.6. Common Patterns for Processing Sequences with Dictionaries<a class="headerlink" href="#common-patterns-for-processing-sequences-with-dictionaries" title="Permalink to this headline">¶</a></h1>
<p>In this section, we will illustrate a number of common patterns for processing
lists using dictionaries.  These patterns include counting frequencies, counting
frequencies by some key function and grouping data by some key or key function.
In each case, we will start by looking at the imperative solution, then move on
to building a high-level abstraction and finally use a pre-existing function from
<code class="docutils literal"><span class="pre">toolz</span></code>.</p>
<div class="section" id="maps-and-filters-for-dictionaries">
<h2>7.6.1. Maps and filters for dictionaries<a class="headerlink" href="#maps-and-filters-for-dictionaries" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">toolz</span></code> module contains maps and filters for dictionary keys, values, and
items.  In the same way that we can chain map, filter and reduce together to
solve most list processing problems; <code class="docutils literal"><span class="pre">keymap</span></code>, <code class="docutils literal"><span class="pre">keyfilter</span></code>, <code class="docutils literal"><span class="pre">valmap</span></code>,
<code class="docutils literal"><span class="pre">valfilter</span></code>, <code class="docutils literal"><span class="pre">itemfilter</span></code> and <code class="docutils literal"><span class="pre">itemmap</span></code> can be useful when processing
dictionaries.  We will illustrate with by redoing two exercises from an earlier
homework.</p>
<div class="section" id="example-1-average-quiz-scores">
<h3>7.6.1.1. Example 1 - average quiz scores<a class="headerlink" href="#example-1-average-quiz-scores" title="Permalink to this headline">¶</a></h3>
<p>To see these tools in action, let&#8217;s revisit a homework exercise from a previous
chapter (<strong>Chapter 5 Exercise 2</strong>).  In this example, we have a number of quiz
scores stored in a file.  Each line of the file contains the students name
followed by each quiz score.</p>
<p>We start by splitting the lines.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">file_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;joe 10 15 20 30 40</span>
<span class="gp">   ...: </span><span class="s1">bill 23 16 19 22</span>
<span class="gp">   ...: </span><span class="s1">sue 8 22 17 14 32 17 24 21 2 9 11 17</span>
<span class="gp">   ...: </span><span class="s1">grace 12 28 21 45 26 10</span>
<span class="gp">   ...: </span><span class="s1">john 14 32 25 16 89&#39;&#39;&#39;</span>
<span class="gp">   ...: </span>

<span class="gp">In [2]: </span><span class="n">lines</span> <span class="o">=</span> <span class="n">file_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="n">lines</span>
<span class="gh">Out[3]: </span><span class="go"></span>
<span class="go">[&#39;joe 10 15 20 30 40&#39;,</span>
<span class="go"> &#39;bill 23 16 19 22&#39;,</span>
<span class="go"> &#39;sue 8 22 17 14 32 17 24 21 2 9 11 17&#39;,</span>
<span class="go"> &#39;grace 12 28 21 45 26 10&#39;,</span>
<span class="go"> &#39;john 14 32 25 16 89&#39;]</span>
</pre></div>
</div>
<p>Next we split each line into list of words.  Earlier this would have been
accomplished using a list comprehension as follows.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">words</span> <span class="o">=</span>  <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>  <span class="n">lines</span><span class="p">]</span>

<span class="gp">In [5]: </span><span class="n">words</span>
<span class="gh">Out[5]: </span><span class="go"></span>
<span class="go">[[&#39;joe&#39;, &#39;10&#39;, &#39;15&#39;, &#39;20&#39;, &#39;30&#39;, &#39;40&#39;],</span>
<span class="go"> [&#39;bill&#39;, &#39;23&#39;, &#39;16&#39;, &#39;19&#39;, &#39;22&#39;],</span>
<span class="go"> [&#39;sue&#39;, &#39;8&#39;, &#39;22&#39;, &#39;17&#39;, &#39;14&#39;, &#39;32&#39;, &#39;17&#39;, &#39;24&#39;, &#39;21&#39;, &#39;2&#39;, &#39;9&#39;, &#39;11&#39;, &#39;17&#39;],</span>
<span class="go"> [&#39;grace&#39;, &#39;12&#39;, &#39;28&#39;, &#39;21&#39;, &#39;45&#39;, &#39;26&#39;, &#39;10&#39;],</span>
<span class="go"> [&#39;john&#39;, &#39;14&#39;, &#39;32&#39;, &#39;25&#39;, &#39;16&#39;, &#39;89&#39;]]</span>
</pre></div>
</div>
<p>but now we recognize this as a map, and perform the same task using a map.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">lines</span><span class="p">))</span>

<span class="gp">In [7]: </span><span class="n">words</span>
<span class="gh">Out[7]: </span><span class="go"></span>
<span class="go">[[&#39;joe&#39;, &#39;10&#39;, &#39;15&#39;, &#39;20&#39;, &#39;30&#39;, &#39;40&#39;],</span>
<span class="go"> [&#39;bill&#39;, &#39;23&#39;, &#39;16&#39;, &#39;19&#39;, &#39;22&#39;],</span>
<span class="go"> [&#39;sue&#39;, &#39;8&#39;, &#39;22&#39;, &#39;17&#39;, &#39;14&#39;, &#39;32&#39;, &#39;17&#39;, &#39;24&#39;, &#39;21&#39;, &#39;2&#39;, &#39;9&#39;, &#39;11&#39;, &#39;17&#39;],</span>
<span class="go"> [&#39;grace&#39;, &#39;12&#39;, &#39;28&#39;, &#39;21&#39;, &#39;45&#39;, &#39;26&#39;, &#39;10&#39;],</span>
<span class="go"> [&#39;john&#39;, &#39;14&#39;, &#39;32&#39;, &#39;25&#39;, &#39;16&#39;, &#39;89&#39;]]</span>
</pre></div>
</div>
<p>We start by forming a dictionary with key&#8217;s equal to the names (i.e. <code class="docutils literal"><span class="pre">first</span></code>
of each row) and value containing all the <code class="docutils literal"><span class="pre">rest</span></code> of the line.  Since the
<code class="docutils literal"><span class="pre">drop</span></code> function is lazy, we will compose it with <code class="docutils literal"><span class="pre">list</span></code> to force completion
for this small example.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="kn">from</span> <span class="nn">toolz.curried</span> <span class="kn">import</span> <span class="n">first</span><span class="p">,</span> <span class="n">drop</span><span class="p">,</span> <span class="n">compose</span>

<span class="gp">In [9]: </span><span class="n">rest</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">drop</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="gp">In [10]: </span><span class="n">scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">first</span><span class="p">(</span><span class="n">line</span><span class="p">):</span><span class="n">rest</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">words</span><span class="p">}</span>

<span class="gp">In [11]: </span><span class="n">scores</span>
<span class="gh">Out[11]: </span><span class="go"></span>
<span class="go">{&#39;bill&#39;: [&#39;23&#39;, &#39;16&#39;, &#39;19&#39;, &#39;22&#39;],</span>
<span class="go"> &#39;grace&#39;: [&#39;12&#39;, &#39;28&#39;, &#39;21&#39;, &#39;45&#39;, &#39;26&#39;, &#39;10&#39;],</span>
<span class="go"> &#39;joe&#39;: [&#39;10&#39;, &#39;15&#39;, &#39;20&#39;, &#39;30&#39;, &#39;40&#39;],</span>
<span class="go"> &#39;john&#39;: [&#39;14&#39;, &#39;32&#39;, &#39;25&#39;, &#39;16&#39;, &#39;89&#39;],</span>
<span class="go"> &#39;sue&#39;: [&#39;8&#39;, &#39;22&#39;, &#39;17&#39;, &#39;14&#39;, &#39;32&#39;, &#39;17&#39;, &#39;24&#39;, &#39;21&#39;, &#39;2&#39;, &#39;9&#39;, &#39;11&#39;, &#39;17&#39;]}</span>
</pre></div>
</div>
<p>We wish to compute the average quiz score. Consider the levels of abstraction
for this problem.</p>
<div class="figure">
<img alt="Levels of abstraction for the quiz score dictionary." src="../_images/scores_levels.png" />
<div class="legend">
The score dictionary consists of keys (strings) and values (lists of words).</div>
</div>
<p>If we are to obey the clean code rules for writing and composing function, we
should write functions at each level of abstraction, that is functions that</p>
<ol class="arabic simple">
<li><strong>Level 1</strong> Process score</li>
<li><strong>Level 2</strong> Process lists of scores</li>
<li><strong>Level 3</strong> Process a dictionary of name-list pairs</li>
</ol>
<p><strong>Level 1 Functions: What is it that we want to do to each word?</strong></p>
<p>We need to turn them into integers, which is accomplished with <code class="docutils literal"><span class="pre">int</span></code>.</p>
<p><strong>Level 2 Functions: What do we need to do to the list of words?</strong></p>
<ol class="arabic simple">
<li>Turn each score into an integer. <code class="docutils literal"><span class="pre">map(int)</span></code></li>
<li>Turn this lazy map into a list <code class="docutils literal"><span class="pre">list</span></code></li>
<li>Compute the mean of the list of integers <code class="docutils literal"><span class="pre">mean</span> <span class="pre">=</span> <span class="pre">lambda</span> <span class="pre">L:</span> <span class="pre">sum(L)/len(L)</span></code></li>
</ol>
<p>Notice that each of the functions acts on a list, i.e. the right level of
abstraction.  We will combine these using composition, which is illustrated
below.</p>
<div class="figure">
<img alt="The composition of quiz score list functions." src="../_images/score_list_compose.png" />
<div class="legend">
To process each value (quiz score list), we apply <code class="docutils literal"><span class="pre">compose(mean,</span> <span class="pre">list,</span> <span class="pre">map(int))</span></code>.  Recall that functional composition is applied from right to left, with <code class="docutils literal"><span class="pre">map(int)</span></code> first converting each string to an int, then <code class="docutils literal"><span class="pre">list</span></code> converts the lazy map to a list, and finally <code class="docutils literal"><span class="pre">mean</span></code> computes the average of the list.</div>
</div>
<p><strong>Level 3 Functions: What do we want do to the keys/values for the dictionary?</strong></p>
<p>In this case, we need to apply the function from the last level of abstraction
to each of the values in the dictionary.</p>
<p>To do this we do this using <code class="docutils literal"><span class="pre">valmap</span></code>, which applies a function to each value
in the dictionary.  There is no need to change the keys.</p>
<div class="figure">
<img alt="Using valmap to processes each value in the scores dictionary." src="../_images/score_valmap.png" />
<div class="legend">
By applying valmap, we apply the function from the last level of abstraction to each of the values in the scores dictionary.</div>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">valmap</span>

<span class="gp">In [13]: </span><span class="kn">from</span> <span class="nn">toolz.curried</span> <span class="kn">import</span> <span class="nb">map</span>

<span class="gp">In [14]: </span><span class="n">mean</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>

<span class="gp">In [15]: </span><span class="n">scores</span> <span class="o">=</span> <span class="n">valmap</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">)),</span> <span class="n">scores</span><span class="p">)</span>

<span class="gp">In [16]: </span><span class="n">scores</span>
<span class="gh">Out[16]: </span><span class="go"></span>
<span class="go">{&#39;bill&#39;: 20.0,</span>
<span class="go"> &#39;grace&#39;: 23.666666666666668,</span>
<span class="go"> &#39;joe&#39;: 23.0,</span>
<span class="go"> &#39;john&#39;: 35.2,</span>
<span class="go"> &#39;sue&#39;: 16.166666666666668}</span>
</pre></div>
</div>
<p>In this example, we show an important technique for applying maps.  When we want
to apply transformations in sequence, we use composition with a curried map.  On
the other hand, when we want to perform multiple maps sequentially, we compose
the map helper functions to perform all transformations in one pass.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Computing the mean of a lazy sequence is difficult as (a) sequences like
<code class="docutils literal"><span class="pre">map</span></code> don&#8217;t have a length and (b) we can only process the sequence once
before it is empty.   We will revisit this topic when we go into more detail
about lazy evaluation in Python in an upcoming section.</p>
</div>
<p>Let&#8217;s peel apart <code class="docutils literal"><span class="pre">valmap(compose(</span> <span class="pre">mean,</span> <span class="pre">list,</span> <span class="pre">map(int)),</span> <span class="pre">scores)</span></code> to make sure
we can interpret composition of this type.  We start by reinitializing the raw
<code class="docutils literal"><span class="pre">scores</span></code> and applying each function in the <code class="docutils literal"><span class="pre">compose(mean,</span> <span class="pre">list,</span> <span class="pre">map(int))</span></code>
recall that the function inside of <code class="docutils literal"><span class="pre">valmap</span></code> is meant to act on each of the
inner list values.  For illustration, we will work on <code class="docutils literal"><span class="pre">'sue'</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">get</span>

<span class="gp">In [18]: </span><span class="n">scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">first</span><span class="p">(</span><span class="n">line</span><span class="p">):</span><span class="n">rest</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">words</span><span class="p">}</span>

<span class="gp">In [19]: </span><span class="n">sue_scores</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;sue&#39;</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>

<span class="gp">In [20]: </span><span class="n">func</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="gp">In [21]: </span><span class="n">sue_scores</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">sue_scores</span><span class="p">)</span>

<span class="gp">In [22]: </span><span class="n">sue_scores</span>
<span class="gh">Out[22]: </span><span class="go">&lt;map at 0x114349c88&gt;</span>
</pre></div>
</div>
<p>Remember that <code class="docutils literal"><span class="pre">map(int)</span></code> is the curried partial function that is equivalent to
<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">L:</span> <span class="pre">map(int,</span> <span class="pre">L)</span></code>.  Due to the lazy nature of map, and in particular the
lack of a length, we apply the <code class="docutils literal"><span class="pre">list</span></code> conversion function.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [23]: </span><span class="n">func</span> <span class="o">=</span> <span class="nb">list</span>

<span class="gp">In [24]: </span><span class="n">sue_scores</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">sue_scores</span><span class="p">)</span>

<span class="gp">In [25]: </span><span class="n">sue_scores</span>
<span class="gh">Out[25]: </span><span class="go">[8, 22, 17, 14, 32, 17, 24, 21, 2, 9, 11, 17]</span>
</pre></div>
</div>
<p>Now that the values are list of integers, we can compute the mean.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [26]: </span><span class="n">func</span> <span class="o">=</span> <span class="n">mean</span>

<span class="gp">In [27]: </span><span class="n">sue_scores</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">sue_scores</span><span class="p">)</span>

<span class="gp">In [28]: </span><span class="n">sue_scores</span>
<span class="gh">Out[28]: </span><span class="go">16.166666666666668</span>
</pre></div>
</div>
<p>Of course these three function calls can be composed into one call.  Remember
that <code class="docutils literal"><span class="pre">compose</span></code> applies the functions from right to left.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="n">sue_scores</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;sue&#39;</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>

<span class="gp">In [30]: </span><span class="n">func</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

<span class="gp">In [31]: </span><span class="n">func</span><span class="p">(</span><span class="n">sue_scores</span><span class="p">)</span>
<span class="gh">Out[31]: </span><span class="go">16.166666666666668</span>
</pre></div>
</div>
<p>To apply this function to each of the values in our quiz score dictionary, we
use <code class="docutils literal"><span class="pre">valmap</span></code> to map it to all of the values.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [32]: </span><span class="n">func</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

<span class="gp">In [33]: </span><span class="n">valmap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
<span class="gh">Out[33]: </span><span class="go"></span>
<span class="go">{&#39;bill&#39;: 20.0,</span>
<span class="go"> &#39;grace&#39;: 23.666666666666668,</span>
<span class="go"> &#39;joe&#39;: 23.0,</span>
<span class="go"> &#39;john&#39;: 35.2,</span>
<span class="go"> &#39;sue&#39;: 16.166666666666668}</span>
</pre></div>
</div>
<p>While it is often advisable, there is no need to assign our helper function to a
external variable.  Using substitution, the final expression becomes</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [34]: </span><span class="n">valmap</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">)),</span> <span class="n">scores</span><span class="p">)</span>
<span class="gh">Out[34]: </span><span class="go"></span>
<span class="go">{&#39;bill&#39;: 20.0,</span>
<span class="go"> &#39;grace&#39;: 23.666666666666668,</span>
<span class="go"> &#39;joe&#39;: 23.0,</span>
<span class="go"> &#39;john&#39;: 35.2,</span>
<span class="go"> &#39;sue&#39;: 16.166666666666668}</span>
</pre></div>
</div>
<p>This example illustrates the proper application of functional constructs such as
<code class="docutils literal"><span class="pre">map</span></code>, <code class="docutils literal"><span class="pre">compose</span></code> and <code class="docutils literal"><span class="pre">valmap</span></code> allows us to express complex computations in
a succinct form.  On the other hand, programmers should always be careful not to
be <em>too clever</em> when expressing a computation, always keeping an eye out for
readability.  The reader that is new to functional programming might need to work
at translating an expression like the one shown above, but it will become second
nature after a while.</p>
<div class="admonition-advice-on-reading-maps-pipes-compositions-and-curried-functions admonition">
<p class="first admonition-title">Advice on reading maps, pipes, compositions, and curried functions</p>
<p>Here are some tips on interpreting expression involving the tools presented so
far tni this chapter.</p>
<ol class="last arabic">
<li><p class="first"><strong>Maps with a single function</strong>  Remember that a map applies its function to
each element of a sequence.  The map is curried if it has only one argument,
as in <code class="docutils literal"><span class="pre">map(int)</span></code>.  This is a partial function that can be applied to a
sequence and, in this case, will apply <code class="docutils literal"><span class="pre">int</span></code> to each element of the
sequence.</p>
</li>
<li><p class="first"><strong>Filters with a single function</strong>  We have seen many examples of a
filter, both in the form of a comprehension and using <code class="docutils literal"><span class="pre">filter</span></code>.
When reading a curried filter such as <code class="docutils literal"><span class="pre">filter(lambda</span> <span class="pre">n:</span> <span class="pre">n</span> <span class="pre">&gt;</span> <span class="pre">5)</span></code>,
think of it as a partial function that can be used to filter
sequences in the future, which in this case would keep all elements
larger than 5.</p>
</li>
<li><p class="first"><strong>Maps with an inner composition</strong>  A map that has a composed function as
its first argument will apply each function, from right to left, to
each element of the sequence.  <strong>This is more efficient than applying
a sequence of maps.</strong>  Here is an example.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [35]: </span><span class="n">func</span><span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">   ....: </span>                  <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">   ....: </span>              <span class="nb">int</span><span class="p">))</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>First note that this composition has one argument, meaning it is a
curried partial function.  Also, remember to read the composition from
right to left (bottom to top when stacked).  Keeping this all in mind, we
see that this map will perform the following actions to each element of a
list.</p>
<ol class="arabic simple">
<li>Turn each element into an integer.</li>
<li>Square each element.</li>
<li>Add two to each element.</li>
</ol>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [36]: </span><span class="nb">list</span><span class="p">(</span><span class="n">func</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">]))</span>
<span class="gh">Out[36]: </span><span class="go">[3, 6, 11]</span>
</pre></div>
</div>
<p><strong>Note:</strong> Since <code class="docutils literal"><span class="pre">pipe</span></code> is not a function, it is not useful inside a
<code class="docutils literal"><span class="pre">map</span></code>.</p>
</li>
<li><dl class="first docutils">
<dt><strong>Compositions/pipes of maps, filters and other functions</strong>.  When the</dt>
<dd><p class="first">expression is a composition of maps, filters and other functions that
act on a list, think of these as a sequence of actions on the <em>whole
list</em>.  For example, consider the following function.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [37]: </span><span class="n">func</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span>
<span class="gp">   ....: </span>               <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="s2">&quot;!&quot;</span><span class="p">),</span>
<span class="gp">   ....: </span>               <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>Clearly this function is intended for a list of strings.  This
function will perform the following actions.</p>
<ol class="arabic simple">
<li>Turn all characters to upper case (<code class="docutils literal"><span class="pre">s.upper()</span></code>).</li>
<li>Add three exclaimation marks to the end of each string (<code class="docutils literal"><span class="pre">s</span> <span class="pre">+</span> <span class="pre">3*'!'</span></code>).</li>
<li>Join all of the strings with newline characters (<code class="docutils literal"><span class="pre">'\n'.join</span></code>).</li>
</ol>
<p>Let&#8217;s see this composition in action.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [38]: </span><span class="k">print</span><span class="p">(</span><span class="n">func</span><span class="p">([</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;love&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">]))</span>
<span class="go">I!!!</span>
<span class="go">LOVE!!!</span>
<span class="go">PYTHON!!!</span>
</pre></div>
</div>
<p>As noted above, we could make this function more efficiency by
replacing the sequence of maps with one map that composes these
functions.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [39]: </span><span class="n">func</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span>
<span class="gp">   ....: </span>               <span class="nb">map</span><span class="p">(</span>
<span class="gp">   ....: </span>                 <span class="n">compose</span><span class="p">(</span>
<span class="gp">   ....: </span>                   <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="s2">&quot;!&quot;</span><span class="p">,</span>
<span class="gp">   ....: </span>                   <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">())))</span>
<span class="gp">   ....: </span>

<span class="gp">In [40]: </span><span class="k">print</span><span class="p">(</span><span class="n">func</span><span class="p">([</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;love&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">]))</span>
<span class="go">I!!!</span>
<span class="go">LOVE!!!</span>
<span class="go">PYTHON!!!</span>
</pre></div>
</div>
<p>The efficient gain for larger lists is due to only visiting each
element one time instead of twice.</p>
<p>Recall that <code class="docutils literal"><span class="pre">pipe</span></code> is used to <em>push</em> an expression (the first
argument) though a sequence of functions from left to right (the
remaining arguments).</p>
<p>Using <code class="docutils literal"><span class="pre">pipe</span></code> to process a sequence is probably more readable than
using a composition, as the first argument is the data to be
processed and the functions are processed from left to right, which
reads more naturally (if you grew up with a language that reads in
the same direction).  The above process translates into to following
expression.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [41]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">pipe</span>

<span class="gp">In [42]: </span><span class="k">print</span><span class="p">(</span><span class="n">pipe</span><span class="p">([</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;love&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">],</span>
<span class="gp">   ....: </span>             <span class="nb">map</span><span class="p">(</span>
<span class="gp">   ....: </span>               <span class="n">compose</span><span class="p">(</span>
<span class="gp">   ....: </span>                 <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="s2">&quot;!&quot;</span><span class="p">,</span>
<span class="gp">   ....: </span>                 <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">())),</span>
<span class="gp">   ....: </span>             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">))</span>
<span class="gp">   ....: </span>
<span class="go">I!!!</span>
<span class="go">LOVE!!!</span>
<span class="go">PYTHON!!!</span>
</pre></div>
</div>
<p class="last">While the <code class="docutils literal"><span class="pre">pipe</span></code> is easier to read, it is not as general as a
function created using <code class="docutils literal"><span class="pre">compose</span></code>, as it is a one-use expression and
must be wrapped in a lambda/function to make it reusable.</p>
</dd>
</dl>
</li>
</ol>
</div>
</div>
<div class="section" id="example-2-filter-out-students-with-at-least-siz-quiz-scores">
<h3>7.6.1.2. Example 2 - filter out students with at least siz quiz scores.<a class="headerlink" href="#example-2-filter-out-students-with-at-least-siz-quiz-scores" title="Permalink to this headline">¶</a></h3>
<p><strong>Chapter 5 Exercise 1</strong>  asks the programmer to filter on students with at
least 6 quiz scores.  This filter will need to be applied to each value in the
quiz score dictionary so we will be using <code class="docutils literal"><span class="pre">valfilter</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [43]: </span><span class="kn">from</span> <span class="nn">toolz.curried</span> <span class="kn">import</span> <span class="n">first</span><span class="p">,</span> <span class="n">drop</span><span class="p">,</span> <span class="n">compose</span>

<span class="gp">In [44]: </span><span class="n">lines</span> <span class="o">=</span> <span class="n">file_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="gp">In [45]: </span><span class="n">words</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">lines</span><span class="p">)</span>

<span class="gp">In [46]: </span><span class="n">words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

<span class="gp">In [47]: </span><span class="n">rest</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">drop</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="gp">In [48]: </span><span class="n">scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">first</span><span class="p">(</span><span class="n">line</span><span class="p">):</span><span class="n">rest</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">words</span><span class="p">}</span>

<span class="gp">In [49]: </span><span class="n">scores</span>
<span class="gh">Out[49]: </span><span class="go"></span>
<span class="go">{&#39;bill&#39;: [&#39;23&#39;, &#39;16&#39;, &#39;19&#39;, &#39;22&#39;],</span>
<span class="go"> &#39;grace&#39;: [&#39;12&#39;, &#39;28&#39;, &#39;21&#39;, &#39;45&#39;, &#39;26&#39;, &#39;10&#39;],</span>
<span class="go"> &#39;joe&#39;: [&#39;10&#39;, &#39;15&#39;, &#39;20&#39;, &#39;30&#39;, &#39;40&#39;],</span>
<span class="go"> &#39;john&#39;: [&#39;14&#39;, &#39;32&#39;, &#39;25&#39;, &#39;16&#39;, &#39;89&#39;],</span>
<span class="go"> &#39;sue&#39;: [&#39;8&#39;, &#39;22&#39;, &#39;17&#39;, &#39;14&#39;, &#39;32&#39;, &#39;17&#39;, &#39;24&#39;, &#39;21&#39;, &#39;2&#39;, &#39;9&#39;, &#39;11&#39;, &#39;17&#39;]}</span>
</pre></div>
</div>
<p>Again, we will cast all the results of <code class="docutils literal"><span class="pre">filter</span></code> to lists to force completion.
This time, we use <code class="docutils literal"><span class="pre">pipe</span></code> to push the scores through the <code class="docutils literal"><span class="pre">valfilter</span></code> then the
<code class="docutils literal"><span class="pre">valmap</span></code>, which are each curried partial functions.  While we are at it, we
might as well convert all the values to integers.  This accomplished using an
inner <code class="docutils literal"><span class="pre">map(int)</span></code>, which switches all of the values to integers.  Then these
list are converted to lists.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [50]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">pipe</span>

<span class="gp">In [51]: </span><span class="kn">from</span> <span class="nn">toolz.curried</span> <span class="kn">import</span> <span class="n">valmap</span><span class="p">,</span> <span class="n">valfilter</span>

<span class="gp">In [52]: </span><span class="n">mean</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>

<span class="gp">In [53]: </span><span class="n">scores</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span>
<span class="gp">   ....: </span>              <span class="n">valfilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">),</span>
<span class="gp">   ....: </span>              <span class="n">valmap</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span>
<span class="gp">   ....: </span>                             <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">))))</span>
<span class="gp">   ....: </span>

<span class="gp">In [54]: </span><span class="n">scores</span>
<span class="gh">Out[54]: </span><span class="go"></span>
<span class="go">{&#39;grace&#39;: [12, 28, 21, 45, 26, 10],</span>
<span class="go"> &#39;sue&#39;: [8, 22, 17, 14, 32, 17, 24, 21, 2, 9, 11, 17]}</span>
</pre></div>
</div>
<p>Let&#8217;s practice what we have learned so far and read through the <code class="docutils literal"><span class="pre">pipe</span></code>
expression line by line.</p>
<p>The first line, <code class="docutils literal"><span class="pre">pipe(scores,</span></code> tells us that we are going to pipe or push the
scores through a sequence of functions (from left-to-right or top-to-bottom).
The first function, <code class="docutils literal"><span class="pre">valfilter(lambda</span> <span class="pre">L:</span> <span class="pre">len(L)</span> <span class="pre">&gt;=</span> <span class="pre">6),</span></code> is a curried function
(<code class="docutils literal"><span class="pre">valfilter</span></code> takes two arguments, we have provided one) that only keep items
that have at least 6 values.  The final function is more complicated and will
need a bit more work to interpret.</p>
<p>The final function is a <code class="docutils literal"><span class="pre">valmap</span></code> that will apply two functions to all of the
elements of each value in score.  It is important to remember that the composed
function operates on values that are themselves lists.  Consequently, the
functions applied to the values will also be list-processing functions like
<code class="docutils literal"><span class="pre">map</span></code>.  Since this is a composition, the functions are applied from
right-to-left. The first action turns each element of the value list into an
integer using the curried <code class="docutils literal"><span class="pre">map(int)</span></code> and then converted to a list with
<code class="docutils literal"><span class="pre">list</span></code>.</p>
<div class="admonition-advice-on-writing-higher-order-functions admonition">
<p class="first admonition-title">Advice on writing higher-order functions</p>
<p>Writing higher-order functions takes some practice.  When using higher order
functions to process a data sctructure, you should</p>
<ol class="last arabic">
<li><p class="first"><strong>Learn to think in terms of map, filter and reduce.</strong>  With practice, it
becomes natural to convert a desited transformation into maps, filter and/or
reduces.</p>
<p>If this feels like a daunting task when getting started, Try using the
following steps.</p>
<p>a. Write a solution using list comprehensions and loops. Be sure to test your
solution, and save the tests to help with the next step.</p>
<p>b. Now inspect the code and identify the which of these patterns are being
applied in your solution.</p>
<p>c. Finally, refactor your solution into a composition/pipe of maps, filters
and reductions.</p>
<p>This may seem like unnecessary work, but the act of continuously
refactering your code into higher-order functions will help you start to
think in this way.  Remember that our goal is to learn to process large
datasets over Hadoop using MapReduce and Spark, and that these
implementations, especially Spark, require the ability to think in terms
of these higher-order actions.</p>
</li>
<li><p class="first"><strong>Look for opportunities to use curried funcitons.</strong>  Higher order
functions like map and filter require functions as arguments and
curried functions allow us to create partial functions with ease.  If you
haven&#8217;t found the knack for using curried functions, you can build this
skill through careful refactorizaiton of your code.  Get in the habit of
writing helper functions for map and check to see if these functions
could benefit from currying. For example, suppose we want to extract the
column with index 2 from a table of data.  If this column represented an
employees hours, we might write the process as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">get</span>
<span class="n">get_hours</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
<span class="n">hours</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">get_hours</span><span class="p">,</span> <span class="n">employee_data</span><span class="p">)</span>
</pre></div>
</div>
<p>But <code class="docutils literal"><span class="pre">lambda</span> <span class="pre">row:</span> <span class="pre">get(2,</span> <span class="pre">row)</span></code> represents a partial application of
<code class="docutils literal"><span class="pre">get</span></code> with the first argument set to <code class="docutils literal"><span class="pre">2</span></code> and the second argument left
open for latter application.  This could be refactored using <code class="docutils literal"><span class="pre">partial</span></code>
from functools as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="n">get_hours</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">get</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">hours</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">get_hours</span><span class="p">,</span> <span class="n">employee_data</span><span class="p">)</span>
</pre></div>
</div>
<p>While this approach does make it clear that <code class="docutils literal"><span class="pre">get_hours</span></code> is just a
partial application of <code class="docutils literal"><span class="pre">get</span></code>, we can make this even more succinct using
the curried version of <code class="docutils literal"><span class="pre">get</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">toolz.curried</span> <span class="kn">import</span> <span class="n">get</span>
<span class="n">hours</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">employee_data</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Create your own curried functions.</strong>  Once you get used to using
curried functions like those found in the <code class="docutils literal"><span class="pre">toolz</span></code> package, you will
start to see opportunities to write your own curried functions.
There are two things to keep in mind when creating a curried
function.  First, use the <code class="docutils literal"><span class="pre">&#64;curry</span></code> decorator from <code class="docutils literal"><span class="pre">toolz</span></code> to
transform any function definition into a curried function.  Second,
try to put the arguments that might be used in multiple function
calls to the left of arguments that are more likely to change from
one call to the next.  This way, you can easily create partial
funcitons that remove the repetition from all subsequent calls.
arguments that will</p>
</li>
<li><p class="first"><strong>Try to keep all of the steps lazy when processing large amounts of
data.</strong> In the next section we will look at Python&#8217;s lazy constructs
in more detail.  These tools can be useful when processing large
amounts of data, as they do not need to have all of the data loaded
in memory at once.  An important skill when working with big data
is keeping track of which steps are lazy or eager, and making sure
that the data can be processed without loading it all in memory.</p>
</li>
<li><p class="first"><strong>Obey the claan code rule regarding levels of abstraction.</strong> It is still
important to pay attention to the levels of abstraction in our data
structures and keep to one level per function.  Anytime that your functions
and expressions become too complex, check to make sure that you have stuck to
this rule.</p>
<p>For example, consider the following example given above.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [55]: </span><span class="n">mean</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>

<span class="gp">In [56]: </span><span class="n">scores</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span>
<span class="gp">   ....: </span>              <span class="n">valfilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">),</span>
<span class="gp">   ....: </span>              <span class="n">valmap</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span>
<span class="gp">   ....: </span>                             <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">))))</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>While this function doesn&#8217;t technically break this rule (all functions, even the
anonymous inner helper functions, all operate on one level), we could improve
readability with some refactoring.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [57]: </span><span class="n">mean</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>

<span class="gp">In [58]: </span><span class="n">at_least_six_items</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span>

<span class="gp">In [59]: </span><span class="n">map_int_and_make_list</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

<span class="gp">In [60]: </span><span class="n">scores</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span>
<span class="gp">   ....: </span>              <span class="n">valfilter</span><span class="p">(</span><span class="n">at_least_six_items</span><span class="p">),</span>
<span class="gp">   ....: </span>              <span class="n">valmap</span><span class="p">(</span><span class="n">map_int_and_make_list</span><span class="p">))</span>
<span class="gp">   ....: </span>

<span class="gp">In [61]: </span><span class="n">scores</span>
<span class="gh">Out[61]: </span><span class="go"></span>
<span class="go">{&#39;grace&#39;: [12, 28, 21, 45, 26, 10],</span>
<span class="go"> &#39;sue&#39;: [8, 22, 17, 14, 32, 17, 24, 21, 2, 9, 11, 17]}</span>
</pre></div>
</div>
<p>This refactored version hides the lower levels of abstraction for the values
(items in values lists) using the helper functions <code class="docutils literal"><span class="pre">mean</span></code>,
<code class="docutils literal"><span class="pre">at_least_six_items</span></code>, and <code class="docutils literal"><span class="pre">map_int_and_make_list</span></code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="counting-frequencies-with-dictionaries">
<h2>7.6.2. Counting Frequencies with Dictionaries<a class="headerlink" href="#counting-frequencies-with-dictionaries" title="Permalink to this headline">¶</a></h2>
<p>In this section, we continue the theme of processing sequential data.  Many
problems require that we group data by some common characteristic.  We will
refer to this operation as <strong>counts</strong> or <strong>frequencies</strong>.  In Python,
dictionaries are the right data structure for a keeping track of the counts for
various objects.  In this section, we will look at two low-level approaches to
writing a <strong>frequencies</strong> operation, with an imperative approach and with
recursion.</p>
</div>
<div class="section" id="the-imperative-approach-to-counting-frequences">
<h2>7.6.3. The Imperative Approach to Counting Frequences<a class="headerlink" href="#the-imperative-approach-to-counting-frequences" title="Permalink to this headline">¶</a></h2>
<p>As a working example, suppose that we want to count the occurrences of each word
in a block of text.  For this example, we will use the Zen of Python with
punctuation already removed.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [62]: </span><span class="n">zen_no_punc</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="gp">   ....: </span><span class="s1">The Zen of Python by Tim Peters</span>
<span class="gp">   ....: </span><span class="s1">Beautiful is better than ugly</span>
<span class="gp">   ....: </span><span class="s1">Explicit is better than implicit</span>
<span class="gp">   ....: </span><span class="s1">Simple is better than complex</span>
<span class="gp">   ....: </span><span class="s1">Complex is better than complicated</span>
<span class="gp">   ....: </span><span class="s1">Flat is better than nested</span>
<span class="gp">   ....: </span><span class="s1">Sparse is better than dense</span>
<span class="gp">   ....: </span><span class="s1">Readability counts</span>
<span class="gp">   ....: </span><span class="s1">Special cases arent special enough to break the rules</span>
<span class="gp">   ....: </span><span class="s1">Although practicality beats purity</span>
<span class="gp">   ....: </span><span class="s1">Errors should never pass silently</span>
<span class="gp">   ....: </span><span class="s1">Unless explicitly silenced</span>
<span class="gp">   ....: </span><span class="s1">In the face of ambiguity refuse the temptation to guess</span>
<span class="gp">   ....: </span><span class="s1">There should be one and preferably only one obvious way to do it</span>
<span class="gp">   ....: </span><span class="s1">Although that way may not be obvious at first unless youre Dutch</span>
<span class="gp">   ....: </span><span class="s1">Now is better than never</span>
<span class="gp">   ....: </span><span class="s1">Although never is often better than right now</span>
<span class="gp">   ....: </span><span class="s1">If the implementation is hard to explain its a bad idea</span>
<span class="gp">   ....: </span><span class="s1">If the implementation is easy to explain it may be a good idea</span>
<span class="gp">   ....: </span><span class="s1">Namespaces are one honking great idea  lets do more of those&#39;&#39;&#39;</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>The imperative approach to counting is to use the accumulator pattern with a
dictionary as the accumulator.  We start with an empty dictionary and iterate
through the words,  updating the entries of the dictionary as we go.  While we
could accomplish this by mutating the same dictionary, in this example we will
use <code class="docutils literal"><span class="pre">assoc</span></code> to return a new, updated, copy of the dictionary.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [63]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">assoc</span>

<span class="gp">In [64]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">zen_no_punc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="gp">In [65]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [66]: </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">update_count</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">   ....: </span>    <span class="n">counts</span> <span class="o">=</span> <span class="n">assoc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">update_count</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [67]: </span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;implementation&#39;</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gh">Out[67]: </span><span class="go">2</span>
</pre></div>
</div>
<p>There are a couple of things to note in this example.  First, we are using
<code class="docutils literal"><span class="pre">get</span></code> with a default value of 0 to get the current count.  As we are starting
with an empty dictionary, the default value will be used the first time we see
each word.  When we subsequent occurrences of the word, <code class="docutils literal"><span class="pre">get</span></code> will return the
value stored in the dictionary.</p>
<p>Also of note is using <code class="docutils literal"><span class="pre">assoc</span></code> to update and save a fresh copy of the
dictionary.   As we work through the words, counts will accumulate more and more
information about the word frequencies.</p>
<p>To make this pattern clear, we first write the helper functions <code class="docutils literal"><span class="pre">update_count</span></code>
and <code class="docutils literal"><span class="pre">update_dict</span></code> based on the code from the imperative solution.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [68]: </span><span class="n">update_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="gp">In [69]: </span><span class="n">update_dict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">wd</span><span class="p">,</span> <span class="n">update_count</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">))</span>
</pre></div>
</div>
<p>Using these functions, the imperative solution becomes</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [70]: </span><span class="n">update_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="gp">In [71]: </span><span class="n">update_dict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">wd</span><span class="p">,</span> <span class="n">update_count</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">))</span>

<span class="gp">In [72]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [73]: </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>To get a general feel for this pattern, we rewrite the code using more general
names.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">acc</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">L</span><span class="p">:</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
<p>As we know, the accumulator patter can be abstracted with the <code class="docutils literal"><span class="pre">reduce</span></code>
function.  The solution using <code class="docutils literal"><span class="pre">reduce</span></code> uses the same update functions and
initial value as show above.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [74]: </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="nb">reduce</span>

<span class="gp">In [75]: </span><span class="n">update_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">counts</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="gp">In [76]: </span><span class="n">update_dict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wd</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">wd</span><span class="p">,</span> <span class="n">update_count</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">wd</span><span class="p">))</span>

<span class="gp">In [77]: </span><span class="nb">reduce</span><span class="p">(</span><span class="n">update_dict</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="p">{})</span>
<span class="gh">Out[77]: </span><span class="go"></span>
<span class="go">{&#39;a&#39;: 2,</span>
<span class="go"> &#39;although&#39;: 3,</span>
<span class="go"> &#39;ambiguity&#39;: 1,</span>
<span class="go"> &#39;and&#39;: 1,</span>
<span class="go"> &#39;are&#39;: 1,</span>
<span class="go"> &#39;arent&#39;: 1,</span>
<span class="go"> &#39;at&#39;: 1,</span>
<span class="go"> &#39;bad&#39;: 1,</span>
<span class="go"> &#39;be&#39;: 3,</span>
<span class="go"> &#39;beats&#39;: 1,</span>
<span class="go"> &#39;beautiful&#39;: 1,</span>
<span class="go"> &#39;better&#39;: 8,</span>
<span class="go"> &#39;break&#39;: 1,</span>
<span class="go"> &#39;by&#39;: 1,</span>
<span class="go"> &#39;cases&#39;: 1,</span>
<span class="go"> &#39;complex&#39;: 2,</span>
<span class="go"> &#39;complicated&#39;: 1,</span>
<span class="go"> &#39;counts&#39;: 1,</span>
<span class="go"> &#39;dense&#39;: 1,</span>
<span class="go"> &#39;do&#39;: 2,</span>
<span class="go"> &#39;dutch&#39;: 1,</span>
<span class="go"> &#39;easy&#39;: 1,</span>
<span class="go"> &#39;enough&#39;: 1,</span>
<span class="go"> &#39;errors&#39;: 1,</span>
<span class="go"> &#39;explain&#39;: 2,</span>
<span class="go"> &#39;explicit&#39;: 1,</span>
<span class="go"> &#39;explicitly&#39;: 1,</span>
<span class="go"> &#39;face&#39;: 1,</span>
<span class="go"> &#39;first&#39;: 1,</span>
<span class="go"> &#39;flat&#39;: 1,</span>
<span class="go"> &#39;good&#39;: 1,</span>
<span class="go"> &#39;great&#39;: 1,</span>
<span class="go"> &#39;guess&#39;: 1,</span>
<span class="go"> &#39;hard&#39;: 1,</span>
<span class="go"> &#39;honking&#39;: 1,</span>
<span class="go"> &#39;idea&#39;: 3,</span>
<span class="go"> &#39;if&#39;: 2,</span>
<span class="go"> &#39;implementation&#39;: 2,</span>
<span class="go"> &#39;implicit&#39;: 1,</span>
<span class="go"> &#39;in&#39;: 1,</span>
<span class="go"> &#39;is&#39;: 10,</span>
<span class="go"> &#39;it&#39;: 2,</span>
<span class="go"> &#39;its&#39;: 1,</span>
<span class="go"> &#39;lets&#39;: 1,</span>
<span class="go"> &#39;may&#39;: 2,</span>
<span class="go"> &#39;more&#39;: 1,</span>
<span class="go"> &#39;namespaces&#39;: 1,</span>
<span class="go"> &#39;nested&#39;: 1,</span>
<span class="go"> &#39;never&#39;: 3,</span>
<span class="go"> &#39;not&#39;: 1,</span>
<span class="go"> &#39;now&#39;: 2,</span>
<span class="go"> &#39;obvious&#39;: 2,</span>
<span class="go"> &#39;of&#39;: 3,</span>
<span class="go"> &#39;often&#39;: 1,</span>
<span class="go"> &#39;one&#39;: 3,</span>
<span class="go"> &#39;only&#39;: 1,</span>
<span class="go"> &#39;pass&#39;: 1,</span>
<span class="go"> &#39;peters&#39;: 1,</span>
<span class="go"> &#39;practicality&#39;: 1,</span>
<span class="go"> &#39;preferably&#39;: 1,</span>
<span class="go"> &#39;purity&#39;: 1,</span>
<span class="go"> &#39;python&#39;: 1,</span>
<span class="go"> &#39;readability&#39;: 1,</span>
<span class="go"> &#39;refuse&#39;: 1,</span>
<span class="go"> &#39;right&#39;: 1,</span>
<span class="go"> &#39;rules&#39;: 1,</span>
<span class="go"> &#39;should&#39;: 2,</span>
<span class="go"> &#39;silenced&#39;: 1,</span>
<span class="go"> &#39;silently&#39;: 1,</span>
<span class="go"> &#39;simple&#39;: 1,</span>
<span class="go"> &#39;sparse&#39;: 1,</span>
<span class="go"> &#39;special&#39;: 2,</span>
<span class="go"> &#39;temptation&#39;: 1,</span>
<span class="go"> &#39;than&#39;: 8,</span>
<span class="go"> &#39;that&#39;: 1,</span>
<span class="go"> &#39;the&#39;: 6,</span>
<span class="go"> &#39;there&#39;: 1,</span>
<span class="go"> &#39;those&#39;: 1,</span>
<span class="go"> &#39;tim&#39;: 1,</span>
<span class="go"> &#39;to&#39;: 5,</span>
<span class="go"> &#39;ugly&#39;: 1,</span>
<span class="go"> &#39;unless&#39;: 2,</span>
<span class="go"> &#39;way&#39;: 2,</span>
<span class="go"> &#39;youre&#39;: 1,</span>
<span class="go"> &#39;zen&#39;: 1}</span>
</pre></div>
</div>
<p>Like most common functional patterns, there are probably already solutions
available in some Python module.  In this case, the <code class="docutils literal"><span class="pre">toolz</span></code> package has a
function called <code class="docutils literal"><span class="pre">frequencies</span></code> that performs the task of counting occurrences of
items in a sequence.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [78]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">frequencies</span>

<span class="gp">In [79]: </span><span class="n">frequencies</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="gh">Out[79]: </span><span class="go"></span>
<span class="go">{&#39;a&#39;: 2,</span>
<span class="go"> &#39;although&#39;: 3,</span>
<span class="go"> &#39;ambiguity&#39;: 1,</span>
<span class="go"> &#39;and&#39;: 1,</span>
<span class="go"> &#39;are&#39;: 1,</span>
<span class="go"> &#39;arent&#39;: 1,</span>
<span class="go"> &#39;at&#39;: 1,</span>
<span class="go"> &#39;bad&#39;: 1,</span>
<span class="go"> &#39;be&#39;: 3,</span>
<span class="go"> &#39;beats&#39;: 1,</span>
<span class="go"> &#39;beautiful&#39;: 1,</span>
<span class="go"> &#39;better&#39;: 8,</span>
<span class="go"> &#39;break&#39;: 1,</span>
<span class="go"> &#39;by&#39;: 1,</span>
<span class="go"> &#39;cases&#39;: 1,</span>
<span class="go"> &#39;complex&#39;: 2,</span>
<span class="go"> &#39;complicated&#39;: 1,</span>
<span class="go"> &#39;counts&#39;: 1,</span>
<span class="go"> &#39;dense&#39;: 1,</span>
<span class="go"> &#39;do&#39;: 2,</span>
<span class="go"> &#39;dutch&#39;: 1,</span>
<span class="go"> &#39;easy&#39;: 1,</span>
<span class="go"> &#39;enough&#39;: 1,</span>
<span class="go"> &#39;errors&#39;: 1,</span>
<span class="go"> &#39;explain&#39;: 2,</span>
<span class="go"> &#39;explicit&#39;: 1,</span>
<span class="go"> &#39;explicitly&#39;: 1,</span>
<span class="go"> &#39;face&#39;: 1,</span>
<span class="go"> &#39;first&#39;: 1,</span>
<span class="go"> &#39;flat&#39;: 1,</span>
<span class="go"> &#39;good&#39;: 1,</span>
<span class="go"> &#39;great&#39;: 1,</span>
<span class="go"> &#39;guess&#39;: 1,</span>
<span class="go"> &#39;hard&#39;: 1,</span>
<span class="go"> &#39;honking&#39;: 1,</span>
<span class="go"> &#39;idea&#39;: 3,</span>
<span class="go"> &#39;if&#39;: 2,</span>
<span class="go"> &#39;implementation&#39;: 2,</span>
<span class="go"> &#39;implicit&#39;: 1,</span>
<span class="go"> &#39;in&#39;: 1,</span>
<span class="go"> &#39;is&#39;: 10,</span>
<span class="go"> &#39;it&#39;: 2,</span>
<span class="go"> &#39;its&#39;: 1,</span>
<span class="go"> &#39;lets&#39;: 1,</span>
<span class="go"> &#39;may&#39;: 2,</span>
<span class="go"> &#39;more&#39;: 1,</span>
<span class="go"> &#39;namespaces&#39;: 1,</span>
<span class="go"> &#39;nested&#39;: 1,</span>
<span class="go"> &#39;never&#39;: 3,</span>
<span class="go"> &#39;not&#39;: 1,</span>
<span class="go"> &#39;now&#39;: 2,</span>
<span class="go"> &#39;obvious&#39;: 2,</span>
<span class="go"> &#39;of&#39;: 3,</span>
<span class="go"> &#39;often&#39;: 1,</span>
<span class="go"> &#39;one&#39;: 3,</span>
<span class="go"> &#39;only&#39;: 1,</span>
<span class="go"> &#39;pass&#39;: 1,</span>
<span class="go"> &#39;peters&#39;: 1,</span>
<span class="go"> &#39;practicality&#39;: 1,</span>
<span class="go"> &#39;preferably&#39;: 1,</span>
<span class="go"> &#39;purity&#39;: 1,</span>
<span class="go"> &#39;python&#39;: 1,</span>
<span class="go"> &#39;readability&#39;: 1,</span>
<span class="go"> &#39;refuse&#39;: 1,</span>
<span class="go"> &#39;right&#39;: 1,</span>
<span class="go"> &#39;rules&#39;: 1,</span>
<span class="go"> &#39;should&#39;: 2,</span>
<span class="go"> &#39;silenced&#39;: 1,</span>
<span class="go"> &#39;silently&#39;: 1,</span>
<span class="go"> &#39;simple&#39;: 1,</span>
<span class="go"> &#39;sparse&#39;: 1,</span>
<span class="go"> &#39;special&#39;: 2,</span>
<span class="go"> &#39;temptation&#39;: 1,</span>
<span class="go"> &#39;than&#39;: 8,</span>
<span class="go"> &#39;that&#39;: 1,</span>
<span class="go"> &#39;the&#39;: 6,</span>
<span class="go"> &#39;there&#39;: 1,</span>
<span class="go"> &#39;those&#39;: 1,</span>
<span class="go"> &#39;tim&#39;: 1,</span>
<span class="go"> &#39;to&#39;: 5,</span>
<span class="go"> &#39;ugly&#39;: 1,</span>
<span class="go"> &#39;unless&#39;: 2,</span>
<span class="go"> &#39;way&#39;: 2,</span>
<span class="go"> &#39;youre&#39;: 1,</span>
<span class="go"> &#39;zen&#39;: 1}</span>
</pre></div>
</div>
</div>
<div class="section" id="counting-frequencies-using-a-key-function">
<h2>7.6.4. Counting Frequencies Using a Key Function<a class="headerlink" href="#counting-frequencies-using-a-key-function" title="Permalink to this headline">¶</a></h2>
<p>The function <strong>countby</strong>  uses pattern similar to <code class="docutils literal"><span class="pre">frequencies</span></code>, but is bit
more general.  Instead of counting frequencies of the raw data, we will first
transform the data with a key function, then count the occurrences of these
values.  There is a restriction on the key-function, it must return an immutable
object that can be used as a key in a dictionary.</p>
<p>Returning to the Zen of Python, this time we will count the number of words by
length, that is count how many words are in the text for each word length
present.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [80]: </span><span class="n">zen_no_punc</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="gp">   ....: </span><span class="s1">The Zen of Python by Tim Peters</span>
<span class="gp">   ....: </span><span class="s1">Beautiful is better than ugly</span>
<span class="gp">   ....: </span><span class="s1">Explicit is better than implicit</span>
<span class="gp">   ....: </span><span class="s1">Simple is better than complex</span>
<span class="gp">   ....: </span><span class="s1">Complex is better than complicated</span>
<span class="gp">   ....: </span><span class="s1">Flat is better than nested</span>
<span class="gp">   ....: </span><span class="s1">Sparse is better than dense</span>
<span class="gp">   ....: </span><span class="s1">Readability counts</span>
<span class="gp">   ....: </span><span class="s1">Special cases arent special enough to break the rules</span>
<span class="gp">   ....: </span><span class="s1">Although practicality beats purity</span>
<span class="gp">   ....: </span><span class="s1">Errors should never pass silently</span>
<span class="gp">   ....: </span><span class="s1">Unless explicitly silenced</span>
<span class="gp">   ....: </span><span class="s1">In the face of ambiguity refuse the temptation to guess</span>
<span class="gp">   ....: </span><span class="s1">There should be one and preferably only one obvious way to do it</span>
<span class="gp">   ....: </span><span class="s1">Although that way may not be obvious at first unless youre Dutch</span>
<span class="gp">   ....: </span><span class="s1">Now is better than never</span>
<span class="gp">   ....: </span><span class="s1">Although never is often better than right now</span>
<span class="gp">   ....: </span><span class="s1">If the implementation is hard to explain its a bad idea</span>
<span class="gp">   ....: </span><span class="s1">If the implementation is easy to explain it may be a good idea</span>
<span class="gp">   ....: </span><span class="s1">Namespaces are one honking great idea  lets do more of those&#39;&#39;&#39;</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>We start with the imperative approach, which will again use the accumulator
pattern to update a dictionary as we iterate through the sequence.  The added
wrinkle is using a key-function, in this case <code class="docutils literal"><span class="pre">len</span></code> on each element before we
update the dictionary.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [81]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">assoc</span>

<span class="gp">In [82]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">zen_no_punc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="gp">In [83]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [84]: </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">update_count</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">),</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">   ....: </span>    <span class="n">counts</span> <span class="o">=</span> <span class="n">assoc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">),</span> <span class="n">update_count</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [85]: </span><span class="n">counts</span>
<span class="gh">Out[85]: </span><span class="go"></span>
<span class="go">{1: 2,</span>
<span class="go"> 2: 30,</span>
<span class="go"> 3: 22,</span>
<span class="go"> 4: 22,</span>
<span class="go"> 5: 18,</span>
<span class="go"> 6: 22,</span>
<span class="go"> 7: 9,</span>
<span class="go"> 8: 7,</span>
<span class="go"> 9: 2,</span>
<span class="go"> 10: 4,</span>
<span class="go"> 11: 2,</span>
<span class="go"> 12: 1,</span>
<span class="go"> 14: 2}</span>
</pre></div>
</div>
<p>To clean this example up and illustrate the main pattern, we again make some
helper functions for updating the counts and updating the count dictionary.  The
only difference between these functions and those from the earlier sections is</p>
<ol class="arabic simple">
<li>We have changed the parameter name to indicate that we are counting lengths
here.</li>
<li>We need to apply the length function before updating the dictionary. In
anticipation of a more general pattern, we will pass the length function to
<code class="docutils literal"><span class="pre">update_dict</span></code> through a parameter named <code class="docutils literal"><span class="pre">key</span></code>.</li>
</ol>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [86]: </span><span class="n">update_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">length</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="gp">In [87]: </span><span class="n">update_dict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">,</span> <span class="n">wd</span><span class="p">,</span> <span class="n">cnts</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">key</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span> <span class="n">update_count</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span> <span class="n">cnts</span><span class="p">))</span>

<span class="gp">In [88]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [89]: </span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [90]: </span><span class="n">counts</span>
<span class="gh">Out[90]: </span><span class="go"></span>
<span class="go">{1: 2,</span>
<span class="go"> 2: 30,</span>
<span class="go"> 3: 22,</span>
<span class="go"> 4: 22,</span>
<span class="go"> 5: 18,</span>
<span class="go"> 6: 22,</span>
<span class="go"> 7: 9,</span>
<span class="go"> 8: 7,</span>
<span class="go"> 9: 2,</span>
<span class="go"> 10: 4,</span>
<span class="go"> 11: 2,</span>
<span class="go"> 12: 1,</span>
<span class="go"> 14: 2}</span>
</pre></div>
</div>
<p>As noted above, the same update function can be used to both the imperative and
<code class="docutils literal"><span class="pre">reduce</span></code> solutions.  The presence of the <code class="docutils literal"><span class="pre">key</span></code> parameter in the update
function means that we will also make this a parameter in the reduce helper function
so that it can be passed along from call to call.  This is accomplished using a
curried function.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [91]: </span><span class="k">def</span> <span class="nf">make_update_dict</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="n">update_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">length</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wd</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">key</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span> <span class="n">update_count</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span> <span class="n">cnts</span><span class="p">))</span>
<span class="gp">   ....: </span>

<span class="gp">In [92]: </span><span class="n">countby</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">,</span> <span class="n">lst</span><span class="p">:</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">make_update_dict</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">lst</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="gp">In [93]: </span><span class="n">countby</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-93-baaff18a9647&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">countby</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-92-01c85b80c529&gt;</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(key, lst)</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">countby</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">,</span> <span class="n">lst</span><span class="p">:</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">make_update_dict</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">lst</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-91-aacb57d7cf77&gt;</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(cnts, wd)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">make_update_dict</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">update_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">length</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="k">return</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wd</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="n">key</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span> <span class="n">update_count</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="n">wd</span><span class="p">),</span> <span class="n">cnts</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 

<span class="nn">/Users/tiverson/.pyenv/versions/3.5.2/envs/runestone/lib/python3.5/site-packages/toolz/dicttoolz.py</span> in <span class="ni">assoc</span><span class="nt">(d, key, value, factory)</span>
<span class="g g-Whitespace">    </span><span class="mi">194</span>     <span class="n">d2</span> <span class="o">=</span> <span class="n">factory</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">195</span>     <span class="n">d2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="ne">--&gt; </span><span class="mi">196</span>     <span class="k">return</span> <span class="n">merge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">factory</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">197</span> 
<span class="g g-Whitespace">    </span><span class="mi">198</span> 

<span class="nn">/Users/tiverson/.pyenv/versions/3.5.2/envs/runestone/lib/python3.5/site-packages/toolz/dicttoolz.py</span> in <span class="ni">merge</span><span class="nt">(*dicts, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span>     <span class="n">rv</span> <span class="o">=</span> <span class="n">factory</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>     <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">39</span>         <span class="n">rv</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>     <span class="k">return</span> <span class="n">rv</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> 

<span class="ne">TypeError</span>: &#39;int&#39; object is not iterable
</pre></div>
</div>
<p>Now that we understand the <code class="docutils literal"><span class="pre">countby</span></code> pattern, there is no reason to have to
implement it again, and in fact, this function is also available in the
<code class="docutils literal"><span class="pre">toolz</span></code> module.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [94]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">countby</span>

<span class="gp">In [95]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">zen_no_punc</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="gp">In [96]: </span><span class="n">countby</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
<span class="gh">Out[96]: </span><span class="go"></span>
<span class="go">{1: 2,</span>
<span class="go"> 2: 30,</span>
<span class="go"> 3: 22,</span>
<span class="go"> 4: 22,</span>
<span class="go"> 5: 18,</span>
<span class="go"> 6: 22,</span>
<span class="go"> 7: 9,</span>
<span class="go"> 8: 7,</span>
<span class="go"> 9: 2,</span>
<span class="go"> 10: 4,</span>
<span class="go"> 11: 2,</span>
<span class="go"> 12: 1,</span>
<span class="go"> 14: 2}</span>
</pre></div>
</div>
<p>One final note about <code class="docutils literal"><span class="pre">countby</span></code>.  To see that <code class="docutils literal"><span class="pre">countby</span></code> is generalization of
<code class="docutils literal"><span class="pre">frequencies</span></code>, we note that using the <code class="docutils literal"><span class="pre">identity</span></code> function with <code class="docutils literal"><span class="pre">countby</span></code>
is equivalent to <code class="docutils literal"><span class="pre">frequencies</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [97]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">countby</span><span class="p">,</span> <span class="n">identity</span>

<span class="gp">In [98]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">zen_no_punc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="gp">In [99]: </span><span class="n">countby</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
<span class="gh">Out[99]: </span><span class="go"></span>
<span class="go">{&#39;a&#39;: 2,</span>
<span class="go"> &#39;although&#39;: 3,</span>
<span class="go"> &#39;ambiguity&#39;: 1,</span>
<span class="go"> &#39;and&#39;: 1,</span>
<span class="go"> &#39;are&#39;: 1,</span>
<span class="go"> &#39;arent&#39;: 1,</span>
<span class="go"> &#39;at&#39;: 1,</span>
<span class="go"> &#39;bad&#39;: 1,</span>
<span class="go"> &#39;be&#39;: 3,</span>
<span class="go"> &#39;beats&#39;: 1,</span>
<span class="go"> &#39;beautiful&#39;: 1,</span>
<span class="go"> &#39;better&#39;: 8,</span>
<span class="go"> &#39;break&#39;: 1,</span>
<span class="go"> &#39;by&#39;: 1,</span>
<span class="go"> &#39;cases&#39;: 1,</span>
<span class="go"> &#39;complex&#39;: 2,</span>
<span class="go"> &#39;complicated&#39;: 1,</span>
<span class="go"> &#39;counts&#39;: 1,</span>
<span class="go"> &#39;dense&#39;: 1,</span>
<span class="go"> &#39;do&#39;: 2,</span>
<span class="go"> &#39;dutch&#39;: 1,</span>
<span class="go"> &#39;easy&#39;: 1,</span>
<span class="go"> &#39;enough&#39;: 1,</span>
<span class="go"> &#39;errors&#39;: 1,</span>
<span class="go"> &#39;explain&#39;: 2,</span>
<span class="go"> &#39;explicit&#39;: 1,</span>
<span class="go"> &#39;explicitly&#39;: 1,</span>
<span class="go"> &#39;face&#39;: 1,</span>
<span class="go"> &#39;first&#39;: 1,</span>
<span class="go"> &#39;flat&#39;: 1,</span>
<span class="go"> &#39;good&#39;: 1,</span>
<span class="go"> &#39;great&#39;: 1,</span>
<span class="go"> &#39;guess&#39;: 1,</span>
<span class="go"> &#39;hard&#39;: 1,</span>
<span class="go"> &#39;honking&#39;: 1,</span>
<span class="go"> &#39;idea&#39;: 3,</span>
<span class="go"> &#39;if&#39;: 2,</span>
<span class="go"> &#39;implementation&#39;: 2,</span>
<span class="go"> &#39;implicit&#39;: 1,</span>
<span class="go"> &#39;in&#39;: 1,</span>
<span class="go"> &#39;is&#39;: 10,</span>
<span class="go"> &#39;it&#39;: 2,</span>
<span class="go"> &#39;its&#39;: 1,</span>
<span class="go"> &#39;lets&#39;: 1,</span>
<span class="go"> &#39;may&#39;: 2,</span>
<span class="go"> &#39;more&#39;: 1,</span>
<span class="go"> &#39;namespaces&#39;: 1,</span>
<span class="go"> &#39;nested&#39;: 1,</span>
<span class="go"> &#39;never&#39;: 3,</span>
<span class="go"> &#39;not&#39;: 1,</span>
<span class="go"> &#39;now&#39;: 2,</span>
<span class="go"> &#39;obvious&#39;: 2,</span>
<span class="go"> &#39;of&#39;: 3,</span>
<span class="go"> &#39;often&#39;: 1,</span>
<span class="go"> &#39;one&#39;: 3,</span>
<span class="go"> &#39;only&#39;: 1,</span>
<span class="go"> &#39;pass&#39;: 1,</span>
<span class="go"> &#39;peters&#39;: 1,</span>
<span class="go"> &#39;practicality&#39;: 1,</span>
<span class="go"> &#39;preferably&#39;: 1,</span>
<span class="go"> &#39;purity&#39;: 1,</span>
<span class="go"> &#39;python&#39;: 1,</span>
<span class="go"> &#39;readability&#39;: 1,</span>
<span class="go"> &#39;refuse&#39;: 1,</span>
<span class="go"> &#39;right&#39;: 1,</span>
<span class="go"> &#39;rules&#39;: 1,</span>
<span class="go"> &#39;should&#39;: 2,</span>
<span class="go"> &#39;silenced&#39;: 1,</span>
<span class="go"> &#39;silently&#39;: 1,</span>
<span class="go"> &#39;simple&#39;: 1,</span>
<span class="go"> &#39;sparse&#39;: 1,</span>
<span class="go"> &#39;special&#39;: 2,</span>
<span class="go"> &#39;temptation&#39;: 1,</span>
<span class="go"> &#39;than&#39;: 8,</span>
<span class="go"> &#39;that&#39;: 1,</span>
<span class="go"> &#39;the&#39;: 6,</span>
<span class="go"> &#39;there&#39;: 1,</span>
<span class="go"> &#39;those&#39;: 1,</span>
<span class="go"> &#39;tim&#39;: 1,</span>
<span class="go"> &#39;to&#39;: 5,</span>
<span class="go"> &#39;ugly&#39;: 1,</span>
<span class="go"> &#39;unless&#39;: 2,</span>
<span class="go"> &#39;way&#39;: 2,</span>
<span class="go"> &#39;youre&#39;: 1,</span>
<span class="go"> &#39;zen&#39;: 1}</span>
</pre></div>
</div>
</div>
<div class="section" id="grouping-values-with-groupby">
<h2>7.6.5. Grouping values with <code class="docutils literal"><span class="pre">groupby</span></code><a class="headerlink" href="#grouping-values-with-groupby" title="Permalink to this headline">¶</a></h2>
<p>The functions <code class="docutils literal"><span class="pre">frequencies</span></code> and <code class="docutils literal"><span class="pre">countby</span></code> are examples of functions that
group data by some key and then reduce the resulting group to a count.  We can
generalize this process by separating the grouping and the reduction.</p>
<p>The first action, will group the values by some key.  In our first example, we
will group a table by the values from a given column.  We will start with the
imperative solution.  We will be using <code class="docutils literal"><span class="pre">get</span></code> to get the current group with a
default value of a empty list.  These values (lists) are updated by appending
the current value.  To keep the values immutable and the appends efficient, we
will use a persistent vector in place of a list.
In this example, we will keep <em>group</em> the hours <em>by</em> title.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [100]: </span><span class="kn">from</span> <span class="nn">toolz.curried</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">drop</span><span class="p">,</span> <span class="n">assoc</span>

<span class="gp">In [101]: </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="gp">In [102]: </span><span class="kn">from</span> <span class="nn">pyrsistent</span> <span class="kn">import</span> <span class="n">pvector</span>

<span class="gp">In [103]: </span><span class="n">hours</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s1">&#39;Ann&#39;</span><span class="p">,</span>   <span class="s1">&#39;42&#39;</span><span class="p">,</span>    <span class="s1">&#39;37.5&#39;</span><span class="p">,</span> <span class="s1">&#39;manager&#39;</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span>   <span class="s1">&#39;55&#39;</span><span class="p">,</span>    <span class="s1">&#39;7.5&#39;</span> <span class="p">,</span> <span class="s1">&#39;assembly&#39;</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span>    <span class="s1">&#39;225&#39;</span> <span class="p">,</span> <span class="s1">&#39;consultant&#39;</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s1">&#39;Ann&#39;</span><span class="p">,</span>   <span class="s1">&#39;44&#39;</span><span class="p">,</span>    <span class="s1">&#39;37.5&#39;</span><span class="p">,</span> <span class="s1">&#39;manager&#39;</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span>   <span class="s1">&#39;51&#39;</span><span class="p">,</span>    <span class="s1">&#39;7.5&#39;</span> <span class="p">,</span> <span class="s1">&#39;assembly&#39;</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">,</span>    <span class="s1">&#39;225&#39;</span> <span class="p">,</span> <span class="s1">&#39;consultant&#39;</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s1">&#39;Ann&#39;</span><span class="p">,</span>   <span class="s1">&#39;52&#39;</span><span class="p">,</span>    <span class="s1">&#39;37.5&#39;</span><span class="p">,</span> <span class="s1">&#39;manager&#39;</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span>   <span class="s1">&#39;45&#39;</span><span class="p">,</span>    <span class="s1">&#39;8.5&#39;</span> <span class="p">,</span> <span class="s1">&#39;assembly&#39;</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;17&#39;</span><span class="p">,</span>    <span class="s1">&#39;225&#39;</span> <span class="p">,</span> <span class="s1">&#39;consultant&#39;</span><span class="p">]]</span>
<span class="gp">   .....: </span>
</pre></div>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [104]: </span><span class="n">get_group_by_key</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">get</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">pvector</span><span class="p">([]))</span>

<span class="gp">In [105]: </span><span class="n">get_key</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="gp">In [106]: </span><span class="n">get_hours</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">In [107]: </span><span class="n">rest</span> <span class="o">=</span> <span class="n">drop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">In [108]: </span><span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [109]: </span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rest</span><span class="p">(</span><span class="n">hours</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="n">key</span> <span class="o">=</span> <span class="n">get_key</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="n">current_group</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">pvector</span><span class="p">([]))</span>
<span class="gp">   .....: </span>    <span class="n">current_hours</span> <span class="o">=</span> <span class="n">get_hours</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="n">new_group</span> <span class="o">=</span> <span class="n">current_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_hours</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="n">groups</span> <span class="o">=</span> <span class="n">assoc</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">new_group</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [110]: </span><span class="n">groups</span>
<span class="gh">Out[110]: </span><span class="go"></span>
<span class="go">{&#39;assembly&#39;: pvector([&#39;55&#39;, &#39;51&#39;, &#39;45&#39;]),</span>
<span class="go"> &#39;consultant&#39;: pvector([&#39;12&#39;, &#39;14&#39;, &#39;17&#39;]),</span>
<span class="go"> &#39;manager&#39;: pvector([&#39;42&#39;, &#39;44&#39;, &#39;52&#39;])}</span>
</pre></div>
</div>
<p>We recognize this as the accumulator pattern, but to make the update a little
more clear, we will refactor the loop as follows.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [111]: </span><span class="k">def</span> <span class="nf">update_groups</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="sd">&#39;&#39;&#39; helper functions to update the groups&#39;&#39;&#39;</span>
<span class="gp">   .....: </span>    <span class="n">get_key</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="n">get_hours</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="n">key</span> <span class="o">=</span> <span class="n">get_key</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="n">current_group</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">pvector</span><span class="p">([]))</span>
<span class="gp">   .....: </span>    <span class="n">current_hours</span> <span class="o">=</span> <span class="n">get_hours</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="n">new_group</span> <span class="o">=</span> <span class="n">current_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_hours</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="n">assoc</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">new_group</span><span class="p">)</span>
<span class="gp">   .....: </span>
</pre></div>
</div>
<p>Then the loop for updating the groups becomes</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [112]: </span><span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [113]: </span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">hours</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
<span class="gp">   .....: </span>    <span class="n">groups</span> <span class="o">=</span> <span class="n">update_groups</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [114]: </span><span class="n">groups</span>
<span class="gh">Out[114]: </span><span class="go"></span>
<span class="go">{&#39;assembly&#39;: pvector([&#39;55&#39;, &#39;51&#39;, &#39;45&#39;]),</span>
<span class="go"> &#39;consultant&#39;: pvector([&#39;12&#39;, &#39;14&#39;, &#39;17&#39;]),</span>
<span class="go"> &#39;manager&#39;: pvector([&#39;42&#39;, &#39;44&#39;, &#39;52&#39;])}</span>
</pre></div>
</div>
<p>and the relationship to <code class="docutils literal"><span class="pre">reduce</span></code> becomes clear.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [115]: </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="nb">reduce</span>

<span class="gp">In [116]: </span><span class="nb">reduce</span><span class="p">(</span><span class="n">update_groups</span><span class="p">,</span> <span class="n">rest</span><span class="p">(</span><span class="n">hours</span><span class="p">),</span> <span class="p">{})</span>
<span class="gh">Out[116]: </span><span class="go"></span>
<span class="go">{&#39;assembly&#39;: pvector([&#39;55&#39;, &#39;51&#39;, &#39;45&#39;]),</span>
<span class="go"> &#39;consultant&#39;: pvector([&#39;12&#39;, &#39;14&#39;, &#39;17&#39;]),</span>
<span class="go"> &#39;manager&#39;: pvector([&#39;42&#39;, &#39;44&#39;, &#39;52&#39;])}</span>
</pre></div>
</div>
<p>This process can be abstracted by allowing the user to specify a key function
like <code class="docutils literal"><span class="pre">get_key</span></code> in the above example.  We will call this generalization
<code class="docutils literal"><span class="pre">groupby</span></code>, as we are <em>grouping</em> the elements of the sequence <em>by</em> some key.
Here is the implementation based on reduce.  Also, this instance will add the
whole element of the sequence to the group.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [117]: </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="nb">reduce</span>

<span class="gp">In [118]: </span><span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="n">key_func</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="sd">&#39;&#39;&#39; Group all items in seq by the value of the key_function&#39;&#39;&#39;</span>
<span class="gp">   .....: </span>    <span class="k">def</span> <span class="nf">update_groups</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="gp">   .....: </span>        <span class="sd">&#39;&#39;&#39; helper functions to update the groups&#39;&#39;&#39;</span>
<span class="gp">   .....: </span>        <span class="n">key</span> <span class="o">=</span> <span class="n">key_func</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="gp">   .....: </span>        <span class="n">current_group</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">pvector</span><span class="p">([]))</span>
<span class="gp">   .....: </span>        <span class="n">new_group</span> <span class="o">=</span> <span class="n">current_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="gp">   .....: </span>        <span class="k">return</span> <span class="n">assoc</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">new_group</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">update_groups</span><span class="p">,</span> <span class="n">rest</span><span class="p">(</span><span class="n">hours</span><span class="p">),</span> <span class="p">{})</span>
<span class="gp">   .....: </span>

<span class="gp">In [119]: </span><span class="n">groupby</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">hours</span><span class="p">)</span>
<span class="gh">Out[119]: </span><span class="go">{&#39;17&#39;: pvector([[&#39;Ann&#39;, &#39;42&#39;, &#39;37.5&#39;, &#39;manager&#39;], [&#39;Bob&#39;, &#39;55&#39;, &#39;7.5&#39;, &#39;assembly&#39;], [&#39;Alice&#39;, &#39;12&#39;, &#39;225&#39;, &#39;consultant&#39;], [&#39;Ann&#39;, &#39;44&#39;, &#39;37.5&#39;, &#39;manager&#39;], [&#39;Bob&#39;, &#39;51&#39;, &#39;7.5&#39;, &#39;assembly&#39;], [&#39;Alice&#39;, &#39;14&#39;, &#39;225&#39;, &#39;consultant&#39;], [&#39;Ann&#39;, &#39;52&#39;, &#39;37.5&#39;, &#39;manager&#39;], [&#39;Bob&#39;, &#39;45&#39;, &#39;8.5&#39;, &#39;assembly&#39;], [&#39;Alice&#39;, &#39;17&#39;, &#39;225&#39;, &#39;consultant&#39;]])}</span>
</pre></div>
</div>
<p>As you might expect, <code class="docutils literal"><span class="pre">groupby</span></code> is provided by the <code class="docutils literal"><span class="pre">toolz</span></code> library.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [120]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">groupby</span>

<span class="gp">In [121]: </span><span class="n">groupby</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">hours</span><span class="p">)</span>
<span class="gh">Out[121]: </span><span class="go"></span>
<span class="go">{&#39;assembly&#39;: [[&#39;Bob&#39;, &#39;55&#39;, &#39;7.5&#39;, &#39;assembly&#39;],</span>
<span class="go">  [&#39;Bob&#39;, &#39;51&#39;, &#39;7.5&#39;, &#39;assembly&#39;],</span>
<span class="go">  [&#39;Bob&#39;, &#39;45&#39;, &#39;8.5&#39;, &#39;assembly&#39;]],</span>
<span class="go"> &#39;consultant&#39;: [[&#39;Alice&#39;, &#39;12&#39;, &#39;225&#39;, &#39;consultant&#39;],</span>
<span class="go">  [&#39;Alice&#39;, &#39;14&#39;, &#39;225&#39;, &#39;consultant&#39;],</span>
<span class="go">  [&#39;Alice&#39;, &#39;17&#39;, &#39;225&#39;, &#39;consultant&#39;]],</span>
<span class="go"> &#39;manager&#39;: [[&#39;Ann&#39;, &#39;42&#39;, &#39;37.5&#39;, &#39;manager&#39;],</span>
<span class="go">  [&#39;Ann&#39;, &#39;44&#39;, &#39;37.5&#39;, &#39;manager&#39;],</span>
<span class="go">  [&#39;Ann&#39;, &#39;52&#39;, &#39;37.5&#39;, &#39;manager&#39;]],</span>
<span class="go"> &#39;title&#39;: [[&#39;name&#39;, &#39;hours&#39;, &#39;rate&#39;, &#39;title&#39;]]}</span>
</pre></div>
</div>
<p>It is a common pattern to use <code class="docutils literal"><span class="pre">groupby</span></code> to group the elements, then reduce the
values using <code class="docutils literal"><span class="pre">valmap</span></code> and <code class="docutils literal"><span class="pre">reduce</span></code>.  For example, let&#8217;s compute the total
pay (sum of hours*rate) for each group.  We start by creating a function for
turning a value into the pay.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [122]: </span><span class="kn">from</span> <span class="nn">toolz.curried</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">pipe</span><span class="p">,</span> <span class="n">valmap</span>

<span class="gp">In [123]: </span><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">mul</span>

<span class="gp">In [124]: </span><span class="n">groups</span> <span class="o">=</span> <span class="n">groupby</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">hours</span><span class="p">)</span>

<span class="gp">In [125]: </span><span class="n">get_pay</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">mul</span><span class="p">(</span><span class="o">*</span><span class="n">pipe</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">get</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">)))</span>

<span class="gp">In [126]: </span><span class="n">get_pay</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hours</span><span class="p">))</span>
<span class="gh">Out[126]: </span><span class="go">1575.0</span>
</pre></div>
</div>
<p>We could do this with <code class="docutils literal"><span class="pre">reduce</span></code>, but in this case we can use a map to pull out
the pay, turn these strings into integers, and finally use <code class="docutils literal"><span class="pre">sum</span></code>.  In the
process, we will practice our use of higher-order functions.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [127]: </span><span class="kn">from</span> <span class="nn">toolz.curried</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">compose</span><span class="p">,</span> <span class="n">valmap</span>

<span class="gp">In [128]: </span><span class="n">groups</span> <span class="o">=</span> <span class="n">groupby</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rest</span><span class="p">(</span><span class="n">hours</span><span class="p">))</span>

<span class="gp">In [129]: </span><span class="n">pay_by_title</span> <span class="o">=</span> <span class="n">valmap</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">get_pay</span><span class="p">)),</span> <span class="n">groups</span><span class="p">)</span>

<span class="gp">In [130]: </span><span class="n">pay_by_title</span>
<span class="gh">Out[130]: </span><span class="go">{&#39;assembly&#39;: 1177.5, &#39;consultant&#39;: 9675.0, &#39;manager&#39;: 5175.0}</span>
</pre></div>
</div>
<p>We will provide an abstraction called <code class="docutils literal"><span class="pre">reduceby</span></code> that combines <code class="docutils literal"><span class="pre">groupby</span></code> and
<code class="docutils literal"><span class="pre">reduce</span></code> in the upcoming section on lazy evaluation.</p>
</div>
<div class="section" id="the-recursive-approach-to-counting-frequencies-optional">
<h2>7.6.6. The Recursive Approach to Counting Frequencies (Optional)<a class="headerlink" href="#the-recursive-approach-to-counting-frequencies-optional" title="Permalink to this headline">¶</a></h2>
<p>Recursion is one of the building blocks of functional programming.  A
<strong>recursive</strong> function is a function that calls itself and <strong>recursion</strong> refers
to using recursive functions to solve a problem.</p>
<p>There are some well-established abstractions that are used when using recursion
to process a list.  We start with a recursive definition of a list.  In a
recursive context, a list is either <code class="docutils literal"><span class="pre">empty</span></code> or the <code class="docutils literal"><span class="pre">first(list),</span>
<span class="pre">rest(list)</span></code>, where <code class="docutils literal"><span class="pre">first(list)</span></code> is the next entry in the list and
<code class="docutils literal"><span class="pre">rest(list)</span></code> is the remainder of the list.  We could define <code class="docutils literal"><span class="pre">first</span></code> and
<code class="docutils literal"><span class="pre">rest</span></code> on Python lists as follows.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [131]: </span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

<span class="gp">In [132]: </span><span class="n">first</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="gp">In [133]: </span><span class="n">rest</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="gp">In [134]: </span><span class="n">first</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="gh">Out[134]: </span><span class="go">1</span>

<span class="gp">In [135]: </span><span class="n">rest</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="go">            Out[135]: [2, 3, 4]</span>
</pre></div>
</div>
<p>As noted in a previous chapter, slicing all but the first element of a list is
an operation with a time complexity of <span class="math">\(O(n)\)</span>, which is an expensive
operation to apply once for each item in a list (The overall complexity would be
<span class="math">\(O(n^2)\)</span>).  We can use the <code class="docutils literal"><span class="pre">Plist</span></code> data structure from <code class="docutils literal"><span class="pre">pyrsistent</span></code>
for a more efficient approach to processing list in this way.  A <code class="docutils literal"><span class="pre">plist</span></code> comes
with methods for <code class="docutils literal"><span class="pre">first</span></code> and <code class="docutils literal"><span class="pre">rest</span></code>.  The time complexity for both the <code class="docutils literal"><span class="pre">first</span></code>
and <code class="docutils literal"><span class="pre">rest</span></code> methods of a <code class="docutils literal"><span class="pre">Plist</span></code> is constant time, i.e. <span class="math">\(O(1)\)</span>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [136]: </span><span class="kn">from</span> <span class="nn">pyrsistent</span> <span class="kn">import</span> <span class="n">plist</span>

<span class="gp">In [137]: </span><span class="n">L</span> <span class="o">=</span> <span class="n">plist</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>

<span class="gp">In [138]: </span><span class="nb">type</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="gh">Out[138]: </span><span class="go">pyrsistent._plist.PList</span>

<span class="gp">In [139]: </span><span class="n">L</span><span class="o">.</span><span class="n">first</span>
<span class="go">                                  Out[139]: 1</span>

<span class="gp">In [140]: </span><span class="n">L2</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">rest</span>

<span class="gp">In [141]: </span><span class="n">L2</span>
<span class="gh">Out[141]: </span><span class="go">plist([2, 3, 4])</span>

<span class="gp">In [142]: </span><span class="n">L</span> <span class="ow">is</span> <span class="n">L2</span>
<span class="go">                           Out[142]: False</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">L.rest</span></code> does not mutate <code class="docutils literal"><span class="pre">L</span></code>, but returns a reference to a new
<code class="docutils literal"><span class="pre">Plist</span></code>.</p>
<p>There are two more function that are useful when processing list in a recursive
fashion.  First, we need a function to check if a list is empty, which will will
call <code class="docutils literal"><span class="pre">is_empty</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [143]: </span><span class="n">is_empty</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

<span class="gp">In [144]: </span><span class="n">is_empty</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="gh">Out[144]: </span><span class="go">False</span>

<span class="gp">In [145]: </span><span class="n">is_empty</span><span class="p">(</span><span class="n">plist</span><span class="p">([]))</span>
<span class="go">                Out[145]: True</span>
</pre></div>
</div>
<p>Second, we introduce a function called <code class="docutils literal"><span class="pre">cons</span></code> to add a new
value to the beginning of a <code class="docutils literal"><span class="pre">Plist</span></code>.  Luckily, the <code class="docutils literal"><span class="pre">Plist</span></code> data structure
comes with a <code class="docutils literal"><span class="pre">cons</span></code> method.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [146]: </span><span class="kn">from</span> <span class="nn">pyrsistent</span> <span class="kn">import</span> <span class="n">plist</span>

<span class="gp">In [147]: </span><span class="n">L</span> <span class="o">=</span> <span class="n">plist</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>

<span class="gp">In [148]: </span><span class="n">L2</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">cons</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [149]: </span><span class="n">L2</span>
<span class="gh">Out[149]: </span><span class="go">plist([0, 1, 2, 3, 4])</span>

<span class="gp">In [150]: </span><span class="n">L</span> <span class="ow">is</span> <span class="n">L2</span>
<span class="go">                                 Out[150]: False</span>
</pre></div>
</div>
<p>Let&#8217;s work on a recursive solution.  Before we write the recursive solution,
consider the following <strong>laws of recursion</strong>.</p>
<div class="admonition-the-first-and-second-laws-of-recursion admonition">
<p class="first admonition-title">The First and Second Laws of Recursion</p>
<p class="last">To paraphrase <em>The Little Schemer</em>, the first law of recursion is: <strong>The first
question is ``is_empty``.</strong>  When processing a list recursive, we always
check to see if the list is empty.  The second law of recursion is to call
your function on the rest of the list.  This has the effect of always moving
toward the base case of an empty list.  Proper application of the second law
will assure that out recursive function will terminate.</p>
</div>
<p>Let&#8217;s step though processing our text to get a feel for how recursion will work.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [151]: </span><span class="kn">from</span> <span class="nn">toolz</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">assoc</span>

<span class="gp">In [152]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">plist</span><span class="p">(</span><span class="n">zen_no_punc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

<span class="gp">In [153]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [154]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-154-e3a426c3d599&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;

<span class="gp">In [155]: </span><span class="n">counts</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Out[155]: {}</span>

<span class="gp">In [156]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span>

<span class="gp">In [157]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-157-e3a426c3d599&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;

<span class="gp">In [158]: </span><span class="n">counts</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Out[158]: {}</span>

<span class="gp">In [159]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span>

<span class="gp">In [160]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-160-e3a426c3d599&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;

<span class="gp">In [161]: </span><span class="n">counts</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Out[161]: {}</span>

<span class="gp">In [162]: </span><span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span>
</pre></div>
</div>
<p>Let&#8217;s compose these expression using substitution, Specifically, we will embed
the <code class="docutils literal"><span class="pre">word</span> <span class="pre">=</span> <span class="pre">word.rest</span></code> in the line involving <code class="docutils literal"><span class="pre">assoc</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [163]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [164]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-164-e3a426c3d599&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;

<span class="gp">In [165]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-165-25ee05094f78&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 counts = update_dict(words.rest.first, counts)</span>

<span class="go">TypeError: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;</span>

<span class="gp">In [166]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-166-73c638f924ab&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 counts = update_dict(words.rest.rest.first, counts)</span>

<span class="go">TypeError: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;</span>

<span class="gp">In [167]: </span><span class="n">counts</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Out[167]: {}</span>
</pre></div>
</div>
<p>A pattern emerges.  Each <code class="docutils literal"><span class="pre">assoc</span></code> operation is called the <code class="docutils literal"><span class="pre">rest</span></code> of the last
list.  This will continue until the list is empty.  If we tried to call
<code class="docutils literal"><span class="pre">first</span></code> when the list is empty, we would get an exception.  This is the reason
for the first law of recursion: We should check <code class="docutils literal"><span class="pre">is_empty</span></code> to make sure the
recursion terminates correctly.   Let&#8217;s add a conditional statement to the last
example to be sure that we return counts once we have emptied the list.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [168]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [169]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-169-237b159372b3&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;

<span class="gp">In [170]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-170-bd1b17c88144&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 counts = counts if is_empty(words.rest) else update_dict(words.rest.first, counts)</span>

<span class="go">TypeError: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;</span>

<span class="gp">In [171]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-171-e8640766c2a1&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 counts = counts if is_empty(words.rest.rest) else update_dict(words.rest.rest.first, counts)</span>

<span class="go">TypeError: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;</span>

<span class="gp">In [172]: </span><span class="n">counts</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Out[172]: {}</span>
</pre></div>
</div>
<p>These expressions are getting a little complicated and very repetitive.  Let&#8217;s
package the core logic in a lambda expression to clean things up.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [173]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [174]: </span><span class="n">next_cnts</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wds</span><span class="p">:</span> <span class="n">cnts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">wds</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">wds</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">cnts</span><span class="p">)</span>

<span class="gp">In [175]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-175-cfbe0b566c32&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-174-a40489caf3a2&gt;</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(cnts, wds)</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">next_cnts</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wds</span><span class="p">:</span> <span class="n">cnts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">wds</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">wds</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">cnts</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;

<span class="gp">In [176]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-176-fb4dc9bd911b&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 counts = next_cnts(counts, words.rest)</span>

<span class="go">&lt;ipython-input-174-a40489caf3a2&gt; in &lt;lambda&gt;(cnts, wds)</span>
<span class="go">----&gt; 1 next_cnts = lambda cnts, wds: cnts if is_empty(wds) else update_dict(wds.first, cnts)</span>

<span class="go">TypeError: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;</span>

<span class="gp">In [177]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-177-272ac93a8a1e&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 counts = next_cnts(counts, words.rest.rest)</span>

<span class="go">&lt;ipython-input-174-a40489caf3a2&gt; in &lt;lambda&gt;(cnts, wds)</span>
<span class="go">----&gt; 1 next_cnts = lambda cnts, wds: cnts if is_empty(wds) else update_dict(wds.first, cnts)</span>

<span class="go">TypeError: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;</span>
</pre></div>
</div>
<p>We are almost there!  Again we will compose the expressions, this time using
substitution on <code class="docutils literal"><span class="pre">count</span></code>.  To make this clear, we will work through each
substitution one by one.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [178]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">({},</span> <span class="n">words</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-178-f06efe03a2cf&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">({},</span> <span class="n">words</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-174-a40489caf3a2&gt;</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(cnts, wds)</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">next_cnts</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wds</span><span class="p">:</span> <span class="n">cnts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">wds</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">wds</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">cnts</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;

<span class="gp">In [179]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-179-fb4dc9bd911b&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 counts = next_cnts(counts, words.rest)</span>

<span class="go">&lt;ipython-input-174-a40489caf3a2&gt; in &lt;lambda&gt;(cnts, wds)</span>
<span class="go">----&gt; 1 next_cnts = lambda cnts, wds: cnts if is_empty(wds) else update_dict(wds.first, cnts)</span>

<span class="go">TypeError: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;</span>

<span class="gp">In [180]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-180-272ac93a8a1e&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 counts = next_cnts(counts, words.rest.rest)</span>

<span class="go">&lt;ipython-input-174-a40489caf3a2&gt; in &lt;lambda&gt;(cnts, wds)</span>
<span class="go">----&gt; 1 next_cnts = lambda cnts, wds: cnts if is_empty(wds) else update_dict(wds.first, cnts)</span>

<span class="go">TypeError: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;</span>
</pre></div>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [181]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">next_cnts</span><span class="p">({},</span> <span class="n">words</span><span class="p">),</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-181-9e468367d5e6&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">next_cnts</span><span class="p">({},</span> <span class="n">words</span><span class="p">),</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-174-a40489caf3a2&gt;</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(cnts, wds)</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">next_cnts</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wds</span><span class="p">:</span> <span class="n">cnts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">wds</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">wds</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">cnts</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;

<span class="gp">In [182]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-182-272ac93a8a1e&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 counts = next_cnts(counts, words.rest.rest)</span>

<span class="go">&lt;ipython-input-174-a40489caf3a2&gt; in &lt;lambda&gt;(cnts, wds)</span>
<span class="go">----&gt; 1 next_cnts = lambda cnts, wds: cnts if is_empty(wds) else update_dict(wds.first, cnts)</span>

<span class="go">TypeError: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;</span>
</pre></div>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [183]: </span><span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">next_cnts</span><span class="p">(</span><span class="n">next_cnts</span><span class="p">({},</span> <span class="n">words</span><span class="p">),</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">),</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-183-391f81f57752&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">next_cnts</span><span class="p">(</span><span class="n">next_cnts</span><span class="p">(</span><span class="n">next_cnts</span><span class="p">({},</span> <span class="n">words</span><span class="p">),</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="p">),</span> <span class="n">words</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-174-a40489caf3a2&gt;</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(cnts, wds)</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">next_cnts</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wds</span><span class="p">:</span> <span class="n">cnts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">wds</span><span class="p">)</span> <span class="k">else</span> <span class="n">update_dict</span><span class="p">(</span><span class="n">wds</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">cnts</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;

<span class="gp">In [184]: </span><span class="n">counts</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Out[184]: {}</span>
</pre></div>
</div>
<p>So what we want to do is repeatedly call <code class="docutils literal"><span class="pre">next_cnts</span></code> on the output of the
last call to <code class="docutils literal"><span class="pre">next_cnts</span></code> and the rest of <code class="docutils literal"><span class="pre">words</span></code>.  We continue until the
<code class="docutils literal"><span class="pre">words</span></code> list is empty, at which point we would return the <code class="docutils literal"><span class="pre">counts</span></code>
dictionary .  Also note that the very first call to <code class="docutils literal"><span class="pre">assoc_count</span></code> is seeded
with an empty dictionary.</p>
<p>Two small changes and we have a solution.  First, we define a recursive function
<code class="docutils literal"><span class="pre">count_words</span></code>.  Second, we embed a recursive call to abstract the pattern of
calling this function over and over until completion.  Note that each call to
<code class="docutils literal"><span class="pre">count_words</span></code> needs the updated dictionary (using word.first which can now be
discarded) and the rest of the words.  Also recall that we start the process
with an empty dictionary.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [185]: </span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [186]: </span><span class="n">count_words</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wds</span><span class="p">:</span> <span class="n">cnts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">wds</span><span class="p">)</span> <span class="k">else</span> <span class="n">count_words</span><span class="p">(</span><span class="n">update_dict</span><span class="p">(</span><span class="n">wds</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">cnts</span><span class="p">),</span> <span class="n">wds</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="gp">In [187]: </span><span class="n">count_words</span><span class="p">({},</span> <span class="n">words</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-187-f2782239c01f&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">count_words</span><span class="p">({},</span> <span class="n">words</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-186-1ac22e32980f&gt;</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(cnts, wds)</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">count_words</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">cnts</span><span class="p">,</span> <span class="n">wds</span><span class="p">:</span> <span class="n">cnts</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">wds</span><span class="p">)</span> <span class="k">else</span> <span class="n">count_words</span><span class="p">(</span><span class="n">update_dict</span><span class="p">(</span><span class="n">wds</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">cnts</span><span class="p">),</span> <span class="n">wds</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="ne">TypeError</span>: &lt;lambda&gt;() missing 1 required positional argument: &#39;cnts&#39;
</pre></div>
</div>
<p>This function illustrates the pattern for recursion with an accumulator, which
is generalized in the following code.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">rec_acc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">lst</span><span class="p">:</span> <span class="n">acc</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="k">else</span> <span class="n">rec_acc</span><span class="p">(</span><span class="n">update</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">acc</span><span class="p">),</span> <span class="n">lst</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
</pre></div>
</div>
<p>The basic process is to return the accumulator <code class="docutils literal"><span class="pre">acc</span></code> if the list is empty.  If
not, we update <code class="docutils literal"><span class="pre">acc</span></code> (here with a helper function called <code class="docutils literal"><span class="pre">update</span></code>) and recur
on the updated <code class="docutils literal"><span class="pre">acc</span></code> and the rest of the list.</p>
<p>Now look for similarities between the <em>imperative</em> accumulator pattern (shown
below) and the <em>recursive</em> accumulator pattern.  Both patterns involve applying
the <em>same</em> function to <code class="docutils literal"><span class="pre">update</span></code> the accumulator for each value.  They differ
in there method of iteration, with the imperative solution using a loop and the
recursive solution recurring on the rest of the list until it has been exhausted.
Readers that are more familiar with the imperative pattern can use this
relationship to help write the <code class="docutils literal"><span class="pre">update</span></code> function, and then apply the general
pattern.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Recursive accumulator</span>
<span class="n">rec_acc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">lst</span><span class="p">:</span> <span class="n">acc</span> <span class="k">if</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="k">else</span> <span class="n">rec_acc</span><span class="p">(</span><span class="n">update</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">acc</span><span class="p">),</span> <span class="n">lst</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>

<span class="c1"># Imperative accumulator</span>
<span class="n">acc</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">L</span><span class="p">:</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


  
      
  <li id="relations-prev" class="navLink" title='Previous Section - 7.5. Other Examples of Higher Order Functions' data-toggle="tooltip">
    <a href="OtherExamplesOfHigherOrderFunctions.html" >
      <i class='prevNav glyphicon glyphicon-chevron-left'></i>
    </a>
  </li>
  <a class="navLinkBg" id="navLinkBgLeft"  href="OtherExamplesOfHigherOrderFunctions.html" ></a>
  
  <li id="relations-next" class="navLink" title='Next Section - 7.7. Lazy Iteration' data-toggle="tooltip" >
    <a href="LazyIteration.html" >
      <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right'></i>
    </a>
  </li>
  <a class="navLinkBg navLink" id="navLinkBgRight" href="LazyIteration.html" >Next Section - 7.7. Lazy Iteration</a>

<script type="text/javascript">

  $('#relations-prev').tooltip({'placement':'right', 'selector': '', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement':'left', 'selector': '', 'delay': { show: 100, hide: 50}});
  
</script>
  
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      
      | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017 Todd Iverson.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
    </p>
  </div>
</footer>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32029811-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>